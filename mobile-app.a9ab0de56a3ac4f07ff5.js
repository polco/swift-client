webpackJsonp([2],{"./src/mobile/app.tsx":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n("./node_modules/react/index.js"),i=n("./node_modules/react-dom/index.js"),o=n("./src/mobile/views/Home.tsx");localStorage.setItem("debug","swift*"),i.render(s.createElement(o.default,null),document.getElementById("swift"))},"./src/mobile/views/Home.less":function(e,t){},"./src/mobile/views/Home.tsx":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n("./node_modules/react/index.js"),i=n("./src/shared/components/Button.tsx"),o=n("./src/shared/components/SessionDisplay.tsx"),r=n("./src/shared/components/SessionScanner.tsx"),c=n("./src/shared/RTCClient.ts");n("./src/mobile/views/Home.less");t.default=class extends s.PureComponent{constructor(e,t){super(e,t),this.onSessionScanned=(e=>{this.client.connectTo(e)}),this.client=new c.default}render(){return s.createElement("div",{className:"home"},s.createElement(o.default,{client:this.client}),s.createElement(r.default,{onSessionScanned:this.onSessionScanned}),s.createElement(i.default,null))}}},"./src/shared/GatewayClient.ts":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n("./node_modules/debug-logger/debug-logger.js"),i=n("./node_modules/events/events.js"),o=n("./node_modules/socket.io-client/lib/index.js"),r=s("swift:GatewayClient");t.default=class extends i.EventEmitter{constructor(){super(),this.socket=o("https://swift-gateway.herokuapp.com",{transports:["websocket"],autoConnect:!1}),this.socket.on("data",(e,t)=>{r("received data",t),this.emit("message",e,t)}),this.socket.on("error",e=>r(e)),this.socket.on("disconnect",()=>{r(`${this.localId}: Disconnected from the gateway`),this.emit("disconnected")})}connect(){return this.socket.connected?Promise.resolve():new Promise((e,t)=>{this.socket.connect(),this.socket.once("connect",()=>{r(`${this.localId}: Connected to the gateway`),this.socket.removeListener("connect_error"),this.socket.removeListener("connect_timeout"),e()}),this.socket.once("connect_error",t),this.socket.once("connect_timeout",t)})}get isConnected(){return this.socket.connected}get localId(){return this.socket.id}disconnect(){this.socket.connected&&(this.socket.disconnect(),this.socket.removeListener("connect_error"),this.socket.removeListener("connect_timeout"))}send(e,t){r("sending",t,"to",e),this.socket.emit("data",e,t)}}},"./src/shared/RTCClient.ts":function(e,t,n){"use strict";var s=this&&this.__awaiter||function(e,t,n,s){return new(n||(n=Promise))(function(i,o){function r(e){try{a(s.next(e))}catch(e){o(e)}}function c(e){try{a(s.throw(e))}catch(e){o(e)}}function a(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(r,c)}a((s=s.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const i=n("./node_modules/debug-logger/debug-logger.js"),o=n("./node_modules/events/events.js"),r=n("./src/shared/GatewayClient.ts"),c=i("swift:RTCClient");t.default=class extends o.EventEmitter{constructor(){super(),this.sendChannel=null,this.remoteId="",this.sessionCreating=!1,this.sessionCreated=!1,this.onGatewayMessage=((e,t)=>s(this,void 0,void 0,function*(){if(this.remoteId=e,"offer"===t.type){this.pc.setRemoteDescription(new RTCSessionDescription(t.sessionDescription));const n=yield this.pc.createAnswer();this.pc.setLocalDescription(n),this.gatewayClient.send(e,{type:"answer",sessionDescription:n})}else if("answer"===t.type)this.pc.setRemoteDescription(t.sessionDescription);else if("candidate"===t.type){const e=new RTCIceCandidate({sdpMLineIndex:t.candidate.sdpMLineIndex,candidate:t.candidate.candidate});this.pc.addIceCandidate(e)}})),this.onSendChannelOpen=(e=>{c("data channel opened"),this.setupDataChannel()}),this.onSendChannelClose=(e=>{c("onSendChannelClose",e)}),this.onDataChannel=(e=>{c("data channel opened"),this.sendChannel=e.channel,this.setupDataChannel()}),this.onLocalIceCandidate=(e=>{e.candidate&&this.gatewayClient.send(this.remoteId,{type:"candidate",candidate:{sdpMLineIndex:e.candidate.sdpMLineIndex,sdpMid:e.candidate.sdpMid,candidate:e.candidate.candidate}})}),this.gatewayClient=new r.default,this.gatewayClient.on("message",this.onGatewayMessage),this.gatewayClient.on("disconnected",()=>{this.sessionCreating=!1,this.sessionCreated&&(this.sessionCreated=!1,this.emit("sessionStopped"))}),this.pc=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]}),this.pc.onicecandidate=this.onLocalIceCandidate,this.pc.ondatachannel=this.onDataChannel}get localId(){return this.gatewayClient.localId}startSession(){return s(this,void 0,void 0,function*(){this.sessionCreating||(this.sessionCreating=!0,yield this.gatewayClient.connect(),this.sessionCreating=!1,this.sessionCreated=!0,this.emit("sessionStarted",this.gatewayClient.localId))})}connectTo(e){return s(this,void 0,void 0,function*(){c("connectTo",e),this.gatewayClient.isConnected&&(yield this.gatewayClient.connect()),this.sendChannel=this.pc.createDataChannel("Swift Data Channel"),this.sendChannel.onopen=this.onSendChannelOpen,this.sendChannel.onclose=this.onSendChannelClose,this.remoteId=e,c("create offer");const t=yield this.pc.createOffer();c("offer created"),yield this.pc.setLocalDescription(t),this.gatewayClient.send(e,{type:"offer",sessionDescription:t})})}setupDataChannel(){window.sendMessage=(e=>{this.sendChannel.send(JSON.stringify(e))}),this.sendChannel.onmessage=(e=>{console.log(JSON.parse(e.data))})}}},"./src/shared/components/Button.less":function(e,t){},"./src/shared/components/Button.tsx":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n("./node_modules/react/index.js"),i=n("./src/shared/spur/ButtonPlugin.ts"),o=n("./src/shared/spur/Factory.tsx");n("./src/shared/components/Button.less");t.default=class extends s.PureComponent{constructor(e,t){super(e,t),this.onTap=(e=>{this.props.onTap(this,e)}),this.onDoubleTap=(e=>{this.props.onDoubleTap(this,e)});const n=new i.default;this.plugins={button:n},n.setEnable(!e.disabled),n.repeat=!!e.repeat,this.props.onTap&&n.on("tap",this.onTap),this.props.onDoubleTap&&n.on("doubleTap",this.onDoubleTap)}componentWillReceiveProps(e){const t=this.plugins.button;t.setEnable(!e.disabled),t.repeat=!!e.repeat,e.onTap&&!t.hasListener("tap")&&t.on("tap",this.onTap),e.onDoubleTap&&!t.hasListener("doubleTap")&&t.on("doubleTap",this.onDoubleTap)}render(){const{className:e,disabled:t,children:n,style:i}=this.props,r={className:"button"+(e?" "+e:"")+(t?" disabled":""),elementRef:this.props.elementRef,plugins:this.plugins,style:i};return s.createElement(o.Pdiv,r,n)}}},"./src/shared/components/SessionDisplay.tsx":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n("./node_modules/qrcode.react/lib/index.js"),i=n("./node_modules/react/index.js"),o=n("./src/shared/components/Button.tsx");t.default=class extends i.PureComponent{constructor(e,t){super(e,t),this.onSessionStarted=(e=>{this.setState({sessionId:e,sessionCreating:!1})}),this.onSessionStopped=(()=>{this.setState({sessionId:void 0,sessionCreating:!1})}),this.createSession=(()=>{this.props.client.startSession(),this.setState({sessionCreating:!0})}),this.state={sessionCreating:e.client.sessionCreating,sessionId:e.client.localId}}componentWillMount(){this.props.client.on("sessionStarted",this.onSessionStarted),this.props.client.on("sessionEnd",this.onSessionStopped)}componentWillUnmount(){this.props.client.removeListener("sessionStarted",this.onSessionStarted),this.props.client.removeListener("onSessionStopped",this.onSessionStarted)}render(){const{sessionId:e,sessionCreating:t}=this.state;return i.createElement("div",{className:"session-display"},t&&"Creating a session...",e?i.createElement("div",{className:"session-display__qr-area"},i.createElement(s,{value:e,size:256}),i.createElement("div",{className:"session-display__id"},"id: "+e)):i.createElement(o.default,{onTap:this.createSession},"Create Session"))}}},"./src/shared/components/SessionScanner.tsx":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n("./node_modules/debug-logger/debug-logger.js"),i=n("./node_modules/instascan/index.js"),o=n("./node_modules/react/index.js"),r=s("swift:SessionScanner");t.default=class extends o.PureComponent{constructor(e,t){super(e,t),this.videoElt=null,this.scan=(()=>{this.setState({isScanning:!0},()=>{i.Camera.getCameras().then(e=>{e.length>0?this.scanner.start(e[1]||e[0]):(this.setState({isScanning:!1}),r("No cameras found."))}).catch(e=>{this.setState({isScanning:!1}),r(e)})})}),this.stopScanning=(()=>{this.scanner.stop()}),this.state={isScanning:!1}}componentDidMount(){this.scanner=new i.Scanner({video:this.videoElt,mirror:!1}),this.scanner.addListener("scan",e=>{this.scanner.stop(),this.setState({isScanning:!1},()=>this.props.onSessionScanned(e))})}render(){const{isScanning:e}=this.state;return o.createElement("div",{className:"session-scanner"},e?o.createElement("button",{onClick:this.stopScanning},"Stop scanning"):o.createElement("button",{onClick:this.scan},"scan QR code"),o.createElement("video",{ref:e=>this.videoElt=e}))}}},"./src/shared/spur/ButtonPlugin.ts":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n("./node_modules/spur-events/index.js"),i=n("./src/shared/spur/interactionLock.ts"),o=n("./src/shared/spur/Plugin.ts");function r(e){t.current.plugins.length&&(t.current.plugins.forEach(n=>{t.current.longTapFired&&e===n.DOMNode||n.cancel()}),t.current.plugins=[])}t.current={plugins:[],tapFired:!1,doubleTapFired:!1,longTapFired:!1},s.addListener(window,"pointerup",function(e){t.current.plugins=[]}),i.default.on("element-lock",r),i.default.on("container-lock",r);const c=700,a=300,d=15;t.default=class extends o.default{constructor(e={}){super(),this.enable=!0,this.lockId=null,this.lastTap=0,this.currentTap=null,this.pointerId="",this.cancelled=!1,this.longTapTimeout=0,this.boundingBox={left:0,top:0,width:0,height:0},this.DOMNode=null,this.minBoxWidth=d,this.minBoxHeight=d,this.isPressed=!1,this.repeatTimeout=0,this.repeatCount=0,this.repeat=!1,this.repeat=!!e.repeat}setMinBoxDimensions(e,t){this.minBoxWidth=Math.max(e,d),this.minBoxHeight=Math.max(t,d)}press(e){this.isPressed=!0,this.repeat&&(this.repeatCount=0,this.repeatTap()),this.emit("press",e)}release(e){this.isPressed=!1,this.emit("release",e)}tap(e){this.emit("tap",e)}doubleTap(e){this.emit("doubleTap",e)}longTap(e){this.emit("longTap",e)}setEnable(e){this.enable=e}reset(){this.lockId&&(i.default.releaseLock(this.lockId),this.lockId=null),window.clearTimeout(this.repeatTimeout),window.clearTimeout(this.longTapTimeout),s.removeListener(document,"pointermove",this.onPointerMove,{context:this}),s.removeListener(document,"pointerup",this.onPointerUp,{context:this})}repeatTap(){const e=0===this.repeatCount?300:20;this.repeatTimeout=window.setTimeout(()=>{this.repeatCount+=1,this.tap(this.currentTap),this.repeatTap()},e)}cancel(){this.isPressed&&(this.cancelled=!0,this.release(!0)),this.reset()}onPointerMove(e){e.pointerId===this.pointerId&&(e.clientX<this.boundingBox.left||e.clientX>this.boundingBox.left+this.boundingBox.width||e.clientY<this.boundingBox.top||e.clientY>this.boundingBox.top+this.boundingBox.height)&&this.cancel()}onPointerDown(e){if(!this.enable||3===e.originalEvent.which||i.default.isLocked(e.target))return;t.current.plugins.push(this),this.pointerId=e.pointerId,this.cancelled=!1;const n={x:e.clientX,y:e.clientY},o=e.target,r=this.DOMNode.getBoundingClientRect();this.boundingBox.top=r.top,this.boundingBox.left=r.left,r.width<this.minBoxWidth?(this.boundingBox.width=this.minBoxWidth,this.boundingBox.left-=(this.minBoxWidth-r.width)/2):this.boundingBox.width=r.width,r.height<this.minBoxHeight?(this.boundingBox.height=this.minBoxHeight,this.boundingBox.top-=(this.minBoxHeight-r.height)/2):this.boundingBox.height=r.height,this.repeat&&(this.currentTap=new s.SpurEvent(e.type),this.currentTap=Object.assign(this.currentTap,e)),this.press(n),t.current.tapFired=t.current.doubleTapFired=t.current.longTapFired=!1,this.hasListener("longTap")&&!this.repeat&&(window.clearTimeout(this.longTapTimeout),this.longTapTimeout=window.setTimeout(()=>{this.lockId=i.default.requestLockOn(o),this.lockId&&(this.longTap(n),t.current.longTapFired=!0)},c)),s.addListener(document,"pointermove",this.onPointerMove,{context:this}),s.addListener(document,"pointerup",this.onPointerUp,{context:this})}onPointerUp(e){if(e.pointerId===this.pointerId&&!this.cancelled&&(this.reset(),this.release(!1),!t.current.longTapFired)){const n=Date.now(),s=n-this.lastTap;if(this.lastTap=n,!t.current.tapFired&&this.hasListener("tap")&&(t.current.tapFired=!0,this.tap(e)),s<a)return this.lastTap=0,void(!t.current.doubleTapFired&&this.hasListener("doubleTap")&&(t.current.doubleTapFired=!0,e.preventDefault(),this.doubleTap(e)))}}componentDidMount(e){this.DOMNode=e,s.addListener(this.DOMNode,"pointerdown",this.onPointerDown,{context:this})}componentWillUnmount(){s.removeListener(this.DOMNode,"pointerdown",this.onPointerDown,{context:this}),this.reset(),this.DOMNode=null,window.clearTimeout(this.repeatTimeout)}}},"./src/shared/spur/Factory.tsx":function(e,t,n){"use strict";var s=this&&this.__rest||function(e,t){var n={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(n[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(s=Object.getOwnPropertySymbols(e);i<s.length;i++)t.indexOf(s[i])<0&&(n[s[i]]=e[s[i]])}return n};Object.defineProperty(t,"__esModule",{value:!0});const i=n("./node_modules/react/index.js");class o extends i.PureComponent{constructor(e,t){super(e,t);for(const t in e.plugins){e.plugins[t].setComponentInstance(this)}}componentWillMount(){const e=this.props.plugins;for(const t in e){e[t].componentWillMount()}}componentDidMountWithElement(e){const t=this.props.plugins;for(const n in t){t[n].componentDidMount(e)}}componentWillReceiveProps(e){const t=this.props.plugins;for(const n in t){t[n].componentWillReceiveProps(e)}}componentWillUpdate(e){const t=this.props.plugins;for(const n in t){t[n].componentWillUpdate(e)}}componentDidUpdate(){const e=this.props.plugins;for(const t in e){e[t].componentDidUpdate()}}componentWillUnmount(){const e=this.props.plugins;for(const t in e){const n=e[t];n.componentWillUnmount(),n.removeEventListeners()}}}function r(e){return class extends o{constructor(e,t){super(e,t),this.element=null,this.onRef=this.onRef.bind(this)}componentDidMount(){this.componentDidMountWithElement(this.element)}onRef(e){this.element=e,this.props.elementRef&&this.props.elementRef(e)}render(){const t=e,n=this.props,{children:o,plugins:r,elementRef:c}=n,a=s(n,["children","plugins","elementRef"]);return i.createElement(t,Object.assign({},a,{ref:this.onRef}),o)}}}t.PlugComponent=o,t.createPlugTagComponent=r,t.Pdiv=r("div"),t.Pspan=r("span")},"./src/shared/spur/Plugin.ts":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.listeners={}}setComponentInstance(e){}componentDidMount(e){}componentWillMount(){}componentWillReceiveProps(e){}componentWillUpdate(e){}componentDidUpdate(){}componentWillUnmount(){}on(e,t,n=this){e in this.listeners?this.listeners[e].push({callback:t,context:n}):this.listeners[e]=[{callback:t,context:n}]}removeEventListeners(){this.listeners={}}emit(e,t){const n=this.listeners[e];if(n)for(let e=0,s=n.length;e<s;e+=1){const s=n[e];s.callback.call(s.context,t)}}hasListener(e){return!!this.listeners[e]}}},"./src/shared/spur/interactionLock.ts":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n("./node_modules/events/events.js");t.default=new class extends s.EventEmitter{constructor(){super(...arguments),this.lockNodes={},this.lockContainerNodes={},this.lockId=0}isLocked(e){for(const t in this.lockNodes){let n=this.lockNodes[t];for(;null!==n;){if(n===e)return!0;n=n.parentNode}}for(const t in this.lockContainerNodes){const n=this.lockContainerNodes[t];let s=e;for(;null!==s;){if(s===n)return!0;s=s.parentNode}}return!1}requestLockOn(e){return this.isLocked(e)?null:(this.lockId+=1,this.lockNodes[this.lockId]=e,this.emit("element-lock",e),this.lockId)}requestContainerLockOn(e){return this.isLocked(e)?null:(this.lockId+=1,this.lockContainerNodes[this.lockId]=e,this.emit("container-lock",e),this.lockId)}releaseLock(e){const t=this.lockNodes[e]||this.lockContainerNodes[e];t&&(delete this.lockNodes[e],delete this.lockContainerNodes[e],this.lockId-=1,this.emit("unlock",t))}}},0:function(e,t){},1:function(e,t){},2:function(e,t){},3:function(e,t){}},["./src/mobile/app.tsx"]);
//# sourceMappingURL=mobile-app.a9ab0de56a3ac4f07ff5.js.map
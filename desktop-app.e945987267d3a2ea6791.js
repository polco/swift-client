webpackJsonp([3],{"./src/desktop/app.tsx":function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s("./node_modules/react/index.js"),i=s("./node_modules/react-dom/index.js"),o=s("./src/desktop/views/Main.tsx");localStorage.setItem("debug","swift*"),i.render(n.createElement(o.default,null),document.getElementById("swift"))},"./src/desktop/views/Main.less":function(e,t){},"./src/desktop/views/Main.tsx":function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s("./node_modules/react/index.js"),i=s("./src/shared/components/Button.tsx"),o=s("./src/shared/components/SessionDisplay.tsx"),r=s("./src/shared/components/SessionScanner.tsx"),a=s("./src/shared/RTCClient.ts");s("./src/desktop/views/Main.less");const c=i.default,d=["home","create","join"];t.default=class extends n.PureComponent{constructor(e,t){super(e,t),this.TABS_MAP={home:{label:"Home",render:()=>n.createElement("div",{className:"Home"},"Welcome!")},create:{label:"Create Session",render(){return n.createElement(o.default,{client:this.client})}},join:{label:"Join Session",render(){return n.createElement(r.default,{onSessionScanned:this.onSessionScanned})}}},this.indicator=null,this.onSessionScanned=(e=>{this.client.connectTo(e)}),this.selectTab=(e=>{this.setState({tabId:e.props.tabId})}),this.state={tabId:"home"},this.client=new a.default}render(){const e=this.state.tabId;return n.createElement("div",{className:"Main"},n.createElement("div",{className:"Main__tabs"},d.map(t=>n.createElement(c,{key:t,className:"Main__tab"+(e===t?" Main__tab_active":""),onTap:this.selectTab,tabId:t},this.TABS_MAP[t].label)),n.createElement("div",{className:"Main__indicator",ref:e=>this.indicator=e})),this.TABS_MAP[e].render.call(this))}}},"./src/shared/GatewayClient.ts":function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s("./node_modules/debug-logger/debug-logger.js"),i=s("./node_modules/events/events.js"),o=s("./node_modules/socket.io-client/lib/index.js"),r=n("swift:GatewayClient");t.default=class extends i.EventEmitter{constructor(){super(),this.socket=o("https://swift-gateway.herokuapp.com",{transports:["websocket"],autoConnect:!1}),this.socket.on("data",(e,t)=>{r("received data",t),this.emit("message",e,t)}),this.socket.on("error",e=>r(e)),this.socket.on("disconnect",()=>{r(`${this.localId}: Disconnected from the gateway`),this.emit("disconnected")})}connect(){return this.socket.connected?Promise.resolve():new Promise((e,t)=>{this.socket.connect(),this.socket.once("connect",()=>{r(`${this.localId}: Connected to the gateway`),this.socket.removeListener("connect_error"),this.socket.removeListener("connect_timeout"),e()}),this.socket.once("connect_error",t),this.socket.once("connect_timeout",t)})}get isConnected(){return this.socket.connected}get localId(){return this.socket.id}disconnect(){this.socket.connected&&(this.socket.disconnect(),this.socket.removeListener("connect_error"),this.socket.removeListener("connect_timeout"))}send(e,t){r("sending",t,"to",e),this.socket.emit("data",e,t)}}},"./src/shared/RTCClient.ts":function(e,t,s){"use strict";var n=this&&this.__awaiter||function(e,t,s,n){return new(s||(s=Promise))(function(i,o){function r(e){try{c(n.next(e))}catch(e){o(e)}}function a(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new s(function(t){t(e.value)}).then(r,a)}c((n=n.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const i=s("./node_modules/debug-logger/debug-logger.js"),o=s("./node_modules/events/events.js"),r=s("./src/shared/GatewayClient.ts"),a=i("swift:RTCClient");t.default=class extends o.EventEmitter{constructor(){super(),this.sendChannel=null,this.remoteId="",this.sessionCreating=!1,this.sessionCreated=!1,this.onGatewayMessage=((e,t)=>n(this,void 0,void 0,function*(){if(this.remoteId=e,"offer"===t.type){this.pc.setRemoteDescription(new RTCSessionDescription(t.sessionDescription));const s=yield this.pc.createAnswer();this.pc.setLocalDescription(s),this.gatewayClient.send(e,{type:"answer",sessionDescription:s})}else if("answer"===t.type)this.pc.setRemoteDescription(t.sessionDescription);else if("candidate"===t.type){const e=new RTCIceCandidate({sdpMLineIndex:t.candidate.sdpMLineIndex,candidate:t.candidate.candidate});this.pc.addIceCandidate(e)}})),this.onSendChannelOpen=(e=>{a("data channel opened"),this.setupDataChannel()}),this.onSendChannelClose=(e=>{a("onSendChannelClose",e)}),this.onDataChannel=(e=>{a("data channel opened"),this.sendChannel=e.channel,this.setupDataChannel()}),this.onLocalIceCandidate=(e=>{e.candidate&&this.gatewayClient.send(this.remoteId,{type:"candidate",candidate:{sdpMLineIndex:e.candidate.sdpMLineIndex,sdpMid:e.candidate.sdpMid,candidate:e.candidate.candidate}})}),this.gatewayClient=new r.default,this.gatewayClient.on("message",this.onGatewayMessage),this.gatewayClient.on("disconnected",()=>{this.sessionCreating=!1,this.sessionCreated&&(this.sessionCreated=!1,this.emit("sessionStopped"))}),this.pc=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]}),this.pc.onicecandidate=this.onLocalIceCandidate,this.pc.ondatachannel=this.onDataChannel}get localId(){return this.gatewayClient.localId}startSession(){return n(this,void 0,void 0,function*(){this.sessionCreating||(this.sessionCreating=!0,yield this.gatewayClient.connect(),this.sessionCreating=!1,this.sessionCreated=!0,this.emit("sessionStarted",this.gatewayClient.localId))})}connectTo(e){return n(this,void 0,void 0,function*(){a("connectTo",e),this.gatewayClient.isConnected&&(yield this.gatewayClient.connect()),this.sendChannel=this.pc.createDataChannel("Swift Data Channel"),this.sendChannel.onopen=this.onSendChannelOpen,this.sendChannel.onclose=this.onSendChannelClose,this.remoteId=e,a("create offer");const t=yield this.pc.createOffer();a("offer created"),yield this.pc.setLocalDescription(t),this.gatewayClient.send(e,{type:"offer",sessionDescription:t})})}setupDataChannel(){window.sendMessage=(e=>{this.sendChannel.send(JSON.stringify(e))}),this.sendChannel.onmessage=(e=>{console.log(JSON.parse(e.data))})}}},"./src/shared/components/Button.less":function(e,t){},"./src/shared/components/Button.tsx":function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s("./node_modules/react/index.js"),i=s("./src/shared/spur/ButtonPlugin.ts"),o=s("./src/shared/spur/Factory.tsx");s("./src/shared/components/Button.less");t.default=class extends n.PureComponent{constructor(e,t){super(e,t),this.onTap=(e=>{this.props.onTap(this,e)}),this.onDoubleTap=(e=>{this.props.onDoubleTap(this,e)});const s=new i.default;this.plugins={button:s},s.setEnable(!e.disabled),s.repeat=!!e.repeat,this.props.onTap&&s.on("tap",this.onTap),this.props.onDoubleTap&&s.on("doubleTap",this.onDoubleTap)}componentWillReceiveProps(e){const t=this.plugins.button;t.setEnable(!e.disabled),t.repeat=!!e.repeat,e.onTap&&!t.hasListener("tap")&&t.on("tap",this.onTap),e.onDoubleTap&&!t.hasListener("doubleTap")&&t.on("doubleTap",this.onDoubleTap)}render(){const{className:e,disabled:t,children:s,style:i}=this.props,r={className:"button"+(e?" "+e:"")+(t?" disabled":""),elementRef:this.props.elementRef,plugins:this.plugins,style:i};return n.createElement(o.Pdiv,r,s)}}},"./src/shared/components/SessionDisplay.tsx":function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s("./node_modules/qrcode.react/lib/index.js"),i=s("./node_modules/react/index.js"),o=s("./src/shared/components/Button.tsx");t.default=class extends i.PureComponent{constructor(e,t){super(e,t),this.onSessionStarted=(e=>{this.setState({sessionId:e,sessionCreating:!1})}),this.onSessionStopped=(()=>{this.setState({sessionId:void 0,sessionCreating:!1})}),this.createSession=(()=>{this.props.client.startSession(),this.setState({sessionCreating:!0})}),this.state={sessionCreating:e.client.sessionCreating,sessionId:e.client.localId}}componentWillMount(){this.props.client.on("sessionStarted",this.onSessionStarted),this.props.client.on("sessionEnd",this.onSessionStopped)}componentWillUnmount(){this.props.client.removeListener("sessionStarted",this.onSessionStarted),this.props.client.removeListener("onSessionStopped",this.onSessionStarted)}render(){const{sessionId:e,sessionCreating:t}=this.state;return i.createElement("div",{className:"session-display"},t&&"Creating a session...",e?i.createElement("div",{className:"session-display__qr-area"},i.createElement(n,{value:e,size:256}),i.createElement("div",{className:"session-display__id"},"id: "+e)):i.createElement(o.default,{onTap:this.createSession},"Create Session"))}}},"./src/shared/components/SessionScanner.tsx":function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s("./node_modules/debug-logger/debug-logger.js"),i=s("./node_modules/instascan/index.js"),o=s("./node_modules/react/index.js"),r=n("swift:SessionScanner");t.default=class extends o.PureComponent{constructor(e,t){super(e,t),this.videoElt=null,this.scan=(()=>{this.setState({isScanning:!0},()=>{i.Camera.getCameras().then(e=>{e.length>0?this.scanner.start(e[1]||e[0]):(this.setState({isScanning:!1}),r("No cameras found."))}).catch(e=>{this.setState({isScanning:!1}),r(e)})})}),this.stopScanning=(()=>{this.scanner.stop()}),this.state={isScanning:!1}}componentDidMount(){this.scanner=new i.Scanner({video:this.videoElt,mirror:!1}),this.scanner.addListener("scan",e=>{this.scanner.stop(),this.setState({isScanning:!1},()=>this.props.onSessionScanned(e))})}render(){const{isScanning:e}=this.state;return o.createElement("div",{className:"session-scanner"},e?o.createElement("button",{onClick:this.stopScanning},"Stop scanning"):o.createElement("button",{onClick:this.scan},"scan QR code"),o.createElement("video",{ref:e=>this.videoElt=e}))}}},"./src/shared/spur/ButtonPlugin.ts":function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s("./node_modules/spur-events/index.js"),i=s("./src/shared/spur/interactionLock.ts"),o=s("./src/shared/spur/Plugin.ts");function r(e){t.current.plugins.length&&(t.current.plugins.forEach(s=>{t.current.longTapFired&&e===s.DOMNode||s.cancel()}),t.current.plugins=[])}t.current={plugins:[],tapFired:!1,doubleTapFired:!1,longTapFired:!1},n.addListener(window,"pointerup",function(e){t.current.plugins=[]}),i.default.on("element-lock",r),i.default.on("container-lock",r);const a=700,c=300,d=15;t.default=class extends o.default{constructor(e={}){super(),this.enable=!0,this.lockId=null,this.lastTap=0,this.currentTap=null,this.pointerId="",this.cancelled=!1,this.longTapTimeout=0,this.boundingBox={left:0,top:0,width:0,height:0},this.DOMNode=null,this.minBoxWidth=d,this.minBoxHeight=d,this.isPressed=!1,this.repeatTimeout=0,this.repeatCount=0,this.repeat=!1,this.repeat=!!e.repeat}setMinBoxDimensions(e,t){this.minBoxWidth=Math.max(e,d),this.minBoxHeight=Math.max(t,d)}press(e){this.isPressed=!0,this.repeat&&(this.repeatCount=0,this.repeatTap()),this.emit("press",e)}release(e){this.isPressed=!1,this.emit("release",e)}tap(e){this.emit("tap",e)}doubleTap(e){this.emit("doubleTap",e)}longTap(e){this.emit("longTap",e)}setEnable(e){this.enable=e}reset(){this.lockId&&(i.default.releaseLock(this.lockId),this.lockId=null),window.clearTimeout(this.repeatTimeout),window.clearTimeout(this.longTapTimeout),n.removeListener(document,"pointermove",this.onPointerMove,{context:this}),n.removeListener(document,"pointerup",this.onPointerUp,{context:this})}repeatTap(){const e=0===this.repeatCount?300:20;this.repeatTimeout=window.setTimeout(()=>{this.repeatCount+=1,this.tap(this.currentTap),this.repeatTap()},e)}cancel(){this.isPressed&&(this.cancelled=!0,this.release(!0)),this.reset()}onPointerMove(e){e.pointerId===this.pointerId&&(e.clientX<this.boundingBox.left||e.clientX>this.boundingBox.left+this.boundingBox.width||e.clientY<this.boundingBox.top||e.clientY>this.boundingBox.top+this.boundingBox.height)&&this.cancel()}onPointerDown(e){if(!this.enable||3===e.originalEvent.which||i.default.isLocked(e.target))return;t.current.plugins.push(this),this.pointerId=e.pointerId,this.cancelled=!1;const s={x:e.clientX,y:e.clientY},o=e.target,r=this.DOMNode.getBoundingClientRect();this.boundingBox.top=r.top,this.boundingBox.left=r.left,r.width<this.minBoxWidth?(this.boundingBox.width=this.minBoxWidth,this.boundingBox.left-=(this.minBoxWidth-r.width)/2):this.boundingBox.width=r.width,r.height<this.minBoxHeight?(this.boundingBox.height=this.minBoxHeight,this.boundingBox.top-=(this.minBoxHeight-r.height)/2):this.boundingBox.height=r.height,this.repeat&&(this.currentTap=new n.SpurEvent(e.type),this.currentTap=Object.assign(this.currentTap,e)),this.press(s),t.current.tapFired=t.current.doubleTapFired=t.current.longTapFired=!1,this.hasListener("longTap")&&!this.repeat&&(window.clearTimeout(this.longTapTimeout),this.longTapTimeout=window.setTimeout(()=>{this.lockId=i.default.requestLockOn(o),this.lockId&&(this.longTap(s),t.current.longTapFired=!0)},a)),n.addListener(document,"pointermove",this.onPointerMove,{context:this}),n.addListener(document,"pointerup",this.onPointerUp,{context:this})}onPointerUp(e){if(e.pointerId===this.pointerId&&!this.cancelled&&(this.reset(),this.release(!1),!t.current.longTapFired)){const s=Date.now(),n=s-this.lastTap;if(this.lastTap=s,!t.current.tapFired&&this.hasListener("tap")&&(t.current.tapFired=!0,this.tap(e)),n<c)return this.lastTap=0,void(!t.current.doubleTapFired&&this.hasListener("doubleTap")&&(t.current.doubleTapFired=!0,e.preventDefault(),this.doubleTap(e)))}}componentDidMount(e){this.DOMNode=e,n.addListener(this.DOMNode,"pointerdown",this.onPointerDown,{context:this})}componentWillUnmount(){n.removeListener(this.DOMNode,"pointerdown",this.onPointerDown,{context:this}),this.reset(),this.DOMNode=null,window.clearTimeout(this.repeatTimeout)}}},"./src/shared/spur/Factory.tsx":function(e,t,s){"use strict";var n=this&&this.__rest||function(e,t){var s={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(s[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&(s[n[i]]=e[n[i]])}return s};Object.defineProperty(t,"__esModule",{value:!0});const i=s("./node_modules/react/index.js");class o extends i.PureComponent{constructor(e,t){super(e,t);for(const t in e.plugins){e.plugins[t].setComponentInstance(this)}}componentWillMount(){const e=this.props.plugins;for(const t in e){e[t].componentWillMount()}}componentDidMountWithElement(e){const t=this.props.plugins;for(const s in t){t[s].componentDidMount(e)}}componentWillReceiveProps(e){const t=this.props.plugins;for(const s in t){t[s].componentWillReceiveProps(e)}}componentWillUpdate(e){const t=this.props.plugins;for(const s in t){t[s].componentWillUpdate(e)}}componentDidUpdate(){const e=this.props.plugins;for(const t in e){e[t].componentDidUpdate()}}componentWillUnmount(){const e=this.props.plugins;for(const t in e){const s=e[t];s.componentWillUnmount(),s.removeEventListeners()}}}function r(e){return class extends o{constructor(e,t){super(e,t),this.element=null,this.onRef=this.onRef.bind(this)}componentDidMount(){this.componentDidMountWithElement(this.element)}onRef(e){this.element=e,this.props.elementRef&&this.props.elementRef(e)}render(){const t=e,s=this.props,{children:o,plugins:r,elementRef:a}=s,c=n(s,["children","plugins","elementRef"]);return i.createElement(t,Object.assign({},c,{ref:this.onRef}),o)}}}t.PlugComponent=o,t.createPlugTagComponent=r,t.Pdiv=r("div"),t.Pspan=r("span")},"./src/shared/spur/Plugin.ts":function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.listeners={}}setComponentInstance(e){}componentDidMount(e){}componentWillMount(){}componentWillReceiveProps(e){}componentWillUpdate(e){}componentDidUpdate(){}componentWillUnmount(){}on(e,t,s=this){e in this.listeners?this.listeners[e].push({callback:t,context:s}):this.listeners[e]=[{callback:t,context:s}]}removeEventListeners(){this.listeners={}}emit(e,t){const s=this.listeners[e];if(s)for(let e=0,n=s.length;e<n;e+=1){const n=s[e];n.callback.call(n.context,t)}}hasListener(e){return!!this.listeners[e]}}},"./src/shared/spur/interactionLock.ts":function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s("./node_modules/events/events.js");t.default=new class extends n.EventEmitter{constructor(){super(...arguments),this.lockNodes={},this.lockContainerNodes={},this.lockId=0}isLocked(e){for(const t in this.lockNodes){let s=this.lockNodes[t];for(;null!==s;){if(s===e)return!0;s=s.parentNode}}for(const t in this.lockContainerNodes){const s=this.lockContainerNodes[t];let n=e;for(;null!==n;){if(n===s)return!0;n=n.parentNode}}return!1}requestLockOn(e){return this.isLocked(e)?null:(this.lockId+=1,this.lockNodes[this.lockId]=e,this.emit("element-lock",e),this.lockId)}requestContainerLockOn(e){return this.isLocked(e)?null:(this.lockId+=1,this.lockContainerNodes[this.lockId]=e,this.emit("container-lock",e),this.lockId)}releaseLock(e){const t=this.lockNodes[e]||this.lockContainerNodes[e];t&&(delete this.lockNodes[e],delete this.lockContainerNodes[e],this.lockId-=1,this.emit("unlock",t))}}},0:function(e,t){},1:function(e,t){},2:function(e,t){},3:function(e,t){}},["./src/desktop/app.tsx"]);
//# sourceMappingURL=desktop-app.e945987267d3a2ea6791.js.map
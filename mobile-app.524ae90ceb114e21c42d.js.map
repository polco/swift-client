{"version":3,"sources":["webpack:///./src/mobile/app.tsx","webpack:///./src/mobile/views/Main.tsx","webpack:///./src/shared/GatewayClient.ts","webpack:///./src/shared/RTCClient.ts","webpack:///./src/shared/Store.ts","webpack:///./src/shared/actions/Action.ts","webpack:///./src/shared/actions/CreateDoc.ts","webpack:///./src/shared/actions/CreateSession.ts","webpack:///./src/shared/actions/UpdateDoc.ts","webpack:///./src/shared/actions/UpdateSessionName.ts","webpack:///./src/shared/actions/UpdateUserName.ts","webpack:///./src/shared/components/Button.tsx","webpack:///./src/shared/components/SessionItem.tsx","webpack:///./src/shared/components/SessionScanner.tsx","webpack:///./src/shared/components/Tabs.tsx","webpack:///./src/shared/components/TextField.tsx","webpack:///./src/shared/context.ts","webpack:///./src/shared/models/Doc.ts","webpack:///./src/shared/models/Item.ts","webpack:///./src/shared/models/Session.ts","webpack:///./src/shared/models/User.ts","webpack:///./src/shared/models/createSeq.ts","webpack:///./src/shared/models/docClass.ts","webpack:///./src/shared/spur/ButtonPlugin.ts","webpack:///./src/shared/spur/Factory.tsx","webpack:///./src/shared/spur/Plugin.ts","webpack:///./src/shared/spur/interactionLock.ts","webpack:///./src/shared/views/CreateSession.tsx","webpack:///./src/shared/views/JoinSession.tsx","webpack:///./src/shared/views/Sessions.tsx","webpack:///./src/shared/views/tabs.tsx"],"names":["React","__webpack_require__","ReactDOM","Main_1","localStorage","setItem","div","document","getElementById","classList","add","render","createElement","default","mobx_react_devtools_1","configureDevtool","logEnabled","context_1","Store_1","CreateSession_1","JoinSession_1","Sessions_1","tabs_1","Tabs_1","ContentClasses","sessions","create","join","Main","PureComponent","[object Object]","props","context","super","this","selectTab","tabId","setState","navigateToSession","sessionId","state","store","currentTabId","ContentClass","className","tabs","TabsInfo","onTabSelect","childContextTypes","contextTypes","exports","debug","events_1","SocketIO","log","EventEmitter","userId","isConnecting","socket","transports","autoConnect","query","on","fromId","data","emit","error","remoteUserId","connected","Promise","resolve","reject","connect","once","removeListener","disconnect","ICustomEmitter","type","cb","prototype","call","value","gatewayClient","sendChannel","sessionCreating","sessionCreated","onGatewayMessage","fromUserId","msg","__awaiter","pc","setRemoteDescription","RTCSessionDescription","sessionDescription","createAnswer","setLocalDescription","send","candidate","RTCIceCandidate","sdpMLineIndex","addIceCandidate","onSendChannelOpen","e","setupDataChannel","onSendChannelClose","onSendChannelError","onDataChannel","channel","onLocalIceCandidate","sdpMid","RTCPeerConnection","iceServers","urls","onicecandidate","ondatachannel","createDataChannel","onopen","onclose","onerror","createOffer","onmessage","event","JSON","parse","stringify","crdt_1","mobx_1","dcstream","uuid","GatewayClient_1","CreateDoc_1","UpdateDoc_1","UpdateSessionName_1","UpdateUserName_1","User_1","RTCClient_1","Store","sessionList","docs","RTCClients","crdts","updating","pendingSeqActions","onJoin","createCRDT","client","setupClient","dc","stream","pipe","createStream","onSessionUser","initiateConnection","window","udpateUser","name","executeAction","udpateSession","length","forEach","action","docId","doc","id","crdt","Doc","user","addDoc","row","get","changes","toJSON","openSession","closeSession","joinSession","itemId","sideEffect","run","__decorate","observable","execute","docClass_1","Session_1","Action_1","instantiate","includes","push","applyPendingSeqAction","ownerId","session","getDoc","key","getSession","getUser","ButtonPlugin_1","Factory_1","onTap","onDoubleTap","onRef","elementRef","button","plugins","setEnable","disabled","repeat","nextProps","hasListener","children","style","Pdiv","mobx_react_1","QRCode","Button_1","SessionItem","Component","enterSession","onEnterSession","displayInfo","info","addText","input","creatorId","creationDate","Date","toISOString","itemContent","content","size","userIds","map","itemIds","getItem","ref","observer","Instascan","videoElt","scan","Camera","getCameras","then","cameras","Error","scanner","start","stop","Scanner","video","mirror","addListener","onSessionScanned","TabButton","indicator","tabWidth","positionIndicator","fullWidth","passedCurrentTab","beforeWidth","width","transform","saveTabRef","clientWidth","Label","mainDiv","onChange","onMainRef","onBlur","generateClassName","onInputRef","hasContent","label","placeholder","PropTypes","object","linked","docPrototype","property","atom","Atom","getter","reportObserved","__data","setter","val","set","reportChanged","Object","defineProperty","toModel","changed","assign","obj","Doc_1","Item","initCRDT","createDoc","createSeq_1","Session","User","list","rowToValue","seq","createSeq","index","indexOf","v","splice","Item_1","docClass","item","spur_events_1","interactionLock_1","Plugin_1","onLock","DOMNode","current","plugin","longTapFired","cancel","tapFired","doubleTapFired","LONG_TAP_TIMEOUT","DOUBLE_TAP_TIMEOUT","MIN_TAP_DISTANCE","options","enable","lockId","lastTap","currentTap","pointerId","cancelled","longTapTimeout","boundingBox","left","top","height","minBoxWidth","minBoxHeight","isPressed","repeatTimeout","repeatCount","Math","max","coords","repeatTap","releaseLock","clearTimeout","onPointerMove","onPointerUp","time","setTimeout","tap","release","reset","clientX","clientY","originalEvent","which","isLocked","target","startTap","x","y","getBoundingClientRect","SpurEvent","press","requestLockOn","longTap","now","tapDiff","preventDefault","doubleTap","onPointerDown","PlugComponent","setComponentInstance","componentWillMount","element","componentDidMount","componentWillReceiveProps","componentWillUpdate","componentDidUpdate","componentWillUnmount","removeEventListeners","createPlugTagComponent","tag","bind","componentDidMountWithElement","instance","ThisTag","_a","__rest","Pspan","listeners","component","Element","eventName","callback","arg","i","len","listener","lockNodes","lockContainerNodes","node","parentNode","container","parent","TextField_1","CreateSession","createSession","sessionNameField","getValue","SessionScanner_1","JoinSession","isScanning","stopScanning","startScanning","validateSession","SessionItem_1","Sessions","SessionLabel","TabMap","TabOrder"],"mappings":"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","file":"mobile-app.524ae90ceb114e21c42d.js","sourcesContent":["import * as React from 'react';\nimport * as ReactDOM from 'react-dom';\nimport 'shared/styles/core.less';\nimport Main from './views/Main';\n\nlocalStorage.setItem('debug', 'swift*');\n\nconst div = document.getElementById('swift');\ndiv!.classList.add('mobile');\nReactDOM.render(<Main />, div);\n\n\n\n// WEBPACK FOOTER //\n// ./src/mobile/app.tsx","import DevTools, { configureDevtool } from 'mobx-react-devtools';\nimport * as React from 'react';\n\nconfigureDevtool({\n\tlogEnabled: true\n});\n\nimport { Context, contextTypes } from 'shared/context';\nimport Store from 'shared/Store';\n\nimport CreateSession from 'shared/views/CreateSession';\nimport JoinSession from 'shared/views/JoinSession';\nimport Sessions from 'shared/views/Sessions';\nimport { TabId, TabsInfo } from 'shared/views/tabs';\n\nimport Tabs from 'shared/components/Tabs';\n\nimport './Main.less';\n\nexport type Props = {};\ntype State = {\n\ttabId: TabId\n};\n\nconst ContentClasses: {[tabId in TabId]: React.ComponentClass<{ navigateToSession(sessionId: string): void }>} = {\n\tsessions: Sessions,\n\tcreate: CreateSession,\n\tjoin: JoinSession\n};\n\nclass Main extends React.PureComponent<Props, State> {\n\tprivate store: Store;\n\n\tconstructor(props: Props, context: any) {\n\t\tsuper(props, context);\n\n\t\tthis.store = new Store();\n\t\tthis.state = { tabId: 'create' };\n\t}\n\n\tpublic static childContextTypes = contextTypes;\n\n\tpublic getChildContext(): Context {\n\t\treturn { store: this.store };\n\t}\n\n\tprivate selectTab = (tabId: TabId) => {\n\t\tthis.setState({ tabId });\n\t}\n\n\tprivate navigateToSession = (sessionId: string) => {\n\t\tif (this.state.tabId !== 'sessions') {\n\t\t\tthis.setState({ tabId: 'sessions' });\n\t\t}\n\t}\n\n\tpublic render() {\n\t\tconst currentTabId = this.state.tabId;\n\t\tconst ContentClass = ContentClasses[currentTabId];\n\n\t\treturn (\n\t\t\t<div className='Main'>\n\t\t\t\t<div className='Main__tab-container'><ContentClass navigateToSession={ this.navigateToSession } /></div>\n\t\t\t\t<Tabs\n\t\t\t\t\ttabs={ TabsInfo }\n\t\t\t\t\tcurrentTabId={ currentTabId }\n\t\t\t\t\tonTabSelect={ this.selectTab }\n\t\t\t\t/>\n\t\t\t\t{ __IS_DEV__ &&  <DevTools /> }\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nexport default Main;\n\n\n\n// WEBPACK FOOTER //\n// ./src/mobile/views/Main.tsx","import * as debug from 'debug-logger';\nimport { EventEmitter } from 'events';\nimport * as SocketIO from 'socket.io-client';\nconst log = debug('swift:GatewayClient');\n\nclass GatewayClient extends EventEmitter {\n\tprivate socket: SocketIOClient.Socket;\n\tprivate isConnecting = false;\n\n\tconstructor(userId: string) {\n\t\tsuper();\n\t\tthis.socket = SocketIO(__SOCKET_END_POINT__, { transports: ['websocket'], autoConnect: false, query: { userId } });\n\n\t\tthis.socket.on('data', (fromId: string, data: any) => {\n\t\t\tlog('received data', data);\n\t\t\tthis.emit('data', fromId, data);\n\t\t});\n\t\tthis.socket.on('error', (error: any) => log(error));\n\t\tthis.socket.on('disconnect', () => {\n\t\t\tlog(`Disconnected from the gateway`);\n\t\t\tthis.emit('disconnected');\n\t\t});\n\t\tthis.socket.on('join', (sessionId: string, remoteUserId: string) => {\n\t\t\tthis.emit('join', sessionId, remoteUserId);\n\t\t});\n\t\tthis.socket.on('sessionUser', (sessionId: string, remoteUserId: string) => {\n\t\t\tthis.emit('sessionUser', sessionId, remoteUserId);\n\t\t});\n\t}\n\n\tprivate connect(): Promise<void> {\n\t\tif (this.isConnecting || this.socket.connected) { return Promise.resolve(); }\n\t\tthis.isConnecting = true;\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis.socket.connect();\n\n\t\t\tthis.socket.once('connect', () => {\n\t\t\t\tthis.isConnecting = false;\n\t\t\t\tlog(`Connected to the gateway`);\n\t\t\t\tthis.socket.removeListener('connect_error');\n\t\t\t\tthis.socket.removeListener('connect_timeout');\n\t\t\t\tresolve();\n\t\t\t});\n\t\t\tthis.socket.once('connect_error', reject);\n\t\t\tthis.socket.once('connect_timeout', reject);\n\t\t});\n\t}\n\n\tpublic async openSession(sessionId: string) {\n\t\tif (!this.socket.connected) { await this.connect(); }\n\t\tthis.socket.emit('openSession', sessionId);\n\t}\n\n\tpublic async closeSession(sessionId: string) {\n\t\tif (!this.socket.connected) { await this.connect(); }\n\t\tthis.socket.emit('closeSession', sessionId);\n\t\tthis.disconnect();\n\t}\n\n\tpublic async joinSession(sessionId: string) {\n\t\tif (!this.socket.connected) { await this.connect(); }\n\t\tthis.socket.emit('join', sessionId);\n\t}\n\n\tprivate disconnect() {\n\t\tif (!this.socket.connected) { return; }\n\t\tthis.isConnecting = false;\n\t\tthis.socket.disconnect();\n\t\tthis.socket.removeListener('connect_error');\n\t\tthis.socket.removeListener('connect_timeout');\n\t}\n\n\tpublic async send(remoteUserId: string, data: any) {\n\t\tif (!this.socket.connected) { await this.connect(); }\n\t\tlog('sending', data, 'to', remoteUserId);\n\t\tthis.socket.emit('data', remoteUserId, data);\n\t}\n}\n\nexport default GatewayClient;\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/GatewayClient.ts","import * as debug from 'debug-logger';\nimport { EventEmitter } from 'events';\n\nimport { DocChange } from 'shared/Store';\n\nimport GatewayClient from 'shared/GatewayClient';\nconst log = debug('swift:RTCClient');\n\ntype Message =\n\t{ type: 'client', sessionId: string } |\n\t{ type: 'offer', sessionDescription: RTCSessionDescriptionInit } |\n\t{ type: 'answer', sessionDescription: RTCSessionDescriptionInit } |\n\t{ type: 'candidate', candidate: RTCIceCandidateInit };\n\nexport type RTCEvent = {\n\t'connect': RTCDataChannel,\n\t'get-docs': string[],\n\t'docs': any[],\n\t'doc-changes': { sessionId: string, changes: {[docId: string]: DocChange[]} },\n};\n\nabstract class ICustomEmitter extends EventEmitter {\n\tpublic on<K extends keyof RTCEvent>(type: K, cb: (value: RTCEvent[K]) => void): this {\n\t\tEventEmitter.prototype.on.call(this, type, cb);\n\t\treturn this;\n\t}\n\n\tpublic emit<K extends keyof RTCEvent>(type: K, value: RTCEvent[K]): boolean {\n\t\treturn EventEmitter.prototype.emit.call(this, type, value);\n\t}\n}\n\n// tslint:disable:max-classes-per-file\nclass RTCClient extends ICustomEmitter {\n\tprivate pc: RTCPeerConnection;\n\tprivate gatewayClient: GatewayClient;\n\tprivate sendChannel: RTCDataChannel | null = null;\n\tprivate remoteUserId: string;\n\tpublic sessionCreating = false;\n\tpublic sessionCreated = false;\n\n\tconstructor(remoteUserId: string, gatewayClient: GatewayClient) {\n\t\tsuper();\n\n\t\tthis.gatewayClient = gatewayClient;\n\t\tthis.gatewayClient.on('data', this.onGatewayMessage);\n\t\tthis.remoteUserId = remoteUserId;\n\n\t\tthis.pc = new RTCPeerConnection({\n\t\t\ticeServers: [{ urls: 'stun:stun.l.google.com:19302' }]\n\t\t});\n\t\tthis.pc.onicecandidate = this.onLocalIceCandidate;\n\t\tthis.pc.ondatachannel = this.onDataChannel;\n\t}\n\n\tpublic async initiateConnection() {\n\t\tlog('initiateConnection');\n\t\tthis.sendChannel = this.pc.createDataChannel('Swift Data Channel with ' + this.remoteUserId);\n\t\tthis.sendChannel.onopen = this.onSendChannelOpen;\n\t\tthis.sendChannel.onclose = this.onSendChannelClose;\n\t\tthis.sendChannel.onerror = this.onSendChannelError;\n\n\t\tlog('create offer');\n\t\tconst sessionDescription = await this.pc.createOffer() as any;\n\t\tlog('offer created');\n\t\tawait this.pc.setLocalDescription(sessionDescription);\n\t\tthis.gatewayClient.send(this.remoteUserId, { type: 'offer', sessionDescription });\n\t}\n\n\tpublic onGatewayMessage = async (fromUserId: string, msg: Message) => {\n\t\tif (fromUserId !== this.remoteUserId) { return; }\n\t\tif (msg.type === 'offer') {\n\t\t\tthis.pc.setRemoteDescription(new RTCSessionDescription(msg.sessionDescription));\n\t\t\tconst sessionDescription = await this.pc.createAnswer() as any;\n\t\t\tthis.pc.setLocalDescription(sessionDescription);\n\t\t\tthis.gatewayClient.send(this.remoteUserId, { type: 'answer', sessionDescription });\n\t\t} else if (msg.type === 'answer') {\n\t\t\tthis.pc.setRemoteDescription(msg.sessionDescription);\n\t\t} else if (msg.type === 'candidate') {\n\t\t\tconst candidate = new RTCIceCandidate({\n\t\t\t\tsdpMLineIndex: msg.candidate.sdpMLineIndex,\n\t\t\t\tcandidate: msg.candidate.candidate\n\t\t\t});\n\t\t\tthis.pc.addIceCandidate(candidate);\n\t\t}\n\t}\n\n\tprivate onSendChannelOpen = (e: Event) => {\n\t\tlog('data channel opened');\n\t\tthis.setupDataChannel();\n\t}\n\n\tprivate onSendChannelClose = (e: Event) => {\n\t\tlog('onSendChannelClose', e);\n\t}\n\n\tprivate onSendChannelError = (e: ErrorEvent) => {\n\t\tlog('onSendChannelError', e);\n\t}\n\n\tprivate onDataChannel = (e: RTCDataChannelEvent) => {\n\t\tlog('data channel opened');\n\t\tthis.sendChannel = e.channel;\n\t\tthis.setupDataChannel();\n\t}\n\n\tprivate setupDataChannel() {\n\t\tthis.sendChannel!.onmessage = (event) => {\n\t\t\tconst { type, data } = JSON.parse(event.data);\n\t\t\tthis.emit(type, data);\n\t\t};\n\t\tthis.gatewayClient.removeListener('data', this.onGatewayMessage);\n\t\tthis.emit('connect', this.sendChannel!);\n\t}\n\n\tpublic getDataChannel() { return this.sendChannel; }\n\n\tpublic sendMessage<K extends keyof RTCEvent>(type: K, data: RTCEvent[K]): void {\n\t\tif (this.sendChannel) {\n\t\t\tthis.sendChannel.send(JSON.stringify({ type, data }));\n\t\t} else {\n\t\t\tlog('trying to send a message before the channel is opened');\n\t\t}\n\t}\n\n\tprivate onLocalIceCandidate = (e: RTCPeerConnectionIceEvent) => {\n\t\tif (!e.candidate) { return; }\n\n\t\tthis.gatewayClient.send(this.remoteUserId, {\n\t\t\ttype: 'candidate',\n\t\t\tcandidate: {\n\t\t\t\tsdpMLineIndex: e.candidate.sdpMLineIndex,\n\t\t\t\tsdpMid: e.candidate.sdpMid,\n\t\t\t\tcandidate: e.candidate.candidate\n\t\t\t} as RTCIceCandidateInit\n\t\t});\n\t}\n}\n\nexport default RTCClient;\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/RTCClient.ts","import { Doc as CRDTDoc } from 'crdt';\nimport * as debug from 'debug-logger';\nimport { IObjectChange, observable } from 'mobx';\nimport * as dcstream from 'rtc-dcstream';\nimport * as uuid from 'uuid/v4';\n\nimport GatewayClient from 'shared/GatewayClient';\n\nimport Action from 'shared/actions/Action';\nimport CreateDoc from 'shared/actions/CreateDoc';\nimport UpdateDoc from 'shared/actions/UpdateDoc';\nimport UpdateSessionName from 'shared/actions/UpdateSessionName';\nimport UpdateUserName from 'shared/actions/UpdateUserName';\n\nimport Doc from 'shared/models/Doc';\nimport Item from 'shared/models/Item';\nimport Session, { ISession } from 'shared/models/Session';\nimport User, { IUser } from 'shared/models/User';\n\nimport RTCClient from 'shared/RTCClient';\n\nconst log = debug('swift:RTCClient');\n\nexport type DocChange = {\n\tname: string;\n\tdocId: string;\n\ttype: IObjectChange['type'];\n\tnewValue: any;\n};\n\nclass Store {\n\t@observable public sessionList: string[] = [];\n\tprivate docs: { [docId: string]: Doc } = {};\n\tpublic userId = 'user-' + uuid();\n\tprivate gatewayClient: GatewayClient;\n\tprivate RTCClients: { [userId: string]: RTCClient } = {};\n\n\tpublic crdts: {[sessionId: string]: CRDTDoc<ISession | IUser>} = {};\n\tpublic updating: {[id: string]: true} = {};\n\n\tpublic pendingSeqActions: Array<() => void> = [];\n\n\tconstructor() {\n\t\t(window as any).store = this;\n\t\t(window as any).udpateUser = (name: string) => {\n\t\t\tthis.executeAction(new UpdateUserName(this.userId, name));\n\t\t};\n\t\t(window as any).udpateSession = (name: string) => {\n\t\t\tconst sessionId = this.sessionList[0];\n\t\t\tthis.executeAction(new UpdateSessionName(sessionId, name));\n\t\t};\n\n\t\tthis.gatewayClient = new GatewayClient(this.userId);\n\t\tthis.gatewayClient.on('join', this.onJoin);\n\t\tthis.gatewayClient.on('sessionUser', this.onSessionUser);\n\t}\n\n\tpublic applyPendingSeqAction() {\n\t\tif (this.pendingSeqActions.length) {\n\t\t\tthis.pendingSeqActions.forEach(action => action());\n\t\t\tthis.pendingSeqActions = [];\n\t\t}\n\t}\n\n\tpublic getDoc(docId: string): Doc {\n\t\treturn this.docs[docId];\n\t}\n\n\tpublic addDoc(doc: Doc) {\n\t\tthis.docs[doc.id] = doc;\n\t}\n\n\tprivate onJoin = (sessionId: string, userId: string) => {\n\t\tif (!this.crdts[sessionId]) { this.createCRDT(sessionId); }\n\n\t\tif (this.RTCClients[userId]) { return; } // TODO Handle same user with many sessions\n\t\tconst client = this.RTCClients[userId] = new RTCClient(userId, this.gatewayClient);\n\t\tthis.setupClient(client);\n\t\tclient.on('connect', (dc) => {\n\t\t\tconst stream = dcstream(dc);\n\t\t\tstream.pipe(this.crdts[sessionId].createStream()).pipe(stream);\n\t\t});\n\t}\n\n\tprivate onSessionUser = (sessionId: string, userId: string) => {\n\t\tif (!this.crdts[sessionId]) { this.createCRDT(sessionId); }\n\n\t\tif (this.RTCClients[userId]) { return; } // TODO Handle same user with many sessions\n\t\tconst client = this.RTCClients[userId] = new RTCClient(userId, this.gatewayClient);\n\t\tthis.setupClient(client);\n\t\tclient.initiateConnection();\n\t\tclient.on('connect', (dc) => {\n\t\t\tconst stream = dcstream(dc);\n\t\t\tstream.pipe(this.crdts[sessionId].createStream()).pipe(stream);\n\t\t});\n\t}\n\n\tpublic createCRDT(sessionId: string) {\n\t\tconst crdt = this.crdts[sessionId] = new CRDTDoc();\n\n\t\t// TODO: how do we deal with the same user in different CRDTDOC ?\n\t\tthis.updating[this.userId] = true;\n\t\tconst user = new User(this, crdt, this.userId, 'user');\n\t\tthis.addDoc(user);\n\t\tdelete this.updating[this.userId];\n\n\t\tcrdt.on('row_update', (row) => {\n\t\t\tconst id = row.get('id');\n\t\t\tif (this.updating[id]) { return; }\n\t\t\tthis.updating[id] = true;\n\n\t\t\tif (this.docs[id]) {\n\t\t\t\tthis.executeAction(new UpdateDoc(id, this.docs[id].changes));\n\t\t\t} else {\n\t\t\t\tthis.executeAction(new CreateDoc(row.toJSON(), sessionId));\n\t\t\t}\n\n\t\t\tdelete this.updating[id];\n\t\t});\n\t}\n\n\tprivate setupClient(client: RTCClient) {\n\t\t// client.on('get-docs', (docIds: string[]) => {\n\t\t\t// client.sendMessage('docs', docIds.map(docId => this.docs[docId].toModel()));\n\t\t// });\n\n\t\t// client.on('docs', (objects: any[]) => {\n\t\t// \tthis.executeAction(new DocsUpdate(objects), true);\n\t\t// });\n\n\t\t// client.on('doc-changes', (docChanges) => {\n\t\t\t// const { changes, sessionId } = docChanges;\n\t\t\t// const session = this.docs[sessionId] as Session;\n\t\t\t// if (session.ownerId === this.user.id) { // send to others\n\t\t\t// \tfor (const userId of session.userIds) {\n\t\t\t// \t\tthis.RTCClients[userId].sendMessage('doc-changes', docChanges);\n\t\t\t// \t}\n\t\t\t// } else {\n\t\t\t// \tconsole.log(changes);\n\t\t\t// }\n\t\t// });\n\t}\n\n\tpublic openSession(sessionId: string) {\n\t\tthis.gatewayClient.openSession(sessionId);\n\t}\n\n\tpublic closeSession(sessionId: string) {\n\t\tthis.gatewayClient.closeSession(sessionId);\n\t}\n\n\tpublic join(sessionId: string) {\n\t\treturn this.gatewayClient.joinSession(sessionId);\n\t}\n\n\tpublic getSession(sessionId: string): Session {\n\t\treturn this.docs[sessionId] as Session;\n\t}\n\n\tpublic removeSession(sessionId: string) {\n\t\tconst session = this.docs[sessionId] as Session;\n\t\tif (!session) { return log('trying to remove an inexisting session', sessionId); }\n\t\tdelete this.docs[sessionId];\n\t}\n\n\tpublic getUser(userId: string): User {\n\t\treturn this.docs[userId] as User;\n\t}\n\n\tpublic getItem(itemId: string): Item {\n\t\treturn this.docs[itemId] as Item;\n\t}\n\n\tpublic executeAction<A extends Action>(action: A, sideEffect = false): A {\n\t\taction.run(this);\n\t\treturn action;\n\t}\n}\n\nexport default Store;\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/Store.ts","import { action } from 'mobx';\nimport Store from 'shared/Store';\n\nexport type ActionsType =\n\t'createSession' | 'updateSessionName' | 'updateDoc' |\n\t'updateUserName' | 'addSession' | 'createDoc' | 'addItem' | 'removeItem';\n\nabstract class IAction {\n\tpublic type: ActionsType;\n\tprotected store!: Store;\n\n\tconstructor(type: ActionsType) {\n\t\tthis.type = type;\n\t}\n\n\tpublic run(store: Store) {\n\t\tthis.store = store;\n\t\taction(this.type, () => this.execute())();\n\t}\n\n\tprotected abstract execute(): boolean;\n}\n\nexport default IAction;\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/actions/Action.ts","import { IDoc } from 'shared/models/Doc';\nimport docClass from 'shared/models/docClass';\nimport Session from 'shared/models/Session';\n\nimport Action from './Action';\n\nclass CreateDoc<D extends IDoc> extends Action {\n\tprivate row: D;\n\tprivate sessionId: string;\n\n\tconstructor(row: D, sessionId: string) {\n\t\tsuper('createDoc');\n\n\t\tthis.row = row;\n\t\tthis.sessionId = sessionId;\n\t}\n\n\tprotected execute() {\n\t\tconst doc = docClass[this.row.type].instantiate(this.store, this.store.crdts[this.sessionId], this.row);\n\t\tthis.store.addDoc(doc);\n\n\t\tif (doc instanceof Session && !this.store.sessionList.includes(this.row.id)) {\n\t\t\tthis.store.sessionList.push(this.row.id);\n\t\t}\n\n\t\tthis.store.applyPendingSeqAction();\n\n\t\treturn true;\n\t}\n}\n\nexport default CreateDoc;\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/actions/CreateDoc.ts","import Session from 'shared/models/Session';\n\nimport Action from './Action';\n\nclass CreateSession extends Action {\n\tprivate id: string;\n\tprivate name: string;\n\tprivate ownerId: string;\n\n\tconstructor(id: string, name: string, ownerId: string) {\n\t\tsuper('createSession');\n\n\t\tthis.id = id;\n\t\tthis.name = name;\n\t\tthis.ownerId = ownerId;\n\t}\n\n\tprotected execute() {\n\t\tif (!this.store.crdts[this.id]) {\n\t\t\tthis.store.createCRDT(this.id);\n\t\t}\n\t\tthis.store.updating[this.id] = true;\n\t\tconst session = new Session(this.store, this.store.crdts[this.id], this.id, this.name, this.ownerId);\n\t\tdelete this.store.updating[this.id];\n\t\tthis.store.addDoc(session);\n\t\tthis.store.sessionList.push(this.id);\n\t\treturn true;\n\t}\n}\n\nexport default CreateSession;\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/actions/CreateSession.ts","import { Changed } from 'crdt';\n\nimport { IDoc } from 'shared/models/Doc';\nimport Action from './Action';\n\nclass UpdateDoc extends Action {\n\tprivate docId: string;\n\tprivate changes: Changed<IDoc>;\n\n\tconstructor(docId: string, changes: Changed<IDoc>) {\n\t\tsuper('updateDoc');\n\n\t\tthis.docId = docId;\n\t\tthis.changes = changes;\n\t}\n\n\tprotected execute() {\n\t\tconst doc = this.store.getDoc(this.docId);\n\n\t\tfor (const key in this.changes) {\n\t\t\t(doc as any)[key] = (this.changes as any)[key];\n\t\t}\n\n\t\tthis.store.applyPendingSeqAction();\n\n\t\treturn true;\n\t}\n}\n\nexport default UpdateDoc;\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/actions/UpdateDoc.ts","import Action from './Action';\n\nclass UpdateSessionName extends Action {\n\tprivate id: string;\n\tprivate name: string;\n\n\tconstructor(id: string, name: string) {\n\t\tsuper('updateSessionName');\n\n\t\tthis.id = id;\n\t\tthis.name = name;\n\t}\n\n\tprotected execute() {\n\t\tconst session = this.store.getSession(this.id);\n\t\tsession.name = this.name;\n\t\treturn true;\n\t}\n}\n\nexport default UpdateSessionName;\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/actions/UpdateSessionName.ts","import Action from './Action';\n\nclass UpdateUserName extends Action {\n\tprivate userId: string;\n\tprivate name: string;\n\n\tconstructor(userId: string, name: string) {\n\t\tsuper('updateUserName');\n\n\t\tthis.userId = userId;\n\t\tthis.name = name;\n\t}\n\n\tprotected execute() {\n\t\tconst user = this.store.getUser(this.userId);\n\t\tuser.name = this.name;\n\t\treturn true;\n\t}\n}\n\nexport default UpdateUserName;\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/actions/UpdateUserName.ts","import * as React from 'react';\nimport ButtonPlugin from 'shared/spur/ButtonPlugin';\nimport { Pdiv } from 'shared/spur/Factory';\nimport { SpurPointerEvent } from 'spur-events';\nimport './Button.less';\n\nexport interface IButtonClass<P> {\n\tnew (props?: Props<P>, context?: any): Button<P>;\n\tprototype: Button<P>;\n}\n\nexport type Props<P = {}> = {\n\trepeat?: boolean,\n\tdisabled?: boolean,\n\tclassName?: string,\n\tstyle?: React.CSSProperties,\n\telementRef?: (ref: HTMLDivElement | null) => void,\n\tonTap?: (component: Button<P>, e: SpurPointerEvent) => void,\n\tonDoubleTap?: (component: Button<P>, e: SpurPointerEvent) => void,\n} & P;\n\nclass Button<P = Props> extends React.PureComponent<Props<P>> {\n\tprivate plugins: { button: ButtonPlugin };\n\tpublic div: HTMLDivElement | null = null;\n\n\tconstructor(props: Props<P>, context: any) {\n\t\tsuper(props, context);\n\n\t\tconst button = new ButtonPlugin();\n\t\tthis.plugins = { button };\n\t\tbutton.setEnable(!props.disabled);\n\t\tbutton.repeat = !!props.repeat;\n\n\t\tif (this.props.onTap) { button.on('tap', this.onTap); }\n\t\tif (this.props.onDoubleTap) { button.on('doubleTap', this.onDoubleTap); }\n\t}\n\n\tpublic componentWillReceiveProps(nextProps: Props<P>) {\n\t\tconst button = this.plugins.button;\n\t\tbutton.setEnable(!nextProps.disabled);\n\t\tbutton.repeat = !!nextProps.repeat;\n\n\t\tif (nextProps.onTap && !button.hasListener('tap')) { button.on('tap', this.onTap); }\n\t\tif (nextProps.onDoubleTap && !button.hasListener('doubleTap')) { button.on('doubleTap', this.onDoubleTap); }\n\t}\n\n\tprivate onTap = (e: SpurPointerEvent) => {\n\t\tthis.props.onTap!(this, e);\n\t}\n\n\tprivate onDoubleTap = (e: SpurPointerEvent) => {\n\t\tthis.props.onDoubleTap!(this, e);\n\t}\n\n\tprivate onRef = (div: HTMLDivElement | null) => {\n\t\tthis.div = div;\n\t\tif (this.props.elementRef) { this.props.elementRef(div); }\n\t}\n\n\tpublic render() {\n\t\tconst { className, disabled, children, style } = this.props;\n\n\t\tconst cn =\n\t\t\t'button' +\n\t\t\t(className ? ' ' + className : '') +\n\t\t\t(disabled ? ' disabled' : '');\n\n\t\tconst props = {\n\t\t\tclassName: cn,\n\t\t\telementRef: this.onRef,\n\t\t\tplugins: this.plugins,\n\t\t\tstyle\n\t\t};\n\n\t\treturn React.createElement(Pdiv, props, children);\n\t}\n}\n\nexport default Button;\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/components/Button.tsx","import { observer } from 'mobx-react';\nimport * as QRCode from 'qrcode.react';\nimport * as React from 'react';\nimport * as uuid from 'uuid/v4';\n\nimport Button from 'shared/components/Button';\nimport { Context, contextTypes } from 'shared/context';\nimport CreateDoc from '../actions/CreateDoc';\n\nimport { IItem } from 'shared/models/Item';\n\nexport type Props = {\n\tsessionId: string,\n\tonEnterSession(sessionId: string): void\n};\n\ntype State = {\n\tinfo: boolean\n};\n\n@observer\nclass SessionItem extends React.Component<Props, State> {\n\tpublic context!: Context;\n\tpublic static contextTypes = contextTypes;\n\tprivate input!: HTMLInputElement | null;\n\n\tconstructor(props: Props, context: Context) {\n\t\tsuper(props, context);\n\n\t\tthis.state = { info: false };\n\t}\n\n\tprivate enterSession = () => {\n\t\tthis.props.onEnterSession(this.props.sessionId);\n\t}\n\n\tprivate displayInfo = () => {\n\t\tthis.setState({ info: !this.state.info });\n\t}\n\n\tprivate addText = () => {\n\t\tconst value = this.input!.value;\n\t\tif (value === '') { return; }\n\n\t\tconst itemId = 'item-' + uuid();\n\t\tthis.context.store.executeAction(new CreateDoc<IItem>({\n\t\t\tid: itemId,\n\t\t\ttype: 'item',\n\t\t\tcreatorId: this.context.store.userId,\n\t\t\tcreationDate: new Date().toISOString(),\n\t\t\titemContent: { type: 'text', content: value }\n\t\t}, this.props.sessionId));\n\t\tthis.input!.value = '';\n\t}\n\n\tpublic render() {\n\t\tconst { sessionId } = this.props;\n\t\tconst { info } = this.state;\n\t\tconst store = this.context.store;\n\t\tconst session = store.getSession(sessionId);\n\n\t\treturn (\n\t\t\t<Button className={ 'SessionItem' + (info ? ' SessionItem_info' : '') } onTap={ this.enterSession }>\n\t\t\t\t<div>{ session.name }</div>\n\t\t\t\t<Button onTap={ this.displayInfo }>Info</Button>\n\t\t\t\t{ info && (\n\t\t\t\t\t<div className='SessionItem__info'>\n\t\t\t\t\t\t<div className='user-select'>{ session.id }</div>\n\t\t\t\t\t\t<QRCode value={ session.id } size={ 256 } />\n\t\t\t\t\t</div>\n\t\t\t\t) }\n\n\t\t\t\t<div className='SessionItem__user-list'>\n\t\t\t\t{\n\t\t\t\t\tsession.userIds.map(userId =>\n\t\t\t\t\t\t<div className='SessionItem__user' key={ userId }>\n\t\t\t\t\t\t\t{ store.getUser(userId).name }\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)\n\t\t\t\t}\n\t\t\t\t</div>\n\n\t\t\t\t<div className='SessionItem__item-list'>\n\t\t\t\t{\n\t\t\t\t\tsession.itemIds.map(itemId =>\n\t\t\t\t\t\t<div className='SessionItem__item' key={ itemId }>\n\t\t\t\t\t\t\t{ store.getItem(itemId).itemContent.content }\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)\n\t\t\t\t}\n\t\t\t\t</div>\n\n\t\t\t\t<div className='SessionItem_add-text'>\n\t\t\t\t\t<input className='SessionItem_text-input' ref={ ref => this.input = ref } />\n\t\t\t\t\t<Button onTap={ this.addText }>Send text</Button>\n\t\t\t\t</div>\n\t\t\t</Button>\n\t\t);\n\t}\n}\n\nexport default SessionItem;\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/components/SessionItem.tsx","import * as debug from 'debug-logger';\nimport * as Instascan from 'instascan';\nimport * as React from 'react';\nconst log = debug('swift:SessionScanner');\n\nexport type Props = {\n\tonSessionScanned: (sessionId: string) => void\n};\n\nclass SessionScanner extends React.PureComponent<Props> {\n\tprivate videoElt: HTMLVideoElement | null = null;\n\tprivate scanner: any;\n\n\tpublic componentDidMount () {\n\t\tthis.scanner = new Instascan.Scanner({ video: this.videoElt, mirror: false });\n\t\tthis.scanner.addListener('scan', (content: string) => {\n\t\t\tthis.scanner.stop();\n\t\t\tthis.props.onSessionScanned(content);\n\t\t});\n\t}\n\n\tpublic scan = (): Promise<void> => {\n\t\treturn Instascan.Camera.getCameras().then((cameras: any[]) => {\n\t\t\tif (cameras.length > 0) {\n\t\t\t\tthis.scanner.start(cameras[1] || cameras[0]);\n\t\t\t} else {\n\t\t\t\tlog('No cameras found.');\n\t\t\t\tthrow new Error('No cameras found.');\n\t\t\t}\n\t\t});\n\t}\n\n\tpublic stop = () => {\n\t\tthis.scanner.stop();\n\t}\n\n\tpublic render () {\n\t\treturn (\n\t\t\t<video ref={ ref => this.videoElt = ref } className='session-scanner' />\n\t\t);\n\t}\n}\n\nexport default SessionScanner;\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/components/SessionScanner.tsx","import * as React from 'react';\n\nimport Button, { IButtonClass } from 'shared/components/Button';\n\nimport './Tabs.less';\n\ntype TabButtonProps = { tabId: string };\nconst TabButton = Button as IButtonClass<TabButtonProps>;\n\nexport type Props = {\n\ttabs: Array<{ tabId: string, Label: React.StatelessComponent }>,\n\tcurrentTabId: string,\n\tonTabSelect(tabId: string): void\n};\n\nclass Tabs extends React.PureComponent<Props> {\n\tprivate indicator: HTMLDivElement | null = null;\n\tprivate tabWidth: { [tabId: string]: number } = {};\n\n\tpublic componentDidMount() {\n\t\tthis.positionIndicator();\n\t}\n\n\tpublic componentDidUpdate() {\n\t\tthis.positionIndicator();\n\t}\n\n\tprivate positionIndicator = () => {\n\t\tconst { currentTabId, tabs } = this.props;\n\t\tlet fullWidth = 0;\n\t\tlet passedCurrentTab = false;\n\t\tlet beforeWidth = 0;\n\t\tfor (const { tabId } of tabs) {\n\t\t\tif (tabId === currentTabId) { passedCurrentTab = true; }\n\t\t\tconst width = this.tabWidth[tabId];\n\t\t\tif (!passedCurrentTab) {\n\t\t\t\tbeforeWidth += width;\n\t\t\t}\n\t\t\tfullWidth += width;\n\t\t}\n\n\t\tthis.indicator!.style.transform =\n\t\t\t`translate3d(${beforeWidth * 100 / fullWidth}%, 0, 0) scaleX(${ this.tabWidth[currentTabId] / fullWidth })`;\n\t}\n\n\tprivate saveTabRef = (button: Button<TabButtonProps> | null) => {\n\t\tif (button) {\n\t\t\tthis.tabWidth[button.props.tabId] = button.div!.clientWidth;\n\t\t}\n\t}\n\n\tprivate selectTab = (button: Button<TabButtonProps>) => {\n\t\tthis.props.onTabSelect(button.props.tabId);\n\t}\n\n\tpublic render() {\n\t\tconst { currentTabId, tabs } = this.props;\n\n\t\treturn (\n\t\t\t<div className='Tabs'>\n\t\t\t\t<div className='Tabs__container'>\n\t\t\t\t\t{\n\t\t\t\t\t\ttabs.map(({ tabId, Label }) => {\n\n\t\t\t\t\t\t\treturn (<TabButton\n\t\t\t\t\t\t\t\tkey={ tabId }\n\t\t\t\t\t\t\t\tclassName={ 'Tabs__tab' + (currentTabId === tabId ? ' Tabs__tab_active' : '') }\n\t\t\t\t\t\t\t\tonTap={ this.selectTab }\n\t\t\t\t\t\t\t\ttabId={ tabId }\n\t\t\t\t\t\t\t\tref={ this.saveTabRef }\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Label />\n\t\t\t\t\t\t\t</TabButton>); }\n\t\t\t\t\t\t)\n\t\t\t\t\t}\n\t\t\t\t\t<div className='Tabs__indicator' ref={ ref => this.indicator = ref } />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nexport default Tabs;\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/components/Tabs.tsx","import * as React from 'react';\n\nimport './TextField.less';\n\nexport type Props = {\n\tlabel: string,\n\tplaceholder: string,\n\tclassName?: string\n};\n\nclass TextField extends React.PureComponent<Props> {\n\tprivate mainDiv: HTMLDivElement | null = null;\n\tprivate input: HTMLInputElement | null = null;\n\tprivate content: string = '';\n\n\tconstructor(props: Props, context: any) {\n\t\tsuper(props, context);\n\n\t\tthis.state = { hasContent: false };\n\t}\n\n\tprivate onChange = () => {\n\t\tthis.content = this.input!.value;\n\t}\n\n\tprivate onMainRef = (div: HTMLDivElement | null) => {\n\t\tthis.mainDiv = div;\n\t}\n\n\tprivate onBlur = () => {\n\t\tthis.mainDiv!.className = this.generateClassName();\n\t}\n\n\tprivate onInputRef = (input: HTMLInputElement | null) => {\n\t\tthis.input = input;\n\t}\n\n\tprivate generateClassName(): string {\n\t\treturn 'TextField' + (this.content.length ? ' TextField_hasContent' : '');\n\t}\n\n\tpublic getValue() { return this.content; }\n\n\tpublic render() {\n\t\tconst { label, placeholder } = this.props;\n\n\t\treturn (\n\t\t\t<div className={ this.generateClassName() } ref={ this.onMainRef }>\n\t\t\t\t<div className='TextField__label'>{ label }</div>\n\t\t\t\t<input\n\t\t\t\t\tclassName='TextField__input'\n\t\t\t\t\tplaceholder={ placeholder }\n\t\t\t\t\tonChange={ this.onChange }\n\t\t\t\t\tonBlur={ this.onBlur }\n\t\t\t\t\tref={ this.onInputRef }\n\t\t\t\t/>\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nexport default TextField;\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/components/TextField.tsx","import * as PropTypes from 'prop-types';\nimport Store from './Store';\n\nexport type Context = {\n\tstore: Store\n};\n\nexport const contextTypes: {[T in keyof Context]: PropTypes.Requireable<any>} = {\n\tstore: PropTypes.object\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/context.ts","import { Atom } from 'mobx';\n\nimport Store from 'shared/Store';\n\nimport { Doc as CrdtDoc, Row as CrdtDow } from 'crdt';\n\nexport type DocType = 'session' | 'user' | 'item';\n\nexport function linked(docPrototype: any, property: string) {\n\tconst atom = new Atom(property);\n\n\tconst getter = function(this: Doc) {\n\t\tatom.reportObserved();\n\t\treturn (this as any).__data[property];\n\t};\n\n\tconst setter = function(this: Doc, val: any) {\n\t\tconst value = (this as any).__data[property];\n\t\tif (value === val) { return; }\n\t\t(this as any).__data[property] = val;\n\t\tif (this.row && this.row.get(property) !== val) {\n\t\t\tthis.row.set(property, val);\n\t\t}\n\t\tatom.reportChanged();\n\t};\n\n\tif (delete docPrototype[property]) {\n\t\tObject.defineProperty(docPrototype, property, {\n\t\t\tget: getter,\n\t\t\tset: setter\n\t\t});\n\t}\n}\n\nexport interface IDoc {\n\tid: string;\n\ttype: DocType;\n}\n\nabstract class Doc<M extends IDoc = any> {\n\tprotected __data = {};\n\t@linked public readonly id: string;\n\t@linked public readonly type: DocType;\n\tpublic row!: CrdtDow<M>;\n\tprotected store: Store;\n\tpublic changes: {[K in keyof M]?: M[K]};\n\n\tconstructor(store: Store, id: string, type: DocType) {\n\t\tthis.store = store;\n\t\tthis.id = id;\n\t\tthis.type = type;\n\t\tthis.changes = {};\n\t}\n\n\tprotected initCRDT(crdt: CrdtDoc): void {\n\t\tthis.row = crdt.get(this.id);\n\t\tif (!this.row.get('type')) {\n\t\t\tthis.row.set(this.toModel());\n\t\t}\n\n\t\tthis.row.on('change', (changed) => {\n\t\t\tObject.assign(this.changes, changed);\n\t\t});\n\t}\n\n\tprotected createDoc<O>(obj: O): O & IDoc {\n\t\treturn Object.assign(obj, { id: this.id, type: this.type });\n\t}\n\n\tpublic abstract toModel(): M;\n}\n\nexport default Doc;\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/models/Doc.ts","import { Doc as CrdtDoc } from 'crdt';\nimport Doc, { IDoc, linked } from './Doc';\n\nimport Store from 'shared/Store';\n\nexport type TextItem = { type: 'text', content: string };\n\nexport type ItemContent = TextItem;\n\nexport interface IItem extends IDoc {\n\tcreatorId: string;\n\tcreationDate: string;\n\titemContent: ItemContent;\n}\n\nclass Item extends Doc<IItem> {\n\t@linked public creatorId: string;\n\t@linked public creationDate: string;\n\t@linked public itemContent: ItemContent;\n\n\tconstructor(\n\t\tstore: Store, crdt: CrdtDoc<IDoc>, id: string, creatorId: string, creationDate: string, itemContent: ItemContent\n\t) {\n\t\tsuper(store, id, 'item');\n\t\tthis.creatorId = creatorId;\n\t\tthis.creationDate = creationDate;\n\t\tthis.itemContent = itemContent;\n\t\tthis.initCRDT(crdt);\n\t}\n\n\tpublic static instantiate(\n\t\tstore: Store, crdt: CrdtDoc<IDoc>, { id, creatorId, creationDate, itemContent }: IItem\n\t): Item {\n\t\treturn new Item(store, crdt, id, creatorId, creationDate, itemContent);\n\t}\n\n\tpublic toModel() {\n\t\treturn this.createDoc({\n\t\t\tcreationDate: this.creationDate,\n\t\t\tcreatorId: this.creatorId,\n\t\t\titemContent: this.itemContent\n\t\t});\n\t}\n}\n\nexport default Item;\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/models/Item.ts","import { Doc as CRDTDoc } from 'crdt';\nimport { observable } from 'mobx';\nimport Doc, { IDoc, linked } from './Doc';\n\nimport createSeq from './createSeq';\n\nimport Store from 'shared/Store';\n\nexport interface ISession extends IDoc {\n\townerId: string;\n\tname: string;\n}\n\nclass Session extends Doc<ISession> {\n\t@linked public readonly ownerId: string;\n\t@linked public name: string;\n\t@observable public userIds: string[];\n\t@observable public itemIds: string[];\n\n\tconstructor(store: Store, crdt: CRDTDoc<IDoc>, id: string, name: string, ownerId: string) {\n\t\tsuper(store, id, 'session');\n\t\tthis.name = name;\n\t\tthis.ownerId = ownerId;\n\t\tthis.userIds = [];\n\t\tthis.itemIds = [];\n\n\t\tthis.initCRDT(crdt);\n\t\tcreateSeq(crdt, store, 'type', 'item', this.itemIds, row => row.get('id'));\n\t\tcreateSeq(crdt, store, 'type', 'user', this.userIds, row => row.get('id'));\n\t}\n\n\tpublic static instantiate(store: Store, crdt: CRDTDoc<IDoc>, { id, name, ownerId }: ISession): Session {\n\t\treturn new Session(store, crdt, id, name, ownerId);\n\t}\n\n\tpublic toModel() {\n\t\treturn this.createDoc({\n\t\t\townerId: this.ownerId,\n\t\t\tname: this.name\n\t\t});\n\t}\n}\n\nexport default Session;\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/models/Session.ts","import { Doc as CrdtDoc } from 'crdt';\nimport Doc, { IDoc, linked } from './Doc';\n\nimport Store from 'shared/Store';\n\nexport interface IUser extends IDoc {\n\tname: string;\n}\n\nclass User extends Doc<IUser> {\n\t@linked public name: string;\n\n\tconstructor(store: Store, crdt: CrdtDoc, id: string, name: string) {\n\t\tsuper(store, id, 'user');\n\t\tthis.name = name;\n\t\tthis.initCRDT(crdt);\n\t}\n\n\tpublic static instantiate(store: Store, crdt: CrdtDoc<IDoc>, { id, name }: IUser): User {\n\t\treturn new User(store, crdt, id, name);\n\t}\n\n\tpublic toModel() {\n\t\treturn this.createDoc({\n\t\t\tname: this.name\n\t\t});\n\t}\n}\n\nexport default User;\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/models/User.ts","import { Doc as CRDTDoc, Row } from 'crdt';\nimport { IDoc } from 'shared/models/Doc';\nimport Store from 'shared/Store';\n\nexport default function createSeq<D extends IDoc, K extends keyof D, L>(\n\tcrdt: CRDTDoc<D>, store: Store, key: K, value: D[K], list: L[], rowToValue: (row: Row<D>) => L\n) {\n\tconst seq = crdt.createSeq(key, value);\n\n\tseq.forEach(row => list.push(rowToValue(row)));\n\n\tseq.on('add', row => {\n\t\tconst index = seq.indexOf(row);\n\t\tif (index !== -1) {\n\t\t\tconst v = rowToValue(row);\n\t\t\tstore.pendingSeqActions.push(() => {\n\t\t\t\tlist.splice(index, 0, v);\n\t\t\t});\n\t\t}\n\t});\n\n\tseq.on('remove', row => {\n\t\tconst v = rowToValue(row);\n\t\tconst index = list.indexOf(v);\n\t\tif (index !== -1) {\n\t\t\tstore.pendingSeqActions.push(() => {\n\t\t\t\tlist.splice(index, 1);\n\t\t\t});\n\t\t}\n\t});\n\n\treturn list;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/models/createSeq.ts","import { Doc as CRDTDoc } from 'crdt';\n\nimport Doc, { DocType, IDoc } from './Doc';\nimport Item from './Item';\nimport Session from './Session';\nimport User from './User';\n\nimport Store from 'shared/Store';\n\nconst docClass: {[D in DocType]: {\n\tnew(...args: any[]): Doc;\n\tinstantiate(store: Store, crdt: CRDTDoc<IDoc>, data: any): Doc;\n}} = {\n\tsession: Session,\n\tuser: User,\n\titem: Item\n};\n\nexport default docClass;\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/models/docClass.ts","import { addListener, removeListener, SpurEvent, SpurPointerEvent } from 'spur-events';\nimport interactionLock from './interactionLock';\nimport Plugin from './Plugin';\n\ninterface IButtonPlugin {\n\tcancel(): void;\n\tDOMNode: HTMLElement | null;\n}\n\nexport const current: {\n\tplugins: IButtonPlugin[],\n\ttapFired: boolean,\n\tdoubleTapFired: boolean,\n\tlongTapFired: boolean\n} = { plugins: [], tapFired: false, doubleTapFired: false, longTapFired: false };\n\naddListener(window, 'pointerup', function(e: SpurPointerEvent) {\n\tcurrent.plugins = [];\n});\n\nfunction onLock(DOMNode: HTMLElement) {\n\tif (current.plugins.length) {\n\t\tcurrent.plugins.forEach(plugin => {\n\t\t\tif (!current.longTapFired || DOMNode !== plugin.DOMNode) { plugin.cancel(); }\n\t\t});\n\t\tcurrent.plugins = [];\n\t}\n}\n\ninteractionLock.on('element-lock', onLock);\ninteractionLock.on('container-lock', onLock);\n\ntype Coords = { x: number, y: number };\n\nconst LONG_TAP_TIMEOUT = 700;\nconst DOUBLE_TAP_TIMEOUT = 300;\nconst MIN_TAP_DISTANCE = 15;\n\nexport type Events = {\n\tpress: Coords,\n\trelease: boolean,\n\ttap: SpurPointerEvent,\n\tdoubleTap: SpurPointerEvent,\n\tlongTap: Coords\n};\n\nclass ButtonPlugin extends Plugin<Events> {\n\tprivate enable = true;\n\tprivate lockId: number | null = null;\n\tprivate lastTap = 0;\n\tprivate currentTap: SpurPointerEvent | null = null;\n\tprivate pointerId: string = '';\n\tprivate cancelled: boolean = false;\n\tprivate longTapTimeout: number = 0;\n\tprivate boundingBox = { left: 0, top: 0, width: 0, height: 0 };\n\tpublic DOMNode: HTMLElement | null = null;\n\tprivate minBoxWidth = MIN_TAP_DISTANCE;\n\tprivate minBoxHeight = MIN_TAP_DISTANCE;\n\tprivate isPressed = false;\n\tprivate repeatTimeout: number = 0;\n\tprivate repeatCount = 0;\n\tpublic repeat = false;\n\n\tconstructor(options: { repeat?: boolean } = {}) {\n\t\tsuper();\n\n\t\tthis.repeat = !!options.repeat;\n\t}\n\n\tpublic setMinBoxDimensions(width: number, height: number) {\n\t\tthis.minBoxWidth = Math.max(width, MIN_TAP_DISTANCE);\n\t\tthis.minBoxHeight = Math.max(height, MIN_TAP_DISTANCE);\n\t}\n\n\tprivate press(coords: Coords) {\n\t\tthis.isPressed = true;\n\t\tif (this.repeat) {\n\t\t\tthis.repeatCount = 0;\n\t\t\tthis.repeatTap();\n\t\t}\n\t\tthis.emit('press', coords);\n\t}\n\n\tprivate release(cancelled: boolean) {\n\t\tthis.isPressed = false;\n\t\tthis.emit('release', cancelled);\n\t}\n\n\tprivate tap(e: SpurPointerEvent) {\n\t\tthis.emit('tap', e);\n\t}\n\n\tprivate doubleTap(e: SpurPointerEvent) {\n\t\tthis.emit('doubleTap', e);\n\t}\n\n\tprivate longTap(coords: Coords) {\n\t\tthis.emit('longTap', coords);\n\t}\n\n\tpublic setEnable(enable: boolean) {\n\t\tthis.enable = enable;\n\t}\n\n\tprivate reset() {\n\t\tif (this.lockId) {\n\t\t\tinteractionLock.releaseLock(this.lockId);\n\t\t\tthis.lockId = null;\n\t\t}\n\t\twindow.clearTimeout(this.repeatTimeout);\n\t\twindow.clearTimeout(this.longTapTimeout);\n\t\tremoveListener(document, 'pointermove', this.onPointerMove, { context: this });\n\t\tremoveListener(document, 'pointerup', this.onPointerUp, { context: this });\n\t}\n\n\tprivate repeatTap() {\n\t\tconst time = this.repeatCount === 0 ? 300 : 20;\n\n\t\tthis.repeatTimeout = window.setTimeout(() => {\n\t\t\tthis.repeatCount += 1;\n\t\t\tthis.tap(this.currentTap!);\n\t\t\tthis.repeatTap();\n\t\t}, time);\n\t}\n\n\tpublic cancel() {\n\t\tif (this.isPressed) {\n\t\t\tthis.cancelled = true;\n\t\t\tthis.release(true);\n\t\t}\n\n\t\tthis.reset();\n\t}\n\n\tprivate onPointerMove(e: SpurPointerEvent) {\n\t\tif (e.pointerId !== this.pointerId) { return; }\n\t\tif (e.clientX < this.boundingBox.left ||\n\t\t\te.clientX > this.boundingBox.left + this.boundingBox.width ||\n\t\t\te.clientY < this.boundingBox.top ||\n\t\t\te.clientY > this.boundingBox.top + this.boundingBox.height) {\n\t\t\tthis.cancel();\n\t\t}\n\t}\n\n\tprivate onPointerDown(e: SpurPointerEvent) {\n\t\tif (!this.enable || (e.originalEvent as MouseEvent).which === 3 || interactionLock.isLocked(e.target as Node)) {\n\t\t\treturn;\n\t\t}\n\n\t\tcurrent.plugins.push(this);\n\t\tthis.pointerId = e.pointerId;\n\n\t\tthis.cancelled = false;\n\t\tconst startTap = {\n\t\t\tx: e.clientX,\n\t\t\ty: e.clientY\n\t\t};\n\n\t\tconst target = e.target;\n\n\t\tconst boundingBox = this.DOMNode!.getBoundingClientRect();\n\t\tthis.boundingBox.top = boundingBox.top;\n\t\tthis.boundingBox.left = boundingBox.left;\n\t\tif (boundingBox.width < this.minBoxWidth) {\n\t\t\tthis.boundingBox.width = this.minBoxWidth;\n\t\t\tthis.boundingBox.left -= (this.minBoxWidth - boundingBox.width) / 2;\n\t\t} else {\n\t\t\tthis.boundingBox.width = boundingBox.width;\n\t\t}\n\n\t\tif (boundingBox.height < this.minBoxHeight) {\n\t\t\tthis.boundingBox.height = this.minBoxHeight;\n\t\t\tthis.boundingBox.top -= (this.minBoxHeight - boundingBox.height) / 2;\n\t\t} else {\n\t\t\tthis.boundingBox.height = boundingBox.height;\n\t\t}\n\n\t\tif (this.repeat) {\n\t\t\tthis.currentTap = new SpurEvent(e.type) as SpurPointerEvent;\n\t\t\tthis.currentTap = Object.assign(this.currentTap, e); // tslint:disable-line: prefer-object-spread\n\t\t}\n\t\tthis.press(startTap);\n\n\t\tcurrent.tapFired = current.doubleTapFired = current.longTapFired = false;\n\t\tif (this.hasListener('longTap') && !this.repeat) {\n\t\t\twindow.clearTimeout(this.longTapTimeout);\n\t\t\tthis.longTapTimeout = window.setTimeout(() => {\n\t\t\t\tthis.lockId = interactionLock.requestLockOn(target as Node);\n\t\t\t\tif (this.lockId) {\n\t\t\t\t\tthis.longTap(startTap);\n\t\t\t\t\tcurrent.longTapFired = true;\n\t\t\t\t}\n\t\t\t}, LONG_TAP_TIMEOUT);\n\t\t}\n\n\t\taddListener(document, 'pointermove', this.onPointerMove, { context: this });\n\t\taddListener(document, 'pointerup', this.onPointerUp, { context: this });\n\t}\n\n\tprivate onPointerUp(e: SpurPointerEvent) {\n\t\tif (e.pointerId !== this.pointerId || this.cancelled) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.reset();\n\t\tthis.release(false);\n\n\t\tif (!current.longTapFired) {\n\t\t\tconst now = Date.now();\n\t\t\tconst tapDiff = now - this.lastTap;\n\t\t\tthis.lastTap = now;\n\n\t\t\tif (!current.tapFired && this.hasListener('tap')) {\n\t\t\t\tcurrent.tapFired = true;\n\t\t\t\tthis.tap(e);\n\t\t\t}\n\n\t\t\tif (tapDiff < DOUBLE_TAP_TIMEOUT) {\n\t\t\t\tthis.lastTap = 0;\n\t\t\t\tif (!current.doubleTapFired && this.hasListener('doubleTap')) {\n\t\t\t\t\tcurrent.doubleTapFired = true;\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tthis.doubleTap(e);\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic componentDidMount(DOMNode: HTMLElement) {\n\t\tthis.DOMNode = DOMNode;\n\t\taddListener(this.DOMNode, 'pointerdown', this.onPointerDown, { context: this });\n\t}\n\n\tpublic componentWillUnmount() {\n\t\tremoveListener(this.DOMNode!, 'pointerdown', this.onPointerDown, { context: this });\n\t\tthis.reset();\n\t\tthis.DOMNode = null;\n\t\twindow.clearTimeout(this.repeatTimeout);\n\t}\n}\n\nexport default ButtonPlugin;\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/spur/ButtonPlugin.ts","import * as React from 'react';\nimport Plugin from './Plugin';\n\nexport type Tag = keyof JSX.IntrinsicElements;\n\nexport type Props<E extends HTMLElement = HTMLElement>\n\t= React.HTMLAttributes<E> & {\n\tplugins: {[pluginId: string]: Plugin},\n\telementRef?: (instance: E) => any\n};\n\nexport interface IPlugComponent<E extends HTMLElement = HTMLElement>\n\textends React.Component<Props<E>, null> {\n\telement: E;\n}\n\nexport interface IPlugComponentClass<E extends HTMLElement = HTMLElement> {\n\tnew(props: Props<E>, context: any): IPlugComponent<E>;\n}\n\nexport abstract class PlugComponent<P extends { plugins: {[pluginId: string]: Plugin} }, S = {}>\n\textends React.PureComponent<P, S> {\n\n\tconstructor(props: P, context: any) {\n\t\tsuper(props, context);\n\n\t\tfor (const id in props.plugins) {\n\t\t\tconst plugin = props.plugins[id];\n\t\t\tplugin.setComponentInstance(this);\n\t\t}\n\t}\n\n\tpublic componentWillMount() {\n\t\tconst plugins = this.props.plugins;\n\t\tfor (const id in plugins) {\n\t\t\tconst plugin = plugins[id] as Plugin;\n\t\t\tplugin.componentWillMount();\n\t\t}\n\t}\n\n\tpublic componentDidMountWithElement(element: HTMLElement) {\n\t\tconst plugins = this.props.plugins;\n\t\tfor (const id in plugins) {\n\t\t\tconst plugin = plugins[id];\n\t\t\tplugin.componentDidMount(element);\n\t\t}\n\t}\n\n\tpublic componentWillReceiveProps(nextProps: P) {\n\t\tconst plugins = this.props.plugins;\n\t\tfor (const id in plugins) {\n\t\t\tconst plugin = plugins[id];\n\t\t\tplugin.componentWillReceiveProps(nextProps);\n\t\t}\n\t}\n\n\tpublic componentWillUpdate(nextProps: P) {\n\t\tconst plugins = this.props.plugins;\n\t\tfor (const id in plugins) {\n\t\t\tconst plugin = plugins[id];\n\t\t\tplugin.componentWillUpdate(nextProps);\n\t\t}\n\t}\n\n\tpublic componentDidUpdate() {\n\t\tconst plugins = this.props.plugins;\n\t\tfor (const id in plugins) {\n\t\t\tconst plugin = plugins[id];\n\t\t\tplugin.componentDidUpdate();\n\t\t}\n\t}\n\n\tpublic componentWillUnmount() {\n\t\tconst plugins = this.props.plugins;\n\t\tfor (const id in plugins) {\n\t\t\tconst plugin = plugins[id];\n\t\t\tplugin.componentWillUnmount();\n\t\t\tplugin.removeEventListeners();\n\t\t}\n\t}\n}\n\nexport function createPlugTagComponent<E extends HTMLElement = HTMLElement>(tag: Tag) {\n\n\t// tslint:disable:max-classes-per-file\n\treturn class PlugTagComponent extends PlugComponent<Props<E>> {\n\t\tpublic element: E | null = null;\n\n\t\tconstructor(props: Props<E>, context: any) {\n\t\t\tsuper(props, context);\n\n\t\t\tthis.onRef = this.onRef.bind(this);\n\t\t}\n\n\t\tpublic componentDidMount() {\n\t\t\tthis.componentDidMountWithElement(this.element!);\n\t\t}\n\n\t\tprivate onRef(instance: E) {\n\t\t\tthis.element = instance;\n\t\t\tif (this.props.elementRef) {\n\t\t\t\tthis.props.elementRef(instance);\n\t\t\t}\n\t\t}\n\n\t\tpublic render() {\n\t\t\tconst ThisTag = tag as any;\n\t\t\tconst { children, plugins, elementRef, ...props } = this.props;\n\t\t\treturn(\n\t\t\t\t<ThisTag { ...props } ref={ this.onRef }>\n\t\t\t\t\t{ children }\n\t\t\t\t</ThisTag>\n\t\t\t);\n\t\t}\n\t};\n}\n\nexport const Pdiv = createPlugTagComponent<HTMLDivElement>('div');\nexport const Pspan = createPlugTagComponent<HTMLSpanElement>('span');\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/spur/Factory.tsx","abstract class Plugin<P extends {[eventName: string]: any} = {}> {\n\tpublic setComponentInstance(component: React.Component<any, any>): void {\n\t\t//\n\t}\n\n\tpublic componentDidMount(Element: HTMLElement): void {\n\t\t//\n\t}\n\n\tpublic componentWillMount(): void {\n\t\t//\n\t}\n\n\tpublic componentWillReceiveProps(nextProps: any): void {\n\t\t//\n\t}\n\n\tpublic componentWillUpdate(nextProps: any): void {\n\t\t//\n\t}\n\n\tpublic componentDidUpdate(): void {\n\t\t//\n\t}\n\n\tpublic componentWillUnmount(): void {\n\t\t//\n\t}\n\n\tprivate listeners: {[T in keyof P]: Array<{ callback: (arg: P[T]) => void, context: any }>} = {} as any;\n\n\tpublic on<T extends keyof P, C>(eventName: T, callback: (this: C, arg: P[T]) => void, context: C | this = this) {\n\t\tif (eventName in this.listeners) {\n\t\t\tthis.listeners[eventName].push({ callback, context });\n\t\t} else {\n\t\t\tthis.listeners[eventName] = [{ callback, context }];\n\t\t}\n\t}\n\n\tpublic removeEventListeners() {\n\t\tthis.listeners = {} as any;\n\t}\n\n\tprotected emit<T extends keyof P>(eventName: T, arg: P[T]) {\n\t\tconst listeners = this.listeners[eventName];\n\t\tif (listeners) {\n\t\t\tfor (let i = 0, len = listeners.length; i < len; i += 1) {\n\t\t\t\tconst listener = listeners[i];\n\t\t\t\tlistener.callback.call(listener.context, arg);\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic hasListener(eventName: keyof P): boolean {\n\t\treturn !!this.listeners[eventName];\n\t}\n}\n\nexport default Plugin;\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/spur/Plugin.ts","import { EventEmitter } from 'events';\n\nclass InteractionLock extends EventEmitter {\n\tprivate lockNodes: { [lockId: number]: Node } = {};\n\tprivate lockContainerNodes: { [lockId: number]: Node } = {};\n\tprivate lockId = 0;\n\n\tpublic isLocked(DOMNode: Node): boolean {\n\t\tfor (const id in this.lockNodes) {\n\t\t\tlet node: Node | null = this.lockNodes[id];\n\t\t\twhile (node !== null) {\n\t\t\t\tif (node === DOMNode) { return true; }\n\t\t\t\tnode = node.parentNode;\n\t\t\t}\n\t\t}\n\n\t\tfor (const id in this.lockContainerNodes) {\n\t\t\tconst container = this.lockContainerNodes[id];\n\t\t\tlet parent: Node | null = DOMNode;\n\t\t\twhile (parent !== null) {\n\t\t\t\tif (parent === container) { return true; }\n\t\t\t\tparent = parent.parentNode;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tpublic requestLockOn(DOMNode: Node): number | null {\n\t\tif (this.isLocked(DOMNode)) { return null; }\n\n\t\tthis.lockId += 1;\n\t\tthis.lockNodes[this.lockId] = DOMNode;\n\t\tthis.emit('element-lock', DOMNode);\n\t\treturn this.lockId;\n\t}\n\n\tpublic requestContainerLockOn(DOMNode: Node): number | null {\n\t\tif (this.isLocked(DOMNode)) { return null; }\n\n\t\tthis.lockId += 1;\n\t\tthis.lockContainerNodes[this.lockId] = DOMNode;\n\t\tthis.emit('container-lock', DOMNode);\n\t\treturn this.lockId;\n\t}\n\n\tpublic releaseLock(id: number) {\n\t\tconst DOMNode = this.lockNodes[id] || this.lockContainerNodes[id];\n\t\tif (DOMNode) {\n\t\t\tdelete this.lockNodes[id];\n\t\t\tdelete this.lockContainerNodes[id];\n\t\t\tthis.lockId -= 1;\n\t\t\tthis.emit('unlock', DOMNode);\n\t\t}\n\t}\n}\n\nexport default new InteractionLock();\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/spur/interactionLock.ts","import * as React from 'react';\nimport * as uuid from 'uuid/v4';\n\nimport CreateSessionAction from 'shared/actions/CreateSession';\n\nimport Button from 'shared/components/Button';\nimport TextField from 'shared/components/TextField';\nimport { Context, contextTypes } from 'shared/context';\n\nimport './CreateSession.less';\n\nexport type Props = {\n\tnavigateToSession(sessionId: string): void\n};\n\nclass CreateSession extends React.PureComponent<Props> {\n\tpublic context!: Context;\n\tpublic static contextTypes = contextTypes;\n\tprivate sessionNameField!: TextField | null;\n\n\tprivate createSession = () => {\n\t\tconst sessionId = 'session-' + uuid();\n\t\tconst store = this.context.store;\n\t\tstore.executeAction(new CreateSessionAction(\n\t\t\tsessionId,\n\t\t\tthis.sessionNameField!.getValue(),\n\t\t\tstore.userId\n\t\t));\n\t\tstore.openSession(sessionId);\n\t\tthis.props.navigateToSession(sessionId);\n\t}\n\n\tpublic render() {\n\t\treturn (\n\t\t\t<div className='CreateSession'>\n\t\t\t\t<div className='view__explanation'>Create a session to allow another device to connect.</div>\n\t\t\t\t<div className='view__box'>\n\t\t\t\t\t<div className='view__column'>\n\t\t\t\t\t\t<TextField\n\t\t\t\t\t\t\tlabel='choose a name for your session'\n\t\t\t\t\t\t\tplaceholder='My session'\n\t\t\t\t\t\t\tref={ ref => this.sessionNameField = ref }\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className='view__column CreateSession__create-column'>\n\t\t\t\t\t\t<Button className='action-button  CreateSession__Create' onTap={ this.createSession }>\n\t\t\t\t\t\t\tCreate\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nexport default CreateSession;\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/views/CreateSession.tsx","import * as React from 'react';\n\nimport Button from 'shared/components/Button';\nimport SessionScanner from 'shared/components/SessionScanner';\nimport { Context, contextTypes } from 'shared/context';\n\nimport './JoinSession.less';\n\nexport type Props = {\n\tnavigateToSession(sessionId: string): void\n};\n\ntype State = {\n\tisScanning: boolean\n};\n\nclass JoinSession extends React.PureComponent<Props, State> {\n\tpublic context!: Context;\n\tpublic static contextTypes = contextTypes;\n\tprivate scanner: SessionScanner | null = null;\n\tprivate input: HTMLInputElement | null = null;\n\n\tconstructor(props: Props, context: Context) {\n\t\tsuper(props, context);\n\n\t\tthis.state = {\n\t\t\tisScanning: false\n\t\t};\n\t}\n\n\tprivate onSessionScanned = (sessionId: string) => {\n\t\tthis.setState({ isScanning: false });\n\t\tthis.join(sessionId);\n\t}\n\n\tprivate stopScanning = () => {\n\t\tthis.setState({ isScanning: false }, () => this.scanner!.stop());\n\t}\n\n\tprivate startScanning = () => {\n\t\ttry {\n\t\t\tthis.scanner!.scan();\n\t\t\tthis.setState({ isScanning: true });\n\t\t} catch {\n\t\t\t//\n\t\t}\n\t}\n\n\tprivate validateSession = () => {\n\t\tconst sessionId = this.input!.value;\n\t\tthis.join(sessionId);\n\t}\n\n\tprivate join(sessionId: string) {\n\t\tthis.context.store.join(sessionId);\n\t\tthis.props.navigateToSession(sessionId);\n\t}\n\n\tpublic render() {\n\t\tconst { isScanning } = this.state;\n\n\t\treturn (\n\t\t\t<div className={ 'JoinSession' + (isScanning ? ' JoinSession_scanning' : '') }>\n\t\t\t\t<div className='view__explanation'>Join an existing session by scanning its QR code or entering its ID.</div>\n\t\t\t\t<div className='view__box'>\n\t\t\t\t\t<div className='view__header'>Scan a QR Code</div>\n\t\t\t\t\t<Button onTap={ this.startScanning } className='action-button'>Start Scanning</Button>\n\t\t\t\t\t<div className='JoinSession__scanner'>\n\t\t\t\t\t\t<SessionScanner onSessionScanned={ this.onSessionScanned } ref={ ref => this.scanner = ref } />\n\t\t\t\t\t\t<Button onTap={ this.stopScanning } className='action-button JoinSession__StopScanning'>Stop Scanning</Button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div className='view__box'>\n\t\t\t\t\t<div className='view__header'>Enter a session ID</div>\n\t\t\t\t\t<input className='JoinSession__id-input' ref={ ref => this.input = ref } />\n\t\t\t\t\t<Button onTap={ this.validateSession } className='action-button'>Join</Button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nexport default JoinSession;\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/views/JoinSession.tsx","import { observer } from 'mobx-react';\nimport * as React from 'react';\n\nimport SessionItem from 'shared/components/SessionItem';\nimport { Context, contextTypes } from 'shared/context';\n\nexport type Props = {\n\tnavigateToSession(sessionId: string): void\n};\n\n@observer\nclass Sessions extends React.Component<Props> {\n\tpublic context!: Context;\n\tpublic static contextTypes = contextTypes;\n\n\tprivate onEnterSession = (sessionId: string) => {\n\t\t//\n\t}\n\n\tpublic render() {\n\t\tconst store = this.context.store;\n\t\tconst sessionList = store.sessionList;\n\n\t\treturn (\n\t\t\t<div className='Sessions'>\n\t\t\t\t{ sessionList.map(sessionId => <SessionItem\n\t\t\t\t\tsessionId={ sessionId }\n\t\t\t\t\tkey={ sessionId }\n\t\t\t\t\tonEnterSession={ this.onEnterSession }\n\t\t\t\t/>) }\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nexport default Sessions;\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/views/Sessions.tsx","import { observer } from 'mobx-react';\n\nimport { Context, contextTypes } from 'shared/context';\n\nexport type TabId = 'sessions' | 'create' | 'join';\n\n// https://github.com/DefinitelyTyped/DefinitelyTyped/issues/20544\nconst SessionLabel: React.StatelessComponent = observer(function (this: { context: Context }) {\n\tconst sessions = this.context.store.sessionList;\n\treturn ('My sessions' + (sessions.length ? ` (${sessions.length})` : '' )) as any;\n});\nSessionLabel.contextTypes = contextTypes;\n\nexport const TabMap: {[tabId in TabId]: React.StatelessComponent}  = {\n\tsessions: SessionLabel,\n\tcreate: () => 'Create Session' as any,\n\tjoin: () => 'Join Session' as any\n};\n\nexport const TabOrder: TabId[] = ['sessions', 'create', 'join'];\nexport const TabsInfo = TabOrder.map(tabId => ({ tabId, Label: TabMap[tabId] }));\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/views/tabs.tsx"],"sourceRoot":""}
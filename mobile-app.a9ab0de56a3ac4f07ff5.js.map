{"version":3,"sources":["webpack:///./src/mobile/app.tsx","webpack:///./src/mobile/views/Home.tsx","webpack:///./src/shared/GatewayClient.ts","webpack:///./src/shared/RTCClient.ts","webpack:///./src/shared/components/Button.tsx","webpack:///./src/shared/components/SessionDisplay.tsx","webpack:///./src/shared/components/SessionScanner.tsx","webpack:///./src/shared/spur/ButtonPlugin.ts","webpack:///./src/shared/spur/Factory.tsx","webpack:///./src/shared/spur/Plugin.ts","webpack:///./src/shared/spur/interactionLock.ts"],"names":["React","__webpack_require__","ReactDOM","Home_1","localStorage","setItem","render","createElement","default","document","getElementById","Button_1","SessionDisplay_1","SessionScanner_1","RTCClient_1","exports","PureComponent","[object Object]","props","context","super","this","onSessionScanned","sessionId","client","connectTo","className","debug","events_1","SocketIO","log","EventEmitter","socket","transports","autoConnect","on","fromId","data","emit","error","localId","connected","Promise","resolve","reject","connect","once","removeListener","isConnected","id","disconnect","remoteId","GatewayClient_1","sendChannel","sessionCreating","sessionCreated","onGatewayMessage","msg","__awaiter","type","pc","setRemoteDescription","RTCSessionDescription","sessionDescription","createAnswer","setLocalDescription","gatewayClient","send","candidate","RTCIceCandidate","sdpMLineIndex","addIceCandidate","onSendChannelOpen","e","setupDataChannel","onSendChannelClose","onDataChannel","channel","onLocalIceCandidate","sdpMid","RTCPeerConnection","iceServers","urls","onicecandidate","ondatachannel","createDataChannel","onopen","onclose","createOffer","window","sendMessage","JSON","stringify","onmessage","event","console","parse","ButtonPlugin_1","Factory_1","onTap","onDoubleTap","button","plugins","setEnable","disabled","repeat","nextProps","hasListener","children","style","elementRef","Pdiv","QRCode","onSessionStarted","setState","onSessionStopped","undefined","createSession","startSession","state","value","size","Instascan","videoElt","scan","isScanning","Camera","getCameras","then","cameras","length","scanner","start","catch","stopScanning","stop","Scanner","video","mirror","addListener","content","onClick","ref","spur_events_1","interactionLock_1","Plugin_1","onLock","DOMNode","current","forEach","plugin","longTapFired","cancel","tapFired","doubleTapFired","LONG_TAP_TIMEOUT","DOUBLE_TAP_TIMEOUT","MIN_TAP_DISTANCE","options","enable","lockId","lastTap","currentTap","pointerId","cancelled","longTapTimeout","boundingBox","left","top","width","height","minBoxWidth","minBoxHeight","isPressed","repeatTimeout","repeatCount","Math","max","coords","repeatTap","releaseLock","clearTimeout","onPointerMove","onPointerUp","time","setTimeout","tap","release","reset","clientX","clientY","originalEvent","which","isLocked","target","push","startTap","x","y","getBoundingClientRect","SpurEvent","Object","assign","press","requestLockOn","longTap","now","Date","tapDiff","preventDefault","doubleTap","onPointerDown","PlugComponent","setComponentInstance","componentWillMount","element","componentDidMount","componentWillReceiveProps","componentWillUpdate","componentDidUpdate","componentWillUnmount","removeEventListeners","createPlugTagComponent","tag","onRef","bind","componentDidMountWithElement","instance","ThisTag","_a","__rest","Pspan","listeners","component","Element","eventName","callback","arg","i","len","listener","call","lockNodes","lockContainerNodes","node","parentNode","container","parent"],"mappings":"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","file":"mobile-app.a9ab0de56a3ac4f07ff5.js","sourcesContent":["import * as React from 'react';\nimport * as ReactDOM from 'react-dom';\nimport Home from './views/Home';\n\nlocalStorage.setItem('debug', 'swift*');\n\nReactDOM.render(<Home />, document.getElementById('swift'));\n\n\n\n// WEBPACK FOOTER //\n// ./src/mobile/app.tsx","import * as React from 'react';\nimport Button from 'shared/components/Button';\nimport SessionDisplay from 'shared/components/SessionDisplay';\nimport SessionScanner from 'shared/components/SessionScanner';\nimport RTCClient from 'shared/RTCClient';\nimport './Home.less';\n\nexport type Props = {};\n\ntype State = {};\n\nclass Home extends React.PureComponent<Props, State> {\n\tprivate client: RTCClient;\n\n\tconstructor(props: Props, context: any) {\n\t\tsuper(props, context);\n\n\t\tthis.client = new RTCClient();\n\t}\n\n\tprivate onSessionScanned = (sessionId: string) => {\n\t\tthis.client.connectTo(sessionId);\n\t}\n\n\tpublic render() {\n\t\treturn (\n\t\t\t<div className='home'>\n\t\t\t\t<SessionDisplay client={ this.client } />\n\t\t\t\t<SessionScanner onSessionScanned={ this.onSessionScanned } />\n\t\t\t\t<Button />\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nexport default Home;\n\n\n\n// WEBPACK FOOTER //\n// ./src/mobile/views/Home.tsx","import * as debug from 'debug-logger';\nimport { EventEmitter } from 'events';\nimport * as SocketIO from 'socket.io-client';\nconst log = debug('swift:GatewayClient');\n\nclass GatewayClient<T> extends EventEmitter {\n\tprivate socket: SocketIOClient.Socket;\n\n\tconstructor() {\n\t\tsuper();\n\t\tthis.socket = SocketIO(__SOCKET_END_POINT__, { transports: ['websocket'], autoConnect: false });\n\n\t\tthis.socket.on('data', (fromId: string, data: T) => {\n\t\t\tlog('received data', data);\n\t\t\tthis.emit('message', fromId, data);\n\t\t});\n\t\tthis.socket.on('error', (error: any) => log(error));\n\t\tthis.socket.on('disconnect', () => {\n\t\t\tlog(`${this.localId}: Disconnected from the gateway`);\n\t\t\tthis.emit('disconnected');\n\t\t});\n\t}\n\n\tpublic connect(): Promise<void> {\n\t\tif (this.socket.connected) { return Promise.resolve(); }\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis.socket.connect();\n\n\t\t\tthis.socket.once('connect', () => {\n\t\t\t\tlog(`${this.localId}: Connected to the gateway`);\n\t\t\t\tthis.socket.removeListener('connect_error');\n\t\t\t\tthis.socket.removeListener('connect_timeout');\n\t\t\t\tresolve();\n\t\t\t});\n\t\t\tthis.socket.once('connect_error', reject);\n\t\t\tthis.socket.once('connect_timeout', reject);\n\t\t});\n\t}\n\n\tget isConnected(): boolean { return this.socket.connected; }\n\n\tget localId(): string { return this.socket.id; }\n\n\tpublic disconnect() {\n\t\tif (!this.socket.connected) { return; }\n\t\tthis.socket.disconnect();\n\t\tthis.socket.removeListener('connect_error');\n\t\tthis.socket.removeListener('connect_timeout');\n\t}\n\n\tpublic send(remoteId: string, data: T) {\n\t\tlog('sending', data, 'to', remoteId);\n\t\tthis.socket.emit('data', remoteId, data);\n\t}\n}\n\nexport default GatewayClient;\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/GatewayClient.ts","import * as debug from 'debug-logger';\nimport { EventEmitter } from 'events';\nimport GatewayClient from 'shared/GatewayClient';\nconst log = debug('swift:RTCClient');\n\ntype Message =\n\t{ type: 'offer', sessionDescription: RTCSessionDescriptionInit } |\n\t{ type: 'answer', sessionDescription: RTCSessionDescriptionInit } |\n\t{ type: 'candidate', candidate: RTCIceCandidateInit };\n\nclass RTCClient extends EventEmitter {\n\tprivate pc: RTCPeerConnection;\n\t// private remoteConnection: RTCPeerConnection;\n\tprivate sendChannel: RTCDataChannel | null = null;\n\tprivate gatewayClient: GatewayClient<Message>;\n\tprivate remoteId: string = '';\n\tpublic sessionCreating = false;\n\tpublic sessionCreated = false;\n\n\tconstructor() {\n\t\tsuper();\n\t\tthis.gatewayClient = new GatewayClient();\n\t\tthis.gatewayClient.on('message', this.onGatewayMessage);\n\t\tthis.gatewayClient.on('disconnected', () => {\n\t\t\tthis.sessionCreating = false;\n\t\t\tif (this.sessionCreated) {\n\t\t\t\tthis.sessionCreated = false;\n\t\t\t\tthis.emit('sessionStopped');\n\t\t\t}\n\t\t});\n\n\t\tthis.pc = new RTCPeerConnection({\n\t\t\ticeServers: [{ urls: 'stun:stun.l.google.com:19302' }]\n\t\t});\n\t\tthis.pc.onicecandidate = this.onLocalIceCandidate;\n\t\tthis.pc.ondatachannel = this.onDataChannel;\n\t}\n\n\tget localId(): string { return this.gatewayClient.localId; }\n\n\tpublic async startSession() {\n\t\tif (this.sessionCreating) { return; }\n\t\tthis.sessionCreating = true;\n\t\tawait this.gatewayClient.connect();\n\t\tthis.sessionCreating = false;\n\t\tthis.sessionCreated = true;\n\t\tthis.emit('sessionStarted', this.gatewayClient.localId);\n\t}\n\n\tpublic async connectTo(remoteId: string) {\n\t\tlog('connectTo', remoteId);\n\t\tif (this.gatewayClient.isConnected) {\n\t\t\tawait this.gatewayClient.connect();\n\t\t}\n\t\tthis.sendChannel = this.pc.createDataChannel('Swift Data Channel');\n\t\tthis.sendChannel.onopen = this.onSendChannelOpen;\n\t\tthis.sendChannel.onclose = this.onSendChannelClose;\n\n\t\tthis.remoteId = remoteId;\n\t\tlog('create offer');\n\t\tconst sessionDescription = await this.pc.createOffer() as any;\n\t\tlog('offer created');\n\t\tawait this.pc.setLocalDescription(sessionDescription);\n\t\tthis.gatewayClient.send(remoteId, { type: 'offer', sessionDescription });\n\t}\n\n\tprivate onGatewayMessage = async (fromId: string, msg: Message) => {\n\t\tthis.remoteId = fromId;\n\t\tif (msg.type === 'offer') {\n\t\t\tthis.pc.setRemoteDescription(new RTCSessionDescription(msg.sessionDescription));\n\t\t\tconst sessionDescription = await this.pc.createAnswer() as any;\n\t\t\tthis.pc.setLocalDescription(sessionDescription);\n\t\t\tthis.gatewayClient.send(fromId, { type: 'answer', sessionDescription });\n\t\t} else if (msg.type === 'answer') {\n\t\t\tthis.pc.setRemoteDescription(msg.sessionDescription);\n\t\t} else if (msg.type === 'candidate') {\n\t\t\tconst candidate = new RTCIceCandidate({\n\t\t\t\tsdpMLineIndex: msg.candidate.sdpMLineIndex,\n\t\t\t\tcandidate: msg.candidate.candidate\n\t\t\t});\n\t\t\tthis.pc.addIceCandidate(candidate);\n\t\t}\n\t}\n\n\tprivate onSendChannelOpen = (e: Event) => {\n\t\tlog('data channel opened');\n\t\tthis.setupDataChannel();\n\t}\n\n\tprivate onSendChannelClose = (e: Event) => {\n\t\tlog('onSendChannelClose', e);\n\t}\n\n\tprivate onDataChannel = (e: RTCDataChannelEvent) => {\n\t\tlog('data channel opened');\n\t\tthis.sendChannel = e.channel;\n\t\tthis.setupDataChannel();\n\t}\n\n\tprivate setupDataChannel() {\n\t\t(window as any).sendMessage = (data: any) => {\n\t\t\tthis.sendChannel!.send(JSON.stringify(data));\n\t\t};\n\n\t\tthis.sendChannel!.onmessage = (event) => {\n\t\t\tconsole.log(JSON.parse(event.data)); // tslint:disable-line\n\t\t};\n\t}\n\n\tprivate onLocalIceCandidate = (e: RTCPeerConnectionIceEvent) => {\n\t\tif (!e.candidate) { return; }\n\n\t\tthis.gatewayClient.send(this.remoteId, {\n\t\t\ttype: 'candidate',\n\t\t\tcandidate: {\n\t\t\t\tsdpMLineIndex: e.candidate.sdpMLineIndex,\n\t\t\t\tsdpMid: e.candidate.sdpMid,\n\t\t\t\tcandidate: e.candidate.candidate\n\t\t\t} as RTCIceCandidateInit\n\t\t});\n\t}\n}\n\nexport default RTCClient;\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/RTCClient.ts","import * as React from 'react';\nimport ButtonPlugin from 'shared/spur/ButtonPlugin';\nimport { Pdiv } from 'shared/spur/Factory';\nimport { SpurPointerEvent } from 'spur-events';\nimport './Button.less';\n\nexport interface IButtonClass<P> {\n\tnew (props?: Props<P>, context?: any): Button<P>;\n\tprototype: Button<P>;\n}\n\nexport type Props<P = {}> = {\n\trepeat?: boolean,\n\tdisabled?: boolean,\n\tclassName?: string,\n\tstyle?: React.CSSProperties,\n\telementRef?: (ref: HTMLDivElement | undefined) => void,\n\tonTap?: (component: Button<P>, e: SpurPointerEvent) => void,\n\tonDoubleTap?: (component: Button<P>, e: SpurPointerEvent) => void,\n} & P;\n\nclass Button<P = {}> extends React.PureComponent<Props<P>> {\n\tprivate plugins: { button: ButtonPlugin };\n\n\tconstructor(props: Props<P>, context: any) {\n\t\tsuper(props, context);\n\n\t\tconst button = new ButtonPlugin();\n\t\tthis.plugins = { button };\n\t\tbutton.setEnable(!props.disabled);\n\t\tbutton.repeat = !!props.repeat;\n\n\t\tif (this.props.onTap) { button.on('tap', this.onTap); }\n\t\tif (this.props.onDoubleTap) { button.on('doubleTap', this.onDoubleTap); }\n\t}\n\n\tpublic componentWillReceiveProps(nextProps: Props<P>) {\n\t\tconst button = this.plugins.button;\n\t\tbutton.setEnable(!nextProps.disabled);\n\t\tbutton.repeat = !!nextProps.repeat;\n\n\t\tif (nextProps.onTap && !button.hasListener('tap')) { button.on('tap', this.onTap); }\n\t\tif (nextProps.onDoubleTap && !button.hasListener('doubleTap')) { button.on('doubleTap', this.onDoubleTap); }\n\t}\n\n\tprivate onTap = (e: SpurPointerEvent) => {\n\t\tthis.props.onTap!(this, e);\n\t}\n\n\tprivate onDoubleTap = (e: SpurPointerEvent) => {\n\t\tthis.props.onDoubleTap!(this, e);\n\t}\n\n\tpublic render() {\n\t\tconst { className, disabled, children, style } = this.props;\n\n\t\tconst cn =\n\t\t\t'button' +\n\t\t\t(className ? ' ' + className : '') +\n\t\t\t(disabled ? ' disabled' : '');\n\n\t\tconst props = {\n\t\t\tclassName: cn,\n\t\t\telementRef: this.props.elementRef,\n\t\t\tplugins: this.plugins,\n\t\t\tstyle\n\t\t};\n\n\t\treturn React.createElement(Pdiv, props, children);\n\t}\n}\n\nexport default Button;\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/components/Button.tsx","import * as QRCode from 'qrcode.react';\nimport * as React from 'react';\nimport Button from 'shared/components/Button';\nimport RTCClient from 'shared/RTCClient';\n\nexport type Props = {\n\tclient: RTCClient\n};\n\ntype State = {\n\tsessionCreating: boolean,\n\tsessionId?: string\n};\n\nclass SessionDisplay extends React.PureComponent<Props, State> {\n\tconstructor(props: Props, context: any) {\n\t\tsuper(props, context);\n\n\t\tthis.state = {\n\t\t\tsessionCreating: props.client.sessionCreating,\n\t\t\tsessionId: props.client.localId\n\t\t};\n\t}\n\n\tpublic componentWillMount() {\n\t\tthis.props.client.on('sessionStarted', this.onSessionStarted);\n\t\tthis.props.client.on('sessionEnd', this.onSessionStopped);\n\t}\n\n\tpublic componentWillUnmount() {\n\t\tthis.props.client.removeListener('sessionStarted', this.onSessionStarted);\n\t\tthis.props.client.removeListener('onSessionStopped', this.onSessionStarted);\n\t}\n\n\tprivate onSessionStarted = (sessionId: string) => {\n\t\tthis.setState({ sessionId, sessionCreating: false });\n\t}\n\n\tprivate onSessionStopped = () => {\n\t\tthis.setState({ sessionId: undefined, sessionCreating: false });\n\t}\n\n\tprivate createSession = () => {\n\t\tthis.props.client.startSession();\n\t\tthis.setState({ sessionCreating: true });\n\t}\n\n\tpublic render() {\n\t\tconst { sessionId, sessionCreating } = this.state;\n\n\t\treturn (\n\t\t\t<div className='session-display'>\n\t\t\t\t{ sessionCreating && 'Creating a session...' }\n\t\t\t\t{ sessionId ?\n\t\t\t\t\t<div className='session-display__qr-area'>\n\t\t\t\t\t\t<QRCode value={ sessionId } size={ 256 } />\n\t\t\t\t\t\t<div className='session-display__id'>{ 'id: ' + sessionId }</div>\n\t\t\t\t\t</div>\n\t\t\t\t: <Button onTap={ this.createSession }>Create Session</Button> }\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nexport default SessionDisplay;\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/components/SessionDisplay.tsx","import * as debug from 'debug-logger';\nimport * as Instascan from 'instascan';\nimport * as React from 'react';\nconst log = debug('swift:SessionScanner');\n\nexport type Props = {\n\tonSessionScanned: (sessionId: string) => void\n};\n\ntype State = {\n\tisScanning: boolean\n};\n\nclass SessionDisplay extends React.PureComponent<Props, State> {\n\tprivate videoElt: HTMLVideoElement | null = null;\n\tprivate scanner: any;\n\n\tconstructor (props: Props, context: any) {\n\t\tsuper(props, context);\n\n\t\tthis.state = { isScanning: false };\n\t}\n\n\tpublic componentDidMount () {\n\t\tthis.scanner = new Instascan.Scanner({ video: this.videoElt, mirror: false });\n\t\tthis.scanner.addListener('scan', (content: string) => {\n\t\t\tthis.scanner.stop();\n\t\t\tthis.setState({ isScanning: false }, () => this.props.onSessionScanned(content));\n\t\t});\n\t}\n\n\tprivate scan = () => {\n\t\tthis.setState({ isScanning: true }, () => {\n\n\t\t\tInstascan.Camera.getCameras().then((cameras: any[]) => {\n\t\t\t\tif (cameras.length > 0) {\n\t\t\t\t\tthis.scanner.start(cameras[1] || cameras[0]);\n\t\t\t\t} else {\n\t\t\t\t\tthis.setState({ isScanning: false });\n\t\t\t\t\tlog('No cameras found.');\n\t\t\t\t}\n\t\t\t}).catch((e: any) => {\n\t\t\t\tthis.setState({ isScanning: false });\n\t\t\t\tlog(e);\n\t\t\t});\n\t\t});\n\t}\n\n\tprivate stopScanning = () => {\n\t\tthis.scanner.stop();\n\t}\n\n\tpublic render () {\n\t\tconst { isScanning } = this.state;\n\n\t\treturn (\n\t\t\t<div className='session-scanner'>\n\t\t\t\t{ isScanning\n\t\t\t\t\t? <button onClick={ this.stopScanning }>Stop scanning</button>\n\t\t\t\t\t: <button onClick={ this.scan }>scan QR code</button>\n\t\t\t\t}\n\t\t\t\t<video ref={ ref => this.videoElt = ref } />\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nexport default SessionDisplay;\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/components/SessionScanner.tsx","import { addListener, removeListener, SpurEvent, SpurPointerEvent } from 'spur-events';\nimport interactionLock from './interactionLock';\nimport Plugin from './Plugin';\n\ninterface IButtonPlugin {\n\tcancel(): void;\n\tDOMNode: HTMLElement | null;\n}\n\nexport const current: {\n\tplugins: IButtonPlugin[],\n\ttapFired: boolean,\n\tdoubleTapFired: boolean,\n\tlongTapFired: boolean\n} = { plugins: [], tapFired: false, doubleTapFired: false, longTapFired: false };\n\naddListener(window, 'pointerup', function(e: SpurPointerEvent) {\n\tcurrent.plugins = [];\n});\n\nfunction onLock(DOMNode: HTMLElement) {\n\tif (current.plugins.length) {\n\t\tcurrent.plugins.forEach(plugin => {\n\t\t\tif (!current.longTapFired || DOMNode !== plugin.DOMNode) { plugin.cancel(); }\n\t\t});\n\t\tcurrent.plugins = [];\n\t}\n}\n\ninteractionLock.on('element-lock', onLock);\ninteractionLock.on('container-lock', onLock);\n\ntype Coords = { x: number, y: number };\n\nconst LONG_TAP_TIMEOUT = 700;\nconst DOUBLE_TAP_TIMEOUT = 300;\nconst MIN_TAP_DISTANCE = 15;\n\nexport type Events = {\n\tpress: Coords,\n\trelease: boolean,\n\ttap: SpurPointerEvent,\n\tdoubleTap: SpurPointerEvent,\n\tlongTap: Coords\n};\n\nclass ButtonPlugin extends Plugin<Events> {\n\tprivate enable = true;\n\tprivate lockId: number | null = null;\n\tprivate lastTap = 0;\n\tprivate currentTap: SpurPointerEvent | null = null;\n\tprivate pointerId: string = '';\n\tprivate cancelled: boolean = false;\n\tprivate longTapTimeout: number = 0;\n\tprivate boundingBox = { left: 0, top: 0, width: 0, height: 0 };\n\tpublic DOMNode: HTMLElement | null = null;\n\tprivate minBoxWidth = MIN_TAP_DISTANCE;\n\tprivate minBoxHeight = MIN_TAP_DISTANCE;\n\tprivate isPressed = false;\n\tprivate repeatTimeout: number = 0;\n\tprivate repeatCount = 0;\n\tpublic repeat = false;\n\n\tconstructor(options: { repeat?: boolean } = {}) {\n\t\tsuper();\n\n\t\tthis.repeat = !!options.repeat;\n\t}\n\n\tpublic setMinBoxDimensions(width: number, height: number) {\n\t\tthis.minBoxWidth = Math.max(width, MIN_TAP_DISTANCE);\n\t\tthis.minBoxHeight = Math.max(height, MIN_TAP_DISTANCE);\n\t}\n\n\tprivate press(coords: Coords) {\n\t\tthis.isPressed = true;\n\t\tif (this.repeat) {\n\t\t\tthis.repeatCount = 0;\n\t\t\tthis.repeatTap();\n\t\t}\n\t\tthis.emit('press', coords);\n\t}\n\n\tprivate release(cancelled: boolean) {\n\t\tthis.isPressed = false;\n\t\tthis.emit('release', cancelled);\n\t}\n\n\tprivate tap(e: SpurPointerEvent) {\n\t\tthis.emit('tap', e);\n\t}\n\n\tprivate doubleTap(e: SpurPointerEvent) {\n\t\tthis.emit('doubleTap', e);\n\t}\n\n\tprivate longTap(coords: Coords) {\n\t\tthis.emit('longTap', coords);\n\t}\n\n\tpublic setEnable(enable: boolean) {\n\t\tthis.enable = enable;\n\t}\n\n\tprivate reset() {\n\t\tif (this.lockId) {\n\t\t\tinteractionLock.releaseLock(this.lockId);\n\t\t\tthis.lockId = null;\n\t\t}\n\t\twindow.clearTimeout(this.repeatTimeout);\n\t\twindow.clearTimeout(this.longTapTimeout);\n\t\tremoveListener(document, 'pointermove', this.onPointerMove, { context: this });\n\t\tremoveListener(document, 'pointerup', this.onPointerUp, { context: this });\n\t}\n\n\tprivate repeatTap() {\n\t\tconst time = this.repeatCount === 0 ? 300 : 20;\n\n\t\tthis.repeatTimeout = window.setTimeout(() => {\n\t\t\tthis.repeatCount += 1;\n\t\t\tthis.tap(this.currentTap!);\n\t\t\tthis.repeatTap();\n\t\t}, time);\n\t}\n\n\tpublic cancel() {\n\t\tif (this.isPressed) {\n\t\t\tthis.cancelled = true;\n\t\t\tthis.release(true);\n\t\t}\n\n\t\tthis.reset();\n\t}\n\n\tprivate onPointerMove(e: SpurPointerEvent) {\n\t\tif (e.pointerId !== this.pointerId) { return; }\n\t\tif (e.clientX < this.boundingBox.left ||\n\t\t\te.clientX > this.boundingBox.left + this.boundingBox.width ||\n\t\t\te.clientY < this.boundingBox.top ||\n\t\t\te.clientY > this.boundingBox.top + this.boundingBox.height) {\n\t\t\tthis.cancel();\n\t\t}\n\t}\n\n\tprivate onPointerDown(e: SpurPointerEvent) {\n\t\tif (!this.enable || (e.originalEvent as MouseEvent).which === 3 || interactionLock.isLocked(e.target as Node)) {\n\t\t\treturn;\n\t\t}\n\n\t\tcurrent.plugins.push(this);\n\t\tthis.pointerId = e.pointerId;\n\n\t\tthis.cancelled = false;\n\t\tconst startTap = {\n\t\t\tx: e.clientX,\n\t\t\ty: e.clientY\n\t\t};\n\n\t\tconst target = e.target;\n\n\t\tconst boundingBox = this.DOMNode!.getBoundingClientRect();\n\t\tthis.boundingBox.top = boundingBox.top;\n\t\tthis.boundingBox.left = boundingBox.left;\n\t\tif (boundingBox.width < this.minBoxWidth) {\n\t\t\tthis.boundingBox.width = this.minBoxWidth;\n\t\t\tthis.boundingBox.left -= (this.minBoxWidth - boundingBox.width) / 2;\n\t\t} else {\n\t\t\tthis.boundingBox.width = boundingBox.width;\n\t\t}\n\n\t\tif (boundingBox.height < this.minBoxHeight) {\n\t\t\tthis.boundingBox.height = this.minBoxHeight;\n\t\t\tthis.boundingBox.top -= (this.minBoxHeight - boundingBox.height) / 2;\n\t\t} else {\n\t\t\tthis.boundingBox.height = boundingBox.height;\n\t\t}\n\n\t\tif (this.repeat) {\n\t\t\tthis.currentTap = new SpurEvent(e.type) as SpurPointerEvent;\n\t\t\tthis.currentTap = Object.assign(this.currentTap, e); // tslint:disable-line: prefer-object-spread\n\t\t}\n\t\tthis.press(startTap);\n\n\t\tcurrent.tapFired = current.doubleTapFired = current.longTapFired = false;\n\t\tif (this.hasListener('longTap') && !this.repeat) {\n\t\t\twindow.clearTimeout(this.longTapTimeout);\n\t\t\tthis.longTapTimeout = window.setTimeout(() => {\n\t\t\t\tthis.lockId = interactionLock.requestLockOn(target as Node);\n\t\t\t\tif (this.lockId) {\n\t\t\t\t\tthis.longTap(startTap);\n\t\t\t\t\tcurrent.longTapFired = true;\n\t\t\t\t}\n\t\t\t}, LONG_TAP_TIMEOUT);\n\t\t}\n\n\t\taddListener(document, 'pointermove', this.onPointerMove, { context: this });\n\t\taddListener(document, 'pointerup', this.onPointerUp, { context: this });\n\t}\n\n\tprivate onPointerUp(e: SpurPointerEvent) {\n\t\tif (e.pointerId !== this.pointerId || this.cancelled) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.reset();\n\t\tthis.release(false);\n\n\t\tif (!current.longTapFired) {\n\t\t\tconst now = Date.now();\n\t\t\tconst tapDiff = now - this.lastTap;\n\t\t\tthis.lastTap = now;\n\n\t\t\tif (!current.tapFired && this.hasListener('tap')) {\n\t\t\t\tcurrent.tapFired = true;\n\t\t\t\tthis.tap(e);\n\t\t\t}\n\n\t\t\tif (tapDiff < DOUBLE_TAP_TIMEOUT) {\n\t\t\t\tthis.lastTap = 0;\n\t\t\t\tif (!current.doubleTapFired && this.hasListener('doubleTap')) {\n\t\t\t\t\tcurrent.doubleTapFired = true;\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tthis.doubleTap(e);\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic componentDidMount(DOMNode: HTMLElement) {\n\t\tthis.DOMNode = DOMNode;\n\t\taddListener(this.DOMNode, 'pointerdown', this.onPointerDown, { context: this });\n\t}\n\n\tpublic componentWillUnmount() {\n\t\tremoveListener(this.DOMNode!, 'pointerdown', this.onPointerDown, { context: this });\n\t\tthis.reset();\n\t\tthis.DOMNode = null;\n\t\twindow.clearTimeout(this.repeatTimeout);\n\t}\n}\n\nexport default ButtonPlugin;\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/spur/ButtonPlugin.ts","import * as React from 'react';\nimport Plugin from './Plugin';\n\nexport type Tag = keyof JSX.IntrinsicElements;\n\nexport type Props<E extends HTMLElement = HTMLElement>\n\t= React.HTMLAttributes<E> & {\n\tplugins: {[pluginId: string]: Plugin},\n\telementRef?: (instance: E) => any\n};\n\nexport interface IPlugComponent<E extends HTMLElement = HTMLElement>\n\textends React.Component<Props<E>, null> {\n\telement: E;\n}\n\nexport interface IPlugComponentClass<E extends HTMLElement = HTMLElement> {\n\tnew(props: Props<E>, context: any): IPlugComponent<E>;\n}\n\nexport abstract class PlugComponent<P extends { plugins: {[pluginId: string]: Plugin} }, S = {}>\n\textends React.PureComponent<P, S> {\n\n\tconstructor(props: P, context: any) {\n\t\tsuper(props, context);\n\n\t\tfor (const id in props.plugins) {\n\t\t\tconst plugin = props.plugins[id];\n\t\t\tplugin.setComponentInstance(this);\n\t\t}\n\t}\n\n\tpublic componentWillMount() {\n\t\tconst plugins = this.props.plugins;\n\t\tfor (const id in plugins) {\n\t\t\tconst plugin = plugins[id] as Plugin;\n\t\t\tplugin.componentWillMount();\n\t\t}\n\t}\n\n\tpublic componentDidMountWithElement(element: HTMLElement) {\n\t\tconst plugins = this.props.plugins;\n\t\tfor (const id in plugins) {\n\t\t\tconst plugin = plugins[id];\n\t\t\tplugin.componentDidMount(element);\n\t\t}\n\t}\n\n\tpublic componentWillReceiveProps(nextProps: P) {\n\t\tconst plugins = this.props.plugins;\n\t\tfor (const id in plugins) {\n\t\t\tconst plugin = plugins[id];\n\t\t\tplugin.componentWillReceiveProps(nextProps);\n\t\t}\n\t}\n\n\tpublic componentWillUpdate(nextProps: P) {\n\t\tconst plugins = this.props.plugins;\n\t\tfor (const id in plugins) {\n\t\t\tconst plugin = plugins[id];\n\t\t\tplugin.componentWillUpdate(nextProps);\n\t\t}\n\t}\n\n\tpublic componentDidUpdate() {\n\t\tconst plugins = this.props.plugins;\n\t\tfor (const id in plugins) {\n\t\t\tconst plugin = plugins[id];\n\t\t\tplugin.componentDidUpdate();\n\t\t}\n\t}\n\n\tpublic componentWillUnmount() {\n\t\tconst plugins = this.props.plugins;\n\t\tfor (const id in plugins) {\n\t\t\tconst plugin = plugins[id];\n\t\t\tplugin.componentWillUnmount();\n\t\t\tplugin.removeEventListeners();\n\t\t}\n\t}\n}\n\nexport function createPlugTagComponent<E extends HTMLElement = HTMLElement>(tag: Tag) {\n\n\t// tslint:disable:max-classes-per-file\n\treturn class PlugTagComponent extends PlugComponent<Props<E>> {\n\t\tpublic element: E | null = null;\n\n\t\tconstructor(props: Props<E>, context: any) {\n\t\t\tsuper(props, context);\n\n\t\t\tthis.onRef = this.onRef.bind(this);\n\t\t}\n\n\t\tpublic componentDidMount() {\n\t\t\tthis.componentDidMountWithElement(this.element!);\n\t\t}\n\n\t\tprivate onRef(instance: E) {\n\t\t\tthis.element = instance;\n\t\t\tif (this.props.elementRef) {\n\t\t\t\tthis.props.elementRef(instance);\n\t\t\t}\n\t\t}\n\n\t\tpublic render() {\n\t\t\tconst ThisTag = tag as any;\n\t\t\tconst { children, plugins, elementRef, ...props } = this.props;\n\t\t\treturn(\n\t\t\t\t<ThisTag { ...props } ref={ this.onRef }>\n\t\t\t\t\t{ children }\n\t\t\t\t</ThisTag>\n\t\t\t);\n\t\t}\n\t};\n}\n\nexport const Pdiv = createPlugTagComponent<HTMLDivElement>('div');\nexport const Pspan = createPlugTagComponent<HTMLSpanElement>('span');\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/spur/Factory.tsx","abstract class Plugin<P extends {[eventName: string]: any} = {}> {\n\tpublic setComponentInstance(component: React.Component<any, any>): void {\n\t\t//\n\t}\n\n\tpublic componentDidMount(Element: HTMLElement): void {\n\t\t//\n\t}\n\n\tpublic componentWillMount(): void {\n\t\t//\n\t}\n\n\tpublic componentWillReceiveProps(nextProps: any): void {\n\t\t//\n\t}\n\n\tpublic componentWillUpdate(nextProps: any): void {\n\t\t//\n\t}\n\n\tpublic componentDidUpdate(): void {\n\t\t//\n\t}\n\n\tpublic componentWillUnmount(): void {\n\t\t//\n\t}\n\n\tprivate listeners: {[T in keyof P]: Array<{ callback: (arg: P[T]) => void, context: any }>} = {} as any;\n\n\tpublic on<T extends keyof P, C>(eventName: T, callback: (this: C, arg: P[T]) => void, context: C | this = this) {\n\t\tif (eventName in this.listeners) {\n\t\t\tthis.listeners[eventName].push({ callback, context });\n\t\t} else {\n\t\t\tthis.listeners[eventName] = [{ callback, context }];\n\t\t}\n\t}\n\n\tpublic removeEventListeners() {\n\t\tthis.listeners = {} as any;\n\t}\n\n\tprotected emit<T extends keyof P>(eventName: T, arg: P[T]) {\n\t\tconst listeners = this.listeners[eventName];\n\t\tif (listeners) {\n\t\t\tfor (let i = 0, len = listeners.length; i < len; i += 1) {\n\t\t\t\tconst listener = listeners[i];\n\t\t\t\tlistener.callback.call(listener.context, arg);\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic hasListener(eventName: keyof P): boolean {\n\t\treturn !!this.listeners[eventName];\n\t}\n}\n\nexport default Plugin;\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/spur/Plugin.ts","import { EventEmitter } from 'events';\n\nclass InteractionLock extends EventEmitter {\n\tprivate lockNodes: { [lockId: number]: Node } = {};\n\tprivate lockContainerNodes: { [lockId: number]: Node } = {};\n\tprivate lockId = 0;\n\n\tpublic isLocked(DOMNode: Node): boolean {\n\t\tfor (const id in this.lockNodes) {\n\t\t\tlet node: Node | null = this.lockNodes[id];\n\t\t\twhile (node !== null) {\n\t\t\t\tif (node === DOMNode) { return true; }\n\t\t\t\tnode = node.parentNode;\n\t\t\t}\n\t\t}\n\n\t\tfor (const id in this.lockContainerNodes) {\n\t\t\tconst container = this.lockContainerNodes[id];\n\t\t\tlet parent: Node | null = DOMNode;\n\t\t\twhile (parent !== null) {\n\t\t\t\tif (parent === container) { return true; }\n\t\t\t\tparent = parent.parentNode;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tpublic requestLockOn(DOMNode: Node): number | null {\n\t\tif (this.isLocked(DOMNode)) { return null; }\n\n\t\tthis.lockId += 1;\n\t\tthis.lockNodes[this.lockId] = DOMNode;\n\t\tthis.emit('element-lock', DOMNode);\n\t\treturn this.lockId;\n\t}\n\n\tpublic requestContainerLockOn(DOMNode: Node): number | null {\n\t\tif (this.isLocked(DOMNode)) { return null; }\n\n\t\tthis.lockId += 1;\n\t\tthis.lockContainerNodes[this.lockId] = DOMNode;\n\t\tthis.emit('container-lock', DOMNode);\n\t\treturn this.lockId;\n\t}\n\n\tpublic releaseLock(id: number) {\n\t\tconst DOMNode = this.lockNodes[id] || this.lockContainerNodes[id];\n\t\tif (DOMNode) {\n\t\t\tdelete this.lockNodes[id];\n\t\t\tdelete this.lockContainerNodes[id];\n\t\t\tthis.lockId -= 1;\n\t\t\tthis.emit('unlock', DOMNode);\n\t\t}\n\t}\n}\n\nexport default new InteractionLock();\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/spur/interactionLock.ts"],"sourceRoot":""}
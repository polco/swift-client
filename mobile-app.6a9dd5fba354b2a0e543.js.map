{"version":3,"sources":["webpack:///./src/mobile/app.tsx","webpack:///./src/mobile/views/Main.tsx","webpack:///./src/mobile/views/tabs.tsx","webpack:///./src/shared/GatewayClient.ts","webpack:///./src/shared/RTCClient.ts","webpack:///./src/shared/Store.ts","webpack:///./src/shared/actions/Action.ts","webpack:///./src/shared/actions/CreateDoc.ts","webpack:///./src/shared/actions/CreateSession.ts","webpack:///./src/shared/actions/SetUserConnected.ts","webpack:///./src/shared/actions/UpdateDoc.ts","webpack:///./src/shared/actions/UpdateUserName.ts","webpack:///./src/shared/components/Button.tsx","webpack:///./src/shared/components/SelectableText.tsx","webpack:///./src/shared/components/SessionDisplay.tsx","webpack:///./src/shared/components/SessionInfo.tsx","webpack:///./src/shared/components/SessionItem.tsx","webpack:///./src/shared/components/SessionScanner.tsx","webpack:///./src/shared/components/Tabs.tsx","webpack:///./src/shared/components/TextField.tsx","webpack:///./src/shared/context.ts","webpack:///./src/shared/models/Doc.ts","webpack:///./src/shared/models/Item.ts","webpack:///./src/shared/models/Session.ts","webpack:///./src/shared/models/User.ts","webpack:///./src/shared/models/createSeq.ts","webpack:///./src/shared/models/docClass.ts","webpack:///./src/shared/spur/ButtonPlugin.ts","webpack:///./src/shared/spur/Factory.tsx","webpack:///./src/shared/spur/Plugin.ts","webpack:///./src/shared/spur/interactionLock.ts","webpack:///./src/shared/views/CreateSession.tsx","webpack:///./src/shared/views/JoinSession.tsx","webpack:///./src/shared/views/SessionViewer.tsx","webpack:///./src/shared/views/Sessions.tsx"],"names":["React","__webpack_require__","ReactDOM","Main_1","localStorage","setItem","div","document","getElementById","classList","add","render","createElement","default","mobx_1","mobx_react_devtools_1","configureDevtool","logEnabled","context_1","Store_1","CreateSession_1","JoinSession_1","Sessions_1","SessionViewer_1","tabs_1","Tabs_1","ContentClasses","sessions","create","join","Main","PureComponent","[object Object]","props","context","super","this","isNewSession","selectTab","tabId","state","category","setState","sessionId","navigateToSession","isNew","navigateToTab","openSessions","store","tabs","TabsInfo","sessionsObserverDispose","observe","sessionList","map","session","getSession","Label","name","ContentClass","className","openInfo","goBack","categoryIndex","currentTabId","onTabSelect","childContextTypes","contextTypes","exports","mobx_react_1","SessionsLabel","observer","onUpdate","length","TabMap","debug","events_1","SocketIO","log","EventEmitter","isConnecting","socket","transports","autoConnect","on","clientId","data","emit","error","userId","connected","Promise","resolve","reject","connect","once","removeListener","disconnect","remoteClientId","ICustomEmitter","type","cb","prototype","call","value","gatewayClient","sendChannel","sessionCreating","sessionCreated","onGatewayMessage","fromClientId","msg","__awaiter","pc","setRemoteDescription","RTCSessionDescription","sessionDescription","createAnswer","setLocalDescription","send","candidate","RTCIceCandidate","sdpMLineIndex","addIceCandidate","onSendChannelOpen","e","setupDataChannel","onSendChannelClose","onSendChannelError","onDataChannel","channel","onLocalIceCandidate","sdpMid","RTCPeerConnection","iceServers","urls","onicecandidate","ondatachannel","oniceconnectionstatechange","iceConnectionState","createDataChannel","onopen","onclose","onerror","createOffer","onmessage","event","JSON","parse","console","stringify","crdt_1","dcstream","uuid","GatewayClient_1","CreateDoc_1","UpdateDoc_1","User_1","RTCClient_1","UAParser","SetUserConnected_1","Store","docs","RTCClients","crdts","updating","pendingSeqActions","userIdPerSessionId","userIdsPerClientId","onJoin","createCRDT","push","client","setupClient","dc","stream","pipe","createStream","onSessionUser","initiateConnection","executeAction","window","res","getResult","userName","os","browser","forEach","action","docId","doc","id","owner","crdt","Doc","user","addDoc","row","get","changes","toJSON","openSession","closeSession","joinSession","dispose","includes","itemId","sideEffect","run","__decorate","observable","execute","docClass_1","Session_1","Action_1","instantiate","applyPendingSeqAction","ownerId","getUser","getDoc","key","ButtonPlugin_1","Factory_1","onTap","onDoubleTap","onRef","elementRef","button","plugins","setEnable","disabled","repeat","nextProps","hasListener","children","style","Pdiv","interactionLock_1","Component","onMouseDown","lock","requestLockOn","addEventListener","onMouseUp","releaseLock","removeEventListener","text","ref","Button_1","SessionDisplay","isScrolledAtBottom","focusTimeout","addText","input","creatorId","creationDate","Date","toISOString","itemContent","content","setTimeout","focusInput","focus","validateAddText","preventDefault","onScroll","scrollHeight","scrollTop","clientHeight","scrollDiv","Math","abs","scrollTo","clearTimeout","itemElements","itemIds","lastCreatorId","currentClientElements","i","item","getItem","onSubmit","QRCode","SelectableText_1","SessionInfo","size","SessionItem","enterSession","onEnterSession","count","userIds","isYou","Instascan","videoElt","scan","Camera","getCameras","then","cameras","Error","scanner","start","stop","Scanner","video","mirror","addListener","onSessionScanned","TabButton","INDI_WIDTH","Tabs","indicator","tabsRef","tabWidth","labelUpdated","positionIndicator","clientWidth","fullWidth","passedCurrentTab","beforeWidth","width","transform","onLabelUpdate","hideIndicator","defaultProps","mainDiv","onChange","onMainRef","onBlur","generateClassName","onInputRef","hasContent","blur","label","placeholder","PropTypes","object","linked","docPrototype","property","atom","Atom","getter","reportObserved","__data","setter","val","set","reportChanged","Object","defineProperty","toModel","changed","assign","obj","Doc_1","Item","initCRDT","createDoc","createSeq_1","Session","onlineUserIds","filter","computed","User","setupSeq","seq","list","rowToValue","index","indexOf","v","splice","createSeq","createFilteredSeq","Item_1","docClass","spur_events_1","Plugin_1","onLock","DOMNode","current","plugin","longTapFired","cancel","tapFired","doubleTapFired","LONG_TAP_TIMEOUT","DOUBLE_TAP_TIMEOUT","MIN_TAP_DISTANCE","options","enable","lockId","lastTap","currentTap","pointerId","cancelled","longTapTimeout","boundingBox","left","top","height","minBoxWidth","minBoxHeight","isPressed","repeatTimeout","repeatCount","max","coords","repeatTap","onPointerMove","onPointerUp","time","tap","release","reset","clientX","clientY","originalEvent","which","isLocked","target","startTap","x","y","getBoundingClientRect","SpurEvent","press","longTap","now","tapDiff","doubleTap","onPointerDown","PlugComponent","setComponentInstance","componentWillMount","element","componentDidMount","componentWillReceiveProps","componentWillUpdate","componentDidUpdate","componentWillUnmount","removeEventListeners","createPlugTagComponent","tag","bind","componentDidMountWithElement","instance","ThisTag","_a","__rest","Pspan","listeners","component","Element","eventName","callback","arg","len","listener","lockNodes","lockContainerNodes","node","parentNode","container","parent","TextField_1","CreateSession","focusFieldTimeout","focusField","sessionNameField","createSession","getValue","validate","SessionScanner_1","JoinSession","isScanning","stopScanning","startScanning","validateSession","formValidate","SessionDisplay_1","SessionInfo_1","SessionViewer","toggleInfo","infoOpen","UpdateUserName_1","SessionItem_1","Sessions","updateUserName","clientNameField","setValue","userNameValidate","Fragment"],"mappings":"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","file":"mobile-app.6a9dd5fba354b2a0e543.js","sourcesContent":["import * as React from 'react';\nimport * as ReactDOM from 'react-dom';\nimport 'shared/styles/core.less';\nimport Main from './views/Main';\n\nlocalStorage.setItem('debug', 'swift*');\n\nconst div = document.getElementById('swift');\ndiv!.classList.add('mobile');\nReactDOM.render(<Main />, div);\n\n\n\n// WEBPACK FOOTER //\n// ./src/mobile/app.tsx","import { Lambda, observe } from 'mobx';\nimport { configureDevtool } from 'mobx-react-devtools';\nimport * as React from 'react';\n\nconfigureDevtool({\n\tlogEnabled: true\n});\n\nimport { Context, contextTypes } from 'shared/context';\nimport Store from 'shared/Store';\n\nimport CreateSession from 'shared/views/CreateSession';\nimport JoinSession from 'shared/views/JoinSession';\nimport Sessions from 'shared/views/Sessions';\nimport SessionViewer from 'shared/views/SessionViewer';\nimport { TabComponentProps, TabId } from 'shared/views/tabs';\n\nimport { TabsInfo } from './tabs';\n\nimport Tabs, { LabelProps } from 'shared/components/Tabs';\n\nimport './Main.less';\n\nexport type Props = {};\ntype State = {\n\ttabId: TabId | 'session',\n\ttabs: Array<Array<{ tabId: string, Label: React.StatelessComponent<LabelProps> }>>,\n\tcategory: number,\n\tsessionId: string | null\n};\n\nconst ContentClasses: {[tabId in TabId]: React.ComponentClass<TabComponentProps>} = {\n\tsessions: Sessions,\n\tcreate: CreateSession,\n\tjoin: JoinSession\n};\n\nclass Main extends React.PureComponent<Props, State> {\n\tprivate store: Store;\n\tprivate sessionsObserverDispose: Lambda;\n\tpublic static childContextTypes = contextTypes;\n\tprivate isNewSession = false;\n\n\tconstructor(props: Props, context: any) {\n\t\tsuper(props, context);\n\n\t\tthis.store = new Store();\n\t\tthis.state = { tabId: 'sessions', tabs: [[], TabsInfo], category: 1, sessionId: null };\n\n\t\tthis.sessionsObserverDispose = observe(this.store.sessionList, () => {\n\t\t\tthis.setState({\n\t\t\t\ttabs: [\n\t\t\t\t\tthis.store.sessionList.map(sessionId => {\n\t\t\t\t\t\tconst session = this.store.getSession(sessionId);\n\t\t\t\t\t\treturn { tabId: sessionId, Label: () => session.name as any };\n\t\t\t\t\t}),\n\t\t\t\t\tTabsInfo\n\t\t\t\t]\n\t\t\t});\n\t\t});\n\t}\n\n\tpublic componentWillUnmount() {\n\t\tthis.sessionsObserverDispose();\n\t}\n\n\tpublic getChildContext(): Context {\n\t\treturn { store: this.store };\n\t}\n\n\tprivate selectTab = (tabId: TabId | string) => {\n\t\tif (this.state.category === 0) {\n\t\t\tthis.setState({ tabId: 'session', sessionId: tabId });\n\t\t} else {\n\t\t\tthis.setState({ tabId: tabId as TabId });\n\t\t}\n\t}\n\n\tprivate navigateToSession = (sessionId: string, isNew: boolean) => {\n\t\tthis.isNewSession = !!isNew;\n\t\tthis.setState({ tabId: 'session', sessionId, category: 0 }, () => {\n\t\t\tthis.isNewSession = false;\n\t\t});\n\t}\n\n\tprivate navigateToTab = (tabId: TabId) => {\n\t\tthis.setState({ tabId, category: 1 });\n\t}\n\n\tprivate openSessions = () => {\n\t\tthis.navigateToTab('sessions');\n\t}\n\n\tpublic render() {\n\t\tconst { tabId, tabs, category, sessionId } = this.state;\n\t\tconst ContentClass = tabId === 'session' ? SessionViewer : ContentClasses[tabId];\n\n\t\treturn (\n\t\t\t<div className='Main'>\n\t\t\t\t<div className='Main__tab-container'>\n\t\t\t\t\t{ tabId === 'session'\n\t\t\t\t\t\t? <SessionViewer\n\t\t\t\t\t\t\tsessionId={ sessionId as string }\n\t\t\t\t\t\t\topenInfo={ this.isNewSession }\n\t\t\t\t\t\t\tgoBack={ this.openSessions }\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t: <ContentClass\n\t\t\t\t\t\t\tnavigateToSession={ this.navigateToSession }\n\t\t\t\t\t\t\tnavigateToTab={ this.navigateToTab }\n\t\t\t\t\t\t\tsessionId={ sessionId }\n\t\t\t\t\t\t/>\n\t\t\t\t\t}\n\t\t\t\t</div>\n\t\t\t\t<Tabs\n\t\t\t\t\ttabs={ tabs }\n\t\t\t\t\tcategoryIndex={ category }\n\t\t\t\t\tcurrentTabId={ tabId === 'session' && sessionId ? sessionId : tabId }\n\t\t\t\t\tonTabSelect={ this.selectTab }\n\t\t\t\t/>\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nexport default Main;\n\n\n\n// WEBPACK FOOTER //\n// ./src/mobile/views/Main.tsx","import { observer } from 'mobx-react';\n\nimport { Context, contextTypes } from 'shared/context';\nimport { TabId } from 'shared/views/tabs';\n\nimport { LabelProps } from 'shared/components/Tabs';\n\n// https://github.com/DefinitelyTyped/DefinitelyTyped/issues/20544\nconst SessionsLabel: React.StatelessComponent<LabelProps> = observer(function (\n\tthis: { context: Context }, props: LabelProps\n) {\n\tprops.onUpdate();\n\tconst sessions = this.context.store.sessionList;\n\treturn ('Sessions' + (sessions.length ? ` (${sessions.length})` : '' )) as any;\n});\nSessionsLabel.contextTypes = contextTypes;\n\nexport const TabMap: {[tabId in TabId]: React.StatelessComponent<LabelProps>}  = {\n\tsessions: SessionsLabel,\n\tcreate: () => 'Create' as any,\n\tjoin: () => 'Join' as any\n};\n\nconst order: TabId[] = ['sessions', 'create', 'join'];\nexport const TabsInfo = order.map(tabId => ({ tabId, Label: TabMap[tabId] }));\n\n\n\n// WEBPACK FOOTER //\n// ./src/mobile/views/tabs.tsx","import * as debug from 'debug-logger';\nimport { EventEmitter } from 'events';\nimport * as SocketIO from 'socket.io-client';\nconst log = debug('swift:GatewayClient');\n\nclass GatewayClient extends EventEmitter {\n\tprivate socket: SocketIOClient.Socket;\n\tprivate isConnecting = false;\n\t// private socketIdPerUserId: {[userId: string]: string} = {};\n\n\tconstructor() {\n\t\tsuper();\n\t\tthis.socket = SocketIO(__SOCKET_END_POINT__, { transports: ['websocket'], autoConnect: false });\n\n\t\tthis.socket.on('data', (clientId: string, data: any) => {\n\t\t\tlog('received data', data);\n\t\t\tthis.emit('data', clientId, data);\n\t\t});\n\t\tthis.socket.on('error', (error: any) => log(error));\n\t\tthis.socket.on('disconnect', () => {\n\t\t\tlog(`Disconnected from the gateway`);\n\t\t\tthis.emit('disconnected');\n\t\t});\n\t\tthis.socket.on('join', (sessionId: string, clientId: string, userId: string) => {\n\t\t\tthis.emit('join', sessionId, clientId, userId);\n\t\t});\n\t\tthis.socket.on('sessionClient', (sessionId: string, clientId: string) => {\n\t\t\tthis.emit('sessionClient', sessionId, clientId);\n\t\t});\n\t}\n\n\tprivate connect(): Promise<void> {\n\t\tif (this.isConnecting || this.socket.connected) { return Promise.resolve(); }\n\t\tthis.isConnecting = true;\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis.socket.connect();\n\n\t\t\tthis.socket.once('connect', () => {\n\t\t\t\tthis.isConnecting = false;\n\t\t\t\tlog(`Connected to the gateway`);\n\t\t\t\tthis.socket.removeListener('connect_error');\n\t\t\t\tthis.socket.removeListener('connect_timeout');\n\t\t\t\tresolve();\n\t\t\t});\n\t\t\tthis.socket.once('connect_error', reject);\n\t\t\tthis.socket.once('connect_timeout', reject);\n\t\t});\n\t}\n\n\tpublic async openSession(sessionId: string) {\n\t\tif (!this.socket.connected) { await this.connect(); }\n\t\tthis.socket.emit('openSession', sessionId);\n\t}\n\n\tpublic async closeSession(sessionId: string) {\n\t\tif (!this.socket.connected) { await this.connect(); }\n\t\tthis.socket.emit('closeSession', sessionId);\n\t\tthis.disconnect();\n\t}\n\n\tpublic async joinSession(sessionId: string, userId: string) {\n\t\tif (!this.socket.connected) { await this.connect(); }\n\t\tthis.socket.emit('join', sessionId, userId);\n\t}\n\n\tprivate disconnect() {\n\t\tif (!this.socket.connected) { return; }\n\t\tthis.isConnecting = false;\n\t\tthis.socket.disconnect();\n\t\tthis.socket.removeListener('connect_error');\n\t\tthis.socket.removeListener('connect_timeout');\n\t}\n\n\tpublic async send(remoteClientId: string, data: any) {\n\t\tif (!this.socket.connected) { await this.connect(); }\n\t\tlog('sending', data, 'to', remoteClientId);\n\t\tthis.socket.emit('data', remoteClientId, data);\n\t}\n}\n\nexport default GatewayClient;\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/GatewayClient.ts","import * as debug from 'debug-logger';\nimport { EventEmitter } from 'events';\n\nimport { DocChange } from 'shared/Store';\n\nimport GatewayClient from 'shared/GatewayClient';\nconst log = debug('swift:RTCClient');\n\ntype Message =\n\t{ type: 'client', sessionId: string } |\n\t{ type: 'offer', sessionDescription: RTCSessionDescriptionInit } |\n\t{ type: 'answer', sessionDescription: RTCSessionDescriptionInit } |\n\t{ type: 'candidate', candidate: RTCIceCandidateInit };\n\nexport type RTCEvent = {\n\t'connect': RTCDataChannel,\n\t'connected': null,\n\t'disconnected': null,\n\t'get-docs': string[],\n\t'docs': any[],\n\t'doc-changes': { sessionId: string, changes: {[docId: string]: DocChange[]} },\n};\n\nabstract class ICustomEmitter extends EventEmitter {\n\tpublic on<K extends keyof RTCEvent>(type: K, cb: (value: RTCEvent[K]) => void): this {\n\t\tEventEmitter.prototype.on.call(this, type, cb);\n\t\treturn this;\n\t}\n\n\tpublic emit<K extends keyof RTCEvent>(type: K, value: RTCEvent[K]): boolean {\n\t\treturn EventEmitter.prototype.emit.call(this, type, value);\n\t}\n}\n\n// tslint:disable:max-classes-per-file\nclass RTCClient extends ICustomEmitter {\n\tprivate pc: RTCPeerConnection;\n\tprivate gatewayClient: GatewayClient;\n\tprivate sendChannel: RTCDataChannel | null = null;\n\tpublic remoteClientId: string;\n\tpublic sessionCreating = false;\n\tpublic sessionCreated = false;\n\n\tconstructor(remoteClientId: string, gatewayClient: GatewayClient) {\n\t\tsuper();\n\n\t\tthis.gatewayClient = gatewayClient;\n\t\tthis.gatewayClient.on('data', this.onGatewayMessage);\n\t\tthis.remoteClientId = remoteClientId;\n\n\t\tthis.pc = new RTCPeerConnection({\n\t\t\ticeServers: [{ urls: 'stun:stun.l.google.com:19302' }]\n\t\t});\n\t\tthis.pc.onicecandidate = this.onLocalIceCandidate;\n\t\tthis.pc.ondatachannel = this.onDataChannel;\n\t\tthis.pc.oniceconnectionstatechange = (e) => {\n\t\t\tif (this.pc.iceConnectionState === 'connected') {\n\t\t\t\tthis.emit('connected', null);\n\t\t\t} else if (this.pc.iceConnectionState === 'disconnected' || this.pc.iceConnectionState === 'failed') {\n\t\t\t\tthis.emit('disconnected', null);\n\t\t\t}\n\t\t};\n\t}\n\n\tpublic async initiateConnection() {\n\t\tlog('initiateConnection');\n\t\tthis.sendChannel = this.pc.createDataChannel('Swift Data Channel with ' + this.remoteClientId);\n\t\tthis.sendChannel.onopen = this.onSendChannelOpen;\n\t\tthis.sendChannel.onclose = this.onSendChannelClose;\n\t\tthis.sendChannel.onerror = this.onSendChannelError;\n\n\t\tlog('create offer');\n\t\tconst sessionDescription = await this.pc.createOffer() as any;\n\t\tlog('offer created');\n\t\tawait this.pc.setLocalDescription(sessionDescription);\n\t\tthis.gatewayClient.send(this.remoteClientId, { type: 'offer', sessionDescription });\n\t}\n\n\tpublic onGatewayMessage = async (fromClientId: string, msg: Message) => {\n\t\tif (fromClientId !== this.remoteClientId) { return; }\n\t\tif (msg.type === 'offer') {\n\t\t\tthis.pc.setRemoteDescription(new RTCSessionDescription(msg.sessionDescription));\n\t\t\tconst sessionDescription = await this.pc.createAnswer() as any;\n\t\t\tthis.pc.setLocalDescription(sessionDescription);\n\t\t\tthis.gatewayClient.send(this.remoteClientId, { type: 'answer', sessionDescription });\n\t\t} else if (msg.type === 'answer') {\n\t\t\tthis.pc.setRemoteDescription(msg.sessionDescription);\n\t\t} else if (msg.type === 'candidate') {\n\t\t\tconst candidate = new RTCIceCandidate({\n\t\t\t\tsdpMLineIndex: msg.candidate.sdpMLineIndex,\n\t\t\t\tcandidate: msg.candidate.candidate\n\t\t\t});\n\t\t\tthis.pc.addIceCandidate(candidate);\n\t\t}\n\t}\n\n\tprivate onSendChannelOpen = (e: Event) => {\n\t\tlog('data channel opened');\n\t\tthis.setupDataChannel();\n\t}\n\n\tprivate onSendChannelClose = (e: Event) => {\n\t\tlog('onSendChannelClose', e);\n\t}\n\n\tprivate onSendChannelError = (e: ErrorEvent) => {\n\t\tlog('onSendChannelError', e);\n\t}\n\n\tprivate onDataChannel = (e: RTCDataChannelEvent) => {\n\t\tlog('data channel opened');\n\t\tthis.sendChannel = e.channel;\n\t\tthis.setupDataChannel();\n\t}\n\n\tprivate setupDataChannel() {\n\t\tthis.sendChannel!.onmessage = (event) => {\n\t\t\ttry {\n\t\t\t\tconst { type, data } = JSON.parse(event.data);\n\t\t\t\tthis.emit(type, data);\n\t\t\t} catch (e) {\n\t\t\t\tlog(e);\n\t\t\t\tconsole.error(e); // tslint:disable-line:no-console\n\t\t\t}\n\t\t};\n\t\tthis.gatewayClient.removeListener('data', this.onGatewayMessage);\n\t\tthis.emit('connect', this.sendChannel!);\n\t}\n\n\tpublic getDataChannel() { return this.sendChannel; }\n\n\tpublic sendMessage<K extends keyof RTCEvent>(type: K, data: RTCEvent[K]): void {\n\t\tif (this.sendChannel) {\n\t\t\tthis.sendChannel.send(JSON.stringify({ type, data }));\n\t\t} else {\n\t\t\tlog('trying to send a message before the channel is opened');\n\t\t}\n\t}\n\n\tprivate onLocalIceCandidate = (e: RTCPeerConnectionIceEvent) => {\n\t\tif (!e.candidate) { return; }\n\n\t\tthis.gatewayClient.send(this.remoteClientId, {\n\t\t\ttype: 'candidate',\n\t\t\tcandidate: {\n\t\t\t\tsdpMLineIndex: e.candidate.sdpMLineIndex,\n\t\t\t\tsdpMid: e.candidate.sdpMid,\n\t\t\t\tcandidate: e.candidate.candidate\n\t\t\t} as RTCIceCandidateInit\n\t\t});\n\t}\n}\n\nexport default RTCClient;\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/RTCClient.ts","import { Doc as CRDTDoc } from 'crdt';\nimport * as debug from 'debug-logger';\nimport { IObjectChange, observable, observe } from 'mobx';\nimport * as dcstream from 'rtc-dcstream';\nimport * as uuid from 'uuid/v4';\n\nimport GatewayClient from 'shared/GatewayClient';\n\nimport Action from 'shared/actions/Action';\nimport CreateDoc from 'shared/actions/CreateDoc';\nimport UpdateDoc from 'shared/actions/UpdateDoc';\n\nimport Doc from 'shared/models/Doc';\nimport Item from 'shared/models/Item';\nimport Session, { ISession } from 'shared/models/Session';\nimport User, { IUser } from 'shared/models/User';\n\nimport RTCClient from 'shared/RTCClient';\nimport * as UAParser from 'ua-parser-js';\nimport SetUserConnected from './actions/SetUserConnected';\n\nconst log = debug('swift:RTCClient');\n\nexport type DocChange = {\n\tname: string;\n\tdocId: string;\n\ttype: IObjectChange['type'];\n\tnewValue: any;\n};\n\nclass Store {\n\t@observable public sessionList: string[] = [];\n\tprivate docs: { [docId: string]: Doc } = {};\n\t// public userId = 'user-' + uuid();\n\t@observable public userName: string;\n\tprivate gatewayClient: GatewayClient;\n\tprivate RTCClients: { [clientId: string]: RTCClient } = {};\n\n\tpublic crdts: {[sessionId: string]: CRDTDoc<ISession | IUser>} = {};\n\tpublic updating: {[id: string]: true} = {};\n\n\tpublic pendingSeqActions: Array<() => void> = [];\n\n\tpublic userIdPerSessionId: {[sessionId: string]: string} = {};\n\tpublic userIdsPerClientId: {[clientId: string]: string[]} = {};\n\n\tconstructor() {\n\t\t(window as any).store = this;\n\n\t\tconst parser = new UAParser();\n\t\tconst res = parser.getResult();\n\t\tthis.userName = res.os.name + ' - ' + res.browser.name;\n\n\t\tthis.gatewayClient = new GatewayClient();\n\t\tthis.gatewayClient.on('join', this.onJoin);\n\t\tthis.gatewayClient.on('sessionClient', this.onSessionUser);\n\t}\n\n\tpublic applyPendingSeqAction() {\n\t\tif (this.pendingSeqActions.length) {\n\t\t\tthis.pendingSeqActions.forEach(action => action());\n\t\t\tthis.pendingSeqActions = [];\n\t\t}\n\t}\n\n\tpublic getDoc(docId: string): Doc {\n\t\treturn this.docs[docId];\n\t}\n\n\tpublic addDoc(doc: Doc) {\n\t\tthis.docs[doc.id] = doc;\n\t}\n\n\tprivate onJoin = (sessionId: string, clientId: string, userId: string) => {\n\t\tif (!this.crdts[sessionId]) { this.createCRDT(sessionId); }\n\t\tif (!this.userIdsPerClientId[clientId]) { this.userIdsPerClientId[clientId] = []; }\n\t\tthis.userIdsPerClientId[clientId].push(userId);\n\n\t\tif (this.RTCClients[clientId]) { return; } // TODO Handle same user with many sessions\n\t\tconst client = this.RTCClients[clientId] = new RTCClient(clientId, this.gatewayClient);\n\t\tthis.setupClient(client);\n\t\tclient.on('connect', (dc) => {\n\t\t\tconst stream = dcstream(dc);\n\t\t\tstream.pipe(this.crdts[sessionId].createStream()).pipe(stream);\n\t\t});\n\t}\n\n\tprivate onSessionUser = (sessionId: string, clientId: string) => {\n\t\tif (!this.crdts[sessionId]) { this.createCRDT(sessionId); }\n\n\t\tif (this.RTCClients[clientId]) { return; } // TODO Handle same user with many sessions\n\t\tconst client = this.RTCClients[clientId] = new RTCClient(clientId, this.gatewayClient);\n\t\tthis.setupClient(client);\n\t\tclient.initiateConnection();\n\t\tclient.on('connect', (dc) => {\n\t\t\tthis.executeAction(new SetUserConnected(this.userIdPerSessionId[sessionId], true));\n\t\t\tconst stream = dcstream(dc);\n\t\t\tstream.pipe(this.crdts[sessionId].createStream()).pipe(stream);\n\t\t});\n\t}\n\n\tpublic createCRDT(sessionId: string, owner = false) {\n\t\tconst crdt = this.crdts[sessionId] = new CRDTDoc();\n\n\t\t// TODO: how do we deal with the same user in different CRDTDOC ?\n\t\tconst userId = 'user-' + uuid();\n\t\tthis.userIdPerSessionId[sessionId] = userId;\n\t\tthis.updating[userId] = true;\n\t\tconst user = new User(this, crdt, userId, this.userName, owner);\n\t\tthis.addDoc(user);\n\t\tdelete this.updating[userId];\n\n\t\tcrdt.on('row_update', (row) => {\n\t\t\tconst id = row.get('id');\n\t\t\tif (this.updating[id]) { return; }\n\t\t\tthis.updating[id] = true;\n\n\t\t\tif (this.docs[id]) {\n\t\t\t\tthis.executeAction(new UpdateDoc(id, this.docs[id].changes));\n\t\t\t} else {\n\t\t\t\tthis.executeAction(new CreateDoc(row.toJSON(), sessionId));\n\t\t\t}\n\n\t\t\tdelete this.updating[id];\n\t\t});\n\t}\n\n\tprivate setupClient(client: RTCClient) {\n\t\tclient.on('disconnected', () => {\n\t\t\tconst clientId = client.remoteClientId;\n\t\t\tconst userIds = this.userIdsPerClientId[clientId] || [];\n\t\t\tuserIds.forEach(userId => {\n\t\t\t\tthis.executeAction(new SetUserConnected(userId, false));\n\t\t\t});\n\t\t});\n\n\t\t// client.on('get-docs', (docIds: string[]) => {\n\t\t\t// client.sendMessage('docs', docIds.map(docId => this.docs[docId].toModel()));\n\t\t// });\n\n\t\t// client.on('docs', (objects: any[]) => {\n\t\t// \tthis.executeAction(new DocsUpdate(objects), true);\n\t\t// });\n\n\t\t// client.on('doc-changes', (docChanges) => {\n\t\t\t// const { changes, sessionId } = docChanges;\n\t\t\t// const session = this.docs[sessionId] as Session;\n\t\t\t// if (session.ownerId === this.user.id) { // send to others\n\t\t\t// \tfor (const userId of session.userIds) {\n\t\t\t// \t\tthis.RTCClients[userId].sendMessage('doc-changes', docChanges);\n\t\t\t// \t}\n\t\t\t// } else {\n\t\t\t// \tconsole.log(changes);\n\t\t\t// }\n\t\t// });\n\t}\n\n\tpublic openSession(sessionId: string) {\n\t\tthis.createCRDT(sessionId, true);\n\t\tthis.gatewayClient.openSession(sessionId);\n\t}\n\n\tpublic closeSession(sessionId: string) {\n\t\tthis.gatewayClient.closeSession(sessionId);\n\t}\n\n\tpublic join(sessionId: string) {\n\t\tthis.createCRDT(sessionId);\n\t\tthis.gatewayClient.joinSession(sessionId, this.userIdPerSessionId[sessionId]);\n\t\treturn new Promise((resolve) => {\n\t\t\t// TODO handle error and reject ?\n\t\t\tconst dispose = observe(this.sessionList, () => {\n\t\t\t\tif (this.sessionList.includes(sessionId)) {\n\t\t\t\t\tdispose();\n\t\t\t\t\tresolve();\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tpublic getSession(sessionId: string): Session {\n\t\treturn this.docs[sessionId] as Session;\n\t}\n\n\tpublic removeSession(sessionId: string) {\n\t\tconst session = this.docs[sessionId] as Session;\n\t\tif (!session) { return log('trying to remove an inexisting session', sessionId); }\n\t\tdelete this.docs[sessionId];\n\t}\n\n\tpublic getUser(userId: string): User {\n\t\treturn this.docs[userId] as User;\n\t}\n\n\tpublic getItem(itemId: string): Item {\n\t\treturn this.docs[itemId] as Item;\n\t}\n\n\tpublic executeAction<A extends Action>(action: A, sideEffect = false): A {\n\t\taction.run(this);\n\t\treturn action;\n\t}\n}\n\nexport default Store;\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/Store.ts","import { action } from 'mobx';\nimport Store from 'shared/Store';\n\nexport type ActionsType =\n\t'createSession' | 'updateSessionName' | 'updateDoc' | 'setUserConnected' |\n\t'updateUserName' | 'addSession' | 'createDoc' | 'addItem' | 'removeItem';\n\nabstract class IAction {\n\tpublic type: ActionsType;\n\tprotected store!: Store;\n\n\tconstructor(type: ActionsType) {\n\t\tthis.type = type;\n\t}\n\n\tpublic run(store: Store) {\n\t\tthis.store = store;\n\t\taction(this.type, () => this.execute())();\n\t}\n\n\tprotected abstract execute(): boolean;\n}\n\nexport default IAction;\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/actions/Action.ts","import { IDoc } from 'shared/models/Doc';\nimport docClass from 'shared/models/docClass';\nimport Session from 'shared/models/Session';\n\nimport Action from './Action';\n\nclass CreateDoc<D extends IDoc> extends Action {\n\tprivate row: D;\n\tprivate sessionId: string;\n\n\tconstructor(row: D, sessionId: string) {\n\t\tsuper('createDoc');\n\n\t\tthis.row = row;\n\t\tthis.sessionId = sessionId;\n\t}\n\n\tprotected execute() {\n\t\tconst doc = docClass[this.row.type].instantiate(this.store, this.store.crdts[this.sessionId], this.row);\n\t\tthis.store.addDoc(doc);\n\n\t\tif (doc instanceof Session && !this.store.sessionList.includes(this.row.id)) {\n\t\t\tthis.store.sessionList.push(this.row.id);\n\t\t}\n\n\t\tthis.store.applyPendingSeqAction();\n\n\t\treturn true;\n\t}\n}\n\nexport default CreateDoc;\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/actions/CreateDoc.ts","import Session from 'shared/models/Session';\n\nimport Action from './Action';\n\nclass CreateSession extends Action {\n\tprivate id: string;\n\tprivate name: string;\n\tprivate ownerId: string;\n\n\tconstructor(id: string, name: string, ownerId: string) {\n\t\tsuper('createSession');\n\n\t\tthis.id = id;\n\t\tthis.name = name;\n\t\tthis.ownerId = ownerId;\n\t}\n\n\tprotected execute() {\n\t\tif (!this.store.crdts[this.id]) {\n\t\t\tthis.store.createCRDT(this.id);\n\t\t}\n\t\tthis.store.updating[this.id] = true;\n\t\tconst session = new Session(this.store, this.store.crdts[this.id], this.id, this.name, this.ownerId);\n\t\tdelete this.store.updating[this.id];\n\t\tthis.store.addDoc(session);\n\t\tthis.store.sessionList.push(this.id);\n\t\treturn true;\n\t}\n}\n\nexport default CreateSession;\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/actions/CreateSession.ts","import Action from './Action';\n\nclass SetUserConnected extends Action {\n\tprivate userId: string;\n\tprivate connected: boolean;\n\n\tconstructor(userId: string, connected: boolean) {\n\t\tsuper('setUserConnected');\n\n\t\tthis.userId = userId;\n\t\tthis.connected = connected;\n\t}\n\n\tprotected execute() {\n\t\tconst user = this.store.getUser(this.userId);\n\t\tuser.connected = this.connected;\n\t\treturn true;\n\t}\n}\n\nexport default SetUserConnected;\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/actions/SetUserConnected.ts","import { Changed } from 'crdt';\n\nimport { IDoc } from 'shared/models/Doc';\nimport Action from './Action';\n\nclass UpdateDoc extends Action {\n\tprivate docId: string;\n\tprivate changes: Changed<IDoc>;\n\n\tconstructor(docId: string, changes: Changed<IDoc>) {\n\t\tsuper('updateDoc');\n\n\t\tthis.docId = docId;\n\t\tthis.changes = changes;\n\t}\n\n\tprotected execute() {\n\t\tconst doc = this.store.getDoc(this.docId);\n\n\t\tfor (const key in this.changes) {\n\t\t\t(doc as any)[key] = (this.changes as any)[key];\n\t\t}\n\t\tdoc.changes = {};\n\n\t\tthis.store.applyPendingSeqAction();\n\n\t\treturn true;\n\t}\n}\n\nexport default UpdateDoc;\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/actions/UpdateDoc.ts","import Action from './Action';\n\nclass UpdateUserName extends Action {\n\tprivate name: string;\n\n\tconstructor(name: string) {\n\t\tsuper('updateUserName');\n\n\t\tthis.name = name;\n\t}\n\n\tprotected execute() {\n\t\tfor (const userId in this.store.userIdPerSessionId) {\n\t\t\tconst user = this.store.getUser(userId);\n\t\t\tuser.name = this.name;\n\t\t}\n\t\tthis.store.userName = this.name;\n\t\treturn true;\n\t}\n}\n\nexport default UpdateUserName;\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/actions/UpdateUserName.ts","import * as React from 'react';\nimport ButtonPlugin from 'shared/spur/ButtonPlugin';\nimport { Pdiv } from 'shared/spur/Factory';\nimport { SpurPointerEvent } from 'spur-events';\nimport './Button.less';\n\nexport interface IButtonClass<P> {\n\tnew (props?: Props<P>, context?: any): Button<P>;\n\tprototype: Button<P>;\n}\n\nexport type Props<P = {}> = {\n\trepeat?: boolean,\n\tdisabled?: boolean,\n\tclassName?: string,\n\tstyle?: React.CSSProperties,\n\telementRef?: (ref: HTMLDivElement | null) => void,\n\tonTap?: (component: Button<P>, e: SpurPointerEvent) => void,\n\tonDoubleTap?: (component: Button<P>, e: SpurPointerEvent) => void,\n} & P;\n\nclass Button<P = Props> extends React.PureComponent<Props<P>> {\n\tprivate plugins: { button: ButtonPlugin };\n\tpublic div: HTMLDivElement | null = null;\n\n\tconstructor(props: Props<P>, context: any) {\n\t\tsuper(props, context);\n\n\t\tconst button = new ButtonPlugin();\n\t\tthis.plugins = { button };\n\t\tbutton.setEnable(!props.disabled);\n\t\tbutton.repeat = !!props.repeat;\n\n\t\tif (this.props.onTap) { button.on('tap', this.onTap); }\n\t\tif (this.props.onDoubleTap) { button.on('doubleTap', this.onDoubleTap); }\n\t}\n\n\tpublic componentWillReceiveProps(nextProps: Props<P>) {\n\t\tconst button = this.plugins.button;\n\t\tbutton.setEnable(!nextProps.disabled);\n\t\tbutton.repeat = !!nextProps.repeat;\n\n\t\tif (nextProps.onTap && !button.hasListener('tap')) { button.on('tap', this.onTap); }\n\t\tif (nextProps.onDoubleTap && !button.hasListener('doubleTap')) { button.on('doubleTap', this.onDoubleTap); }\n\t}\n\n\tprivate onTap = (e: SpurPointerEvent) => {\n\t\tthis.props.onTap!(this, e);\n\t}\n\n\tprivate onDoubleTap = (e: SpurPointerEvent) => {\n\t\tthis.props.onDoubleTap!(this, e);\n\t}\n\n\tprivate onRef = (div: HTMLDivElement | null) => {\n\t\tthis.div = div;\n\t\tif (this.props.elementRef) { this.props.elementRef(div); }\n\t}\n\n\tpublic render() {\n\t\tconst { className, disabled, children, style } = this.props;\n\n\t\tconst cn =\n\t\t\t'button' +\n\t\t\t(className ? ' ' + className : '') +\n\t\t\t(disabled ? ' disabled' : '');\n\n\t\tconst props = {\n\t\t\tclassName: cn,\n\t\t\telementRef: this.onRef,\n\t\t\tplugins: this.plugins,\n\t\t\tstyle\n\t\t};\n\n\t\treturn React.createElement(Pdiv, props, children);\n\t}\n}\n\nexport default Button;\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/components/Button.tsx","import * as React from 'react';\nimport interactionLock from 'shared/spur/interactionLock';\n\nimport './SelectableText.less';\n\nexport type Props = {\n\ttext: string,\n\tclassName?: string\n};\n\nclass SelectableText extends React.Component<Props> {\n\tprivate div!: HTMLDivElement | null;\n\tprivate lock!: number | null;\n\n\tpublic componentWillUnmount() {\n\t\twindow.removeEventListener('mouseup', this.onMouseUp);\n\t}\n\n\tprivate onMouseDown = () => {\n\t\tthis.lock = interactionLock.requestLockOn(this.div!);\n\n\t\tif (this.lock) {\n\t\t\twindow.addEventListener('mouseup', this.onMouseUp);\n\t\t}\n\t}\n\n\tprivate onMouseUp = () => {\n\t\tinteractionLock.releaseLock(this.lock!);\n\t}\n\n\tpublic render() {\n\t\tconst { text, className } = this.props;\n\n\t\treturn (\n\t\t\t<div\n\t\t\t\tclassName={ 'SelectableText' + (className ? ' ' + className : '') }\n\t\t\t\tonMouseDown={ this.onMouseDown }\n\t\t\t\tref={ ref => this.div = ref }\n\t\t\t>\n\t\t\t\t{ text }\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nexport default SelectableText;\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/components/SelectableText.tsx","import { observer } from 'mobx-react';\nimport * as React from 'react';\nimport * as uuid from 'uuid/v4';\n\nimport CreateDoc from 'shared/actions/CreateDoc';\nimport Button from 'shared/components/Button';\nimport { Context, contextTypes } from 'shared/context';\nimport { IItem } from 'shared/models/Item';\n\nimport './SessionDisplay.less';\n\nexport type Props = {\n\tsessionId: string\n};\n\n@observer\nclass SessionDisplay extends React.Component<Props> {\n\tpublic context!: Context;\n\tpublic static contextTypes = contextTypes;\n\tprivate input!: HTMLInputElement | null;\n\tprivate scrollDiv!: HTMLDivElement | null;\n\tprivate isScrolledAtBottom = true;\n\tprivate focusTimeout: number = -1;\n\n\tpublic componentDidUpdate() {\n\t\tif (this.isScrolledAtBottom) {\n\t\t\tthis.scrollDiv!.scrollTo(0, this.scrollDiv!.scrollHeight);\n\t\t}\n\t}\n\n\tpublic componentWillUnmount() {\n\t\twindow.clearTimeout(this.focusTimeout);\n\t}\n\n\tprivate addText = () => {\n\t\tconst value = this.input!.value;\n\t\tconst sessionId = this.props.sessionId;\n\t\tif (value === '' || !sessionId) { return; }\n\n\t\tconst itemId = 'item-' + uuid();\n\t\tthis.context.store.executeAction(new CreateDoc<IItem>({\n\t\t\tid: itemId,\n\t\t\ttype: 'item',\n\t\t\tcreatorId: this.context.store.userIdPerSessionId[sessionId],\n\t\t\tcreationDate: new Date().toISOString(),\n\t\t\titemContent: { type: 'text', content: value }\n\t\t}, sessionId));\n\t\tthis.input!.value = '';\n\n\t\tthis.focusTimeout = window.setTimeout(this.focusInput, 0);\n\t}\n\n\tprivate focusInput = () => {\n\t\tthis.input!.focus();\n\t}\n\n\tprivate validateAddText = (e: React.FormEvent<HTMLFormElement>) => {\n\t\te.preventDefault();\n\t\tthis.addText();\n\t}\n\n\tprivate onScroll = () => {\n\t\tconst { scrollHeight, scrollTop, clientHeight } = this.scrollDiv!;\n\t\tthis.isScrolledAtBottom = Math.abs(clientHeight + scrollTop - scrollHeight) < 10;\n\t}\n\n\tpublic render() {\n\t\tconst store = this.context.store;\n\t\tconst { sessionId } = this.props;\n\t\tconst session = store.getSession(sessionId);\n\n\t\tconst itemElements: JSX.Element[] = [];\n\n\t\tconst itemIds = session.itemIds;\n\n\t\tlet lastCreatorId: string = '';\n\t\tlet currentClientElements: JSX.Element[] = [];\n\t\tfor (let i = 0; i < itemIds.length; i += 1) {\n\t\t\tconst itemId = itemIds[i];\n\t\t\tconst item = store.getItem(itemId);\n\t\t\tif (item.creatorId !== lastCreatorId) {\n\t\t\t\tlastCreatorId = item.creatorId;\n\t\t\t\tcurrentClientElements = [];\n\n\t\t\t\titemElements.push(\n\t\t\t\t\t<div\n\t\t\t\t\t\tkey={ i }\n\t\t\t\t\t\tclassName={\n\t\t\t\t\t\t\t'SessionDisplay__client-block' +\n\t\t\t\t\t\t\t(lastCreatorId === store.userIdPerSessionId[sessionId] ? ' SessionDisplay__client-block_you' : '')\n\t\t\t\t\t\t}\n\t\t\t\t\t>\n\t\t\t\t\t\t<div className='SessionDisplay__item-creator'>{ store.getUser(item.creatorId).name }</div>\n\t\t\t\t\t\t<div className='SessionDisplay__items'>{ currentClientElements }</div>\n\t\t\t\t\t</div>\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tcurrentClientElements.push(\n\t\t\t\t<div className='SessionDisplay__item' key={ i }>{ item.itemContent.content }</div>\n\t\t\t);\n\t\t}\n\n\t\treturn (\n\t\t\t<div className='SessionDisplay'>\n\t\t\t\t<div\n\t\t\t\t\tclassName='SessionDisplay__scroller-container'\n\t\t\t\t\tonScroll={ this.onScroll }\n\t\t\t\t\tref={ ref => this.scrollDiv = ref }\n\t\t\t\t>\n\t\t\t\t\t<div className='SessionDisplay__item-list'>\n\t\t\t\t\t\t{ itemElements }\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<form className='SessionDisplay__input-area' onSubmit={ this.validateAddText }>\n\t\t\t\t\t<input className='SessionDisplay__text-input' ref={ ref => this.input = ref } />\n\t\t\t\t\t<Button onTap={ this.addText } className='SessionDisplay__add action-button'>Add</Button>\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nexport default SessionDisplay;\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/components/SessionDisplay.tsx","import { observer } from 'mobx-react';\nimport * as QRCode from 'qrcode.react';\nimport * as React from 'react';\nimport { Context, contextTypes } from 'shared/context';\n\nimport SelectableText from 'shared/components/SelectableText';\n\nimport './SessionInfo.less';\n\nexport type Props = {\n\tsessionId: string\n};\n\n@observer\nclass SessionInfo extends React.Component<Props> {\n\tpublic context!: Context;\n\tpublic static contextTypes = contextTypes;\n\n\tpublic render() {\n\t\tconst store = this.context.store;\n\t\tconst session = store.getSession(this.props.sessionId);\n\n\t\treturn (\n\t\t\t<div className='SessionInfo'>\n\t\t\t\t<div className='SessionInfo__details'>\n\t\t\t\t\t<div className='SessionInfo__box'>\n\t\t\t\t\t\t<div className='SessionInfo__label'>Name:</div>\n\t\t\t\t\t\t<div className='SessionInfo__name'>{ session.name }</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className='SessionInfo__box'>\n\t\t\t\t\t\t<div className='SessionInfo__label'>Created by:</div>\n\t\t\t\t\t\t<div className='SessionInfo__creator'>{ store.getUser(session.ownerId).name }</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className='SessionInfo__box'>\n\t\t\t\t\t\t<div className='SessionInfo__label'>Id:</div>\n\t\t\t\t\t\t<SelectableText className='SessionInfo__id' text={ session.id } />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div className='SessionInfo__QR'>\n\t\t\t\t\t<QRCode value={ session.id } size={ 256 } />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nexport default SessionInfo;\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/components/SessionInfo.tsx","import { observer } from 'mobx-react';\nimport * as React from 'react';\n\nimport Button from 'shared/components/Button';\nimport SelectableText from 'shared/components/SelectableText';\nimport { Context, contextTypes } from 'shared/context';\n\nimport './SessionItem.less';\n\nexport type Props = {\n\tsessionId: string,\n\tonEnterSession(sessionId: string): void\n};\n\n@observer\nclass SessionItem extends React.Component<Props> {\n\tpublic context!: Context;\n\tpublic static contextTypes = contextTypes;\n\n\tprivate enterSession = () => {\n\t\tthis.props.onEnterSession(this.props.sessionId);\n\t}\n\n\tpublic render() {\n\t\tconst { sessionId } = this.props;\n\t\tconst store = this.context.store;\n\t\tconst session = store.getSession(sessionId);\n\n\t\tconst count = session.itemIds.length;\n\n\t\treturn (\n\t\t\t<Button className='SessionItem' onTap={ this.enterSession }>\n\t\t\t\t<div className='SessionItem__session-info'>\n\t\t\t\t\t<div className='SessionItem__session-name'>{ session.name }</div>\n\t\t\t\t\t<div className='SessionItem__item-count'>{ `${count} item${ count > 1 ? 's' : '' }` }</div>\n\t\t\t\t</div>\n\t\t\t\t<div className='SessionItem__client-list'>\n\t\t\t\t\t<div className='SessionItem__client-list-label'>Connected clients:</div>\n\t\t\t\t\t{ session.userIds.map(userId => {\n\t\t\t\t\t\tconst isYou = userId === store.userIdPerSessionId[sessionId];\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclassName={ 'SessionItem__client' + (isYou ? ' SessionItem__client_you' : '') }\n\t\t\t\t\t\t\t\tkey={ userId }\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{ store.getUser(userId).name }\n\t\t\t\t\t\t\t\t{ isYou ? ' (you)' : null }\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t);\n\t\t\t\t\t}) }\n\t\t\t\t</div>\n\t\t\t\t<div className='SessionItem__id-box'>\n\t\t\t\t\t<div className='SessionItem__id-label'>Id:</div>\n\t\t\t\t\t<SelectableText className='SessionItem__id' text={ sessionId } />\n\t\t\t\t</div>\n\t\t\t</Button>\n\t\t);\n\t}\n}\n\nexport default SessionItem;\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/components/SessionItem.tsx","import * as debug from 'debug-logger';\nimport * as Instascan from 'instascan';\nimport * as React from 'react';\nconst log = debug('swift:SessionScanner');\n\nexport type Props = {\n\tonSessionScanned: (sessionId: string) => void\n};\n\nclass SessionScanner extends React.PureComponent<Props> {\n\tprivate videoElt: HTMLVideoElement | null = null;\n\tprivate scanner: any;\n\n\tpublic componentDidMount () {\n\t\tthis.scanner = new Instascan.Scanner({ video: this.videoElt, mirror: false });\n\t\tthis.scanner.addListener('scan', (content: string) => {\n\t\t\tthis.scanner.stop();\n\t\t\tthis.props.onSessionScanned(content);\n\t\t});\n\t}\n\n\tpublic scan = (): Promise<void> => {\n\t\treturn Instascan.Camera.getCameras().then((cameras: any[]) => {\n\t\t\tif (cameras.length > 0) {\n\t\t\t\tthis.scanner.start(cameras[1] || cameras[0]);\n\t\t\t} else {\n\t\t\t\tlog('No cameras found.');\n\t\t\t\tthrow new Error('No cameras found.');\n\t\t\t}\n\t\t});\n\t}\n\n\tpublic stop = () => {\n\t\tthis.scanner.stop();\n\t}\n\n\tpublic render () {\n\t\treturn (\n\t\t\t<video ref={ ref => this.videoElt = ref } className='session-scanner' />\n\t\t);\n\t}\n}\n\nexport default SessionScanner;\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/components/SessionScanner.tsx","import * as React from 'react';\n\nimport Button, { IButtonClass } from 'shared/components/Button';\n\nimport './Tabs.less';\n\nexport type LabelProps = { onUpdate: () => void };\n\ntype TabButtonProps = { tabId: string };\nconst TabButton = Button as IButtonClass<TabButtonProps>;\n\nconst INDI_WIDTH = 100;\n\nexport type Props = {\n\ttabs: Array<Array<{ tabId: string, Label: React.StatelessComponent<LabelProps> }>>,\n\tcategoryIndex: number,\n\tcurrentTabId: string,\n\tonTabSelect(tabId: string | string): void,\n\thideIndicator?: boolean\n};\n\nclass Tabs extends React.PureComponent<Props> {\n\tprivate indicator: HTMLDivElement | null = null;\n\tprivate tabsRef: { [tabId: string]: Button<TabButtonProps> | null } = {};\n\tprivate tabWidth: { [tabId: string]: number } = {};\n\tprivate labelUpdated = true;\n\n\tpublic static defaultProps: Partial<Props> = { hideIndicator: false };\n\n\tpublic componentDidMount() {\n\t\tthis.positionIndicator();\n\t}\n\n\tpublic componentDidUpdate() {\n\t\tthis.positionIndicator();\n\t}\n\n\tprivate positionIndicator = () => {\n\t\tif (this.labelUpdated) {\n\t\t\tthis.labelUpdated = false;\n\t\t\tfor (const tabId in this.tabsRef) {\n\t\t\t\tconst button = this.tabsRef[tabId];\n\t\t\t\tif (button) {\n\t\t\t\t\tthis.tabWidth[tabId] = button.div!.clientWidth;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst { currentTabId, tabs, categoryIndex } = this.props;\n\t\tlet fullWidth = 0;\n\t\tlet passedCurrentTab = false;\n\t\tlet beforeWidth = 0;\n\t\tfor (const { tabId } of tabs[categoryIndex]) {\n\t\t\tif (tabId === currentTabId) { passedCurrentTab = true; }\n\t\t\tconst width = this.tabWidth[tabId];\n\t\t\tif (!passedCurrentTab) {\n\t\t\t\tbeforeWidth += width;\n\t\t\t}\n\t\t\tfullWidth += width;\n\t\t}\n\t\tbeforeWidth -= fullWidth / 2;\n\n\t\tthis.indicator!.style.transform =\n\t\t\t`translate3d(${beforeWidth + INDI_WIDTH / 2}px, 0, 0) scaleX(${ this.tabWidth[currentTabId] / INDI_WIDTH })`;\n\t}\n\n\tprivate selectTab = (button: Button<TabButtonProps>) => {\n\t\tthis.props.onTabSelect(button.props.tabId);\n\t}\n\n\tprivate onLabelUpdate = () => {\n\t\tthis.labelUpdated = true;\n\t}\n\n\tpublic render() {\n\t\tconst { currentTabId, tabs, categoryIndex, hideIndicator } = this.props;\n\n\t\treturn (\n\t\t\t<div className='Tabs'>\n\t\t\t\t<div className='Tabs__container' style={ { transform: `translate3d(0, ${ categoryIndex * -100 }%,0)` } }>\n\t\t\t\t\t{\n\t\t\t\t\t\ttabs.map((category, i) =>\n\t\t\t\t\t\t\t<div className='Tabs__category' key={ i }>\n\t\t\t\t\t\t\t\t<div className='Tabs__category_container' key={ i }>\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tcategory.map(({ tabId, Label }) =>\n\t\t\t\t\t\t\t\t\t\t<TabButton\n\t\t\t\t\t\t\t\t\t\t\tkey={ tabId }\n\t\t\t\t\t\t\t\t\t\t\tclassName={ 'Tabs__tab' + (currentTabId === tabId ? ' Tabs__tab_active' : '') }\n\t\t\t\t\t\t\t\t\t\t\tonTap={ this.selectTab }\n\t\t\t\t\t\t\t\t\t\t\ttabId={ tabId }\n\t\t\t\t\t\t\t\t\t\t\tref={ ref => this.tabsRef[tabId] = ref }\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<Label onUpdate={ this.onLabelUpdate } />\n\t\t\t\t\t\t\t\t\t\t</TabButton>\n\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t)\n\t\t\t\t\t}\n\t\t\t\t</div>\n\t\t\t\t<div\n\t\t\t\t\tclassName={ 'Tabs__indicator' + (hideIndicator ? ' Tabs__indicator_hidden' : '') }\n\t\t\t\t\tref={ ref => this.indicator = ref }\n\t\t\t\t/>\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nexport default Tabs;\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/components/Tabs.tsx","import * as React from 'react';\n\nimport './TextField.less';\n\nexport type Props = {\n\tlabel: string,\n\tplaceholder: string,\n\tclassName?: string\n};\n\nclass TextField extends React.PureComponent<Props> {\n\tprivate mainDiv: HTMLDivElement | null = null;\n\tprivate input: HTMLInputElement | null = null;\n\tprivate content: string = '';\n\n\tconstructor(props: Props, context: any) {\n\t\tsuper(props, context);\n\n\t\tthis.state = { hasContent: false };\n\t}\n\n\tprivate onChange = () => {\n\t\tthis.content = this.input!.value;\n\t}\n\n\tprivate onMainRef = (div: HTMLDivElement | null) => {\n\t\tthis.mainDiv = div;\n\t}\n\n\tprivate onBlur = () => {\n\t\tthis.mainDiv!.className = this.generateClassName();\n\t}\n\n\tprivate onInputRef = (input: HTMLInputElement | null) => {\n\t\tthis.input = input;\n\t}\n\n\tprivate generateClassName(): string {\n\t\treturn 'TextField' + (this.content.length ? ' TextField_hasContent' : '');\n\t}\n\n\tpublic getValue() { return this.content; }\n\n\tpublic setValue(value: string) {\n\t\tthis.content = value;\n\t\tthis.input!.value = value;\n\t}\n\n\tpublic blur() { this.input!.blur(); }\n\tpublic focus() { this.input!.focus(); }\n\n\tpublic render() {\n\t\tconst { label, placeholder } = this.props;\n\n\t\treturn (\n\t\t\t<div className={ this.generateClassName() } ref={ this.onMainRef }>\n\t\t\t\t<div className='TextField__label'>{ label }</div>\n\t\t\t\t<input\n\t\t\t\t\tclassName='TextField__input'\n\t\t\t\t\tplaceholder={ placeholder }\n\t\t\t\t\tonChange={ this.onChange }\n\t\t\t\t\tonBlur={ this.onBlur }\n\t\t\t\t\tref={ this.onInputRef }\n\t\t\t\t/>\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nexport default TextField;\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/components/TextField.tsx","import * as PropTypes from 'prop-types';\nimport Store from './Store';\n\nexport type Context = {\n\tstore: Store\n};\n\nexport const contextTypes: {[T in keyof Context]: PropTypes.Requireable<any>} = {\n\tstore: PropTypes.object\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/context.ts","import { Atom } from 'mobx';\n\nimport Store from 'shared/Store';\n\nimport { Doc as CrdtDoc, Row as CrdtDow } from 'crdt';\n\nexport type DocType = 'session' | 'user' | 'item';\n\nexport function linked(docPrototype: any, property: string) {\n\tconst atom = new Atom(property);\n\n\tconst getter = function(this: Doc) {\n\t\tatom.reportObserved();\n\t\treturn (this as any).__data[property];\n\t};\n\n\tconst setter = function(this: Doc, val: any) {\n\t\tconst value = (this as any).__data[property];\n\t\tif (value === val) { return; }\n\t\t(this as any).__data[property] = val;\n\t\tif (this.row && this.row.get(property) !== val) {\n\t\t\tthis.row.set(property, val);\n\t\t}\n\t\tatom.reportChanged();\n\t};\n\n\tif (delete docPrototype[property]) {\n\t\tObject.defineProperty(docPrototype, property, {\n\t\t\tget: getter,\n\t\t\tset: setter\n\t\t});\n\t}\n}\n\nexport interface IDoc {\n\tid: string;\n\ttype: DocType;\n}\n\nabstract class Doc<M extends IDoc = any> {\n\tprotected __data = {};\n\t@linked public readonly id: string;\n\t@linked public readonly type: DocType;\n\tpublic row!: CrdtDow<M>;\n\tprotected store: Store;\n\tpublic changes: {[K in keyof M]?: M[K]};\n\n\tconstructor(store: Store, id: string, type: DocType) {\n\t\tthis.store = store;\n\t\tthis.id = id;\n\t\tthis.type = type;\n\t\tthis.changes = {};\n\t}\n\n\tprotected initCRDT(crdt: CrdtDoc): void {\n\t\tthis.row = crdt.get(this.id);\n\t\tif (!this.row.get('type')) {\n\t\t\tthis.row.set(this.toModel());\n\t\t}\n\n\t\tthis.row.on('change', (changed) => {\n\t\t\tObject.assign(this.changes, changed);\n\t\t});\n\t}\n\n\tprotected createDoc<O>(obj: O): O & IDoc {\n\t\treturn Object.assign(obj, { id: this.id, type: this.type });\n\t}\n\n\tpublic abstract toModel(): M;\n}\n\nexport default Doc;\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/models/Doc.ts","import { Doc as CrdtDoc } from 'crdt';\nimport Doc, { IDoc, linked } from './Doc';\n\nimport Store from 'shared/Store';\n\nexport type TextItem = { type: 'text', content: string };\n\nexport type ItemContent = TextItem;\n\nexport interface IItem extends IDoc {\n\tcreatorId: string;\n\tcreationDate: string;\n\titemContent: ItemContent;\n}\n\nclass Item extends Doc<IItem> {\n\t@linked public creatorId: string;\n\t@linked public creationDate: string;\n\t@linked public itemContent: ItemContent;\n\n\tconstructor(\n\t\tstore: Store, crdt: CrdtDoc<IDoc>, id: string, creatorId: string, creationDate: string, itemContent: ItemContent\n\t) {\n\t\tsuper(store, id, 'item');\n\t\tthis.creatorId = creatorId;\n\t\tthis.creationDate = creationDate;\n\t\tthis.itemContent = itemContent;\n\t\tthis.initCRDT(crdt);\n\t}\n\n\tpublic static instantiate(\n\t\tstore: Store, crdt: CrdtDoc<IDoc>, { id, creatorId, creationDate, itemContent }: IItem\n\t): Item {\n\t\treturn new Item(store, crdt, id, creatorId, creationDate, itemContent);\n\t}\n\n\tpublic toModel() {\n\t\treturn this.createDoc({\n\t\t\tcreationDate: this.creationDate,\n\t\t\tcreatorId: this.creatorId,\n\t\t\titemContent: this.itemContent\n\t\t});\n\t}\n}\n\nexport default Item;\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/models/Item.ts","import { Doc as CRDTDoc } from 'crdt';\nimport { computed, observable } from 'mobx';\nimport Doc, { IDoc, linked } from './Doc';\n\nimport createSeq from './createSeq';\n\nimport Store from 'shared/Store';\n\nexport interface ISession extends IDoc {\n\townerId: string;\n\tname: string;\n}\n\nclass Session extends Doc<ISession> {\n\t@linked public readonly ownerId: string;\n\t@linked public name: string;\n\t@observable public userIds: string[];\n\t@computed get onlineUserIds() {\n\t\treturn this.userIds.filter(userId => this.store.getUser(userId).connected);\n\t}\n\t@observable public itemIds: string[];\n\n\tconstructor(store: Store, crdt: CRDTDoc<IDoc>, id: string, name: string, ownerId: string) {\n\t\tsuper(store, id, 'session');\n\t\tthis.name = name;\n\t\tthis.ownerId = ownerId;\n\t\tthis.userIds = [];\n\t\tthis.itemIds = [];\n\n\t\tthis.initCRDT(crdt);\n\t\tcreateSeq(crdt, store, 'type', 'item', this.itemIds, row => row.get('id'));\n\t\tcreateSeq(crdt, store, 'type', 'user', this.userIds, row => row.get('id'));\n\t}\n\n\tpublic static instantiate(store: Store, crdt: CRDTDoc<IDoc>, { id, name, ownerId }: ISession): Session {\n\t\treturn new Session(store, crdt, id, name, ownerId);\n\t}\n\n\tpublic toModel() {\n\t\treturn this.createDoc({\n\t\t\townerId: this.ownerId,\n\t\t\tname: this.name\n\t\t});\n\t}\n}\n\nexport default Session;\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/models/Session.ts","import { Doc as CrdtDoc } from 'crdt';\nimport Doc, { IDoc, linked } from './Doc';\n\nimport Store from 'shared/Store';\n\nexport interface IUser extends IDoc {\n\tname: string;\n\tconnected: boolean;\n}\n\nclass User extends Doc<IUser> {\n\t@linked public name: string;\n\t@linked public connected: boolean;\n\n\tconstructor(store: Store, crdt: CrdtDoc, id: string, name: string, connected?: boolean) {\n\t\tsuper(store, id, 'user');\n\t\tthis.name = name;\n\t\tthis.connected = connected || false;\n\t\tthis.initCRDT(crdt);\n\t}\n\n\tpublic static instantiate(store: Store, crdt: CrdtDoc<IDoc>, { id, name, connected }: IUser): User {\n\t\treturn new User(store, crdt, id, name, connected);\n\t}\n\n\tpublic toModel() {\n\t\treturn this.createDoc({\n\t\t\tname: this.name,\n\t\t\tconnected: this.connected\n\t\t});\n\t}\n}\n\nexport default User;\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/models/User.ts","import { Doc as CRDTDoc, Row, Seq } from 'crdt';\nimport { IDoc } from 'shared/models/Doc';\nimport Store from 'shared/Store';\n\nfunction setupSeq<D extends IDoc, L>(store: Store, seq: Seq<D>, list: L[], rowToValue: (row: Row<D>) => L) {\n\tseq.forEach(row => list.push(rowToValue(row)));\n\n\tseq.on('add', row => {\n\t\tconst index = seq.indexOf(row);\n\t\tif (index !== -1) {\n\t\t\tconst v = rowToValue(row);\n\t\t\tstore.pendingSeqActions.push(() => {\n\t\t\t\tlist.splice(index, 0, v);\n\t\t\t});\n\t\t}\n\t});\n\n\t// seq.on('move', () => console.log('move')); // TODO\n\n\tseq.on('remove', row => {\n\t\tconst v = rowToValue(row);\n\t\tconst index = list.indexOf(v);\n\t\tif (index !== -1) {\n\t\t\tstore.pendingSeqActions.push(() => {\n\t\t\t\tlist.splice(index, 1);\n\t\t\t});\n\t\t}\n\t});\n}\n\nexport default function createSeq<D extends IDoc, K extends keyof D, L>(\n\tcrdt: CRDTDoc<D>, store: Store, key: K, value: D[K], list: L[], rowToValue: (row: Row<D>) => L\n) {\n\tconst seq = crdt.createSeq(key, value);\n\tsetupSeq(store, seq, list, rowToValue);\n\treturn list;\n}\n\nexport function createFilteredSeq<D extends IDoc, L>(\n\tcrdt: CRDTDoc<D>, store: Store, filter: (row: D) => boolean, list: L[], rowToValue: (row: Row<D>) => L\n) {\n\tconst seq = crdt.createSeq(filter);\n\tsetupSeq(store, seq, list, rowToValue);\n\treturn list;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/models/createSeq.ts","import { Doc as CRDTDoc } from 'crdt';\n\nimport Doc, { DocType, IDoc } from './Doc';\nimport Item from './Item';\nimport Session from './Session';\nimport User from './User';\n\nimport Store from 'shared/Store';\n\nconst docClass: {[D in DocType]: {\n\tnew(...args: any[]): Doc;\n\tinstantiate(store: Store, crdt: CRDTDoc<IDoc>, data: any): Doc;\n}} = {\n\tsession: Session,\n\tuser: User,\n\titem: Item\n};\n\nexport default docClass;\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/models/docClass.ts","import { addListener, removeListener, SpurEvent, SpurPointerEvent } from 'spur-events';\nimport interactionLock from './interactionLock';\nimport Plugin from './Plugin';\n\ninterface IButtonPlugin {\n\tcancel(): void;\n\tDOMNode: HTMLElement | null;\n}\n\nexport const current: {\n\tplugins: IButtonPlugin[],\n\ttapFired: boolean,\n\tdoubleTapFired: boolean,\n\tlongTapFired: boolean\n} = { plugins: [], tapFired: false, doubleTapFired: false, longTapFired: false };\n\naddListener(window, 'pointerup', function(e: SpurPointerEvent) {\n\tcurrent.plugins = [];\n});\n\nfunction onLock(DOMNode: HTMLElement) {\n\tif (current.plugins.length) {\n\t\tcurrent.plugins.forEach(plugin => {\n\t\t\tif (!current.longTapFired || DOMNode !== plugin.DOMNode) { plugin.cancel(); }\n\t\t});\n\t\tcurrent.plugins = [];\n\t}\n}\n\ninteractionLock.on('element-lock', onLock);\ninteractionLock.on('container-lock', onLock);\n\ntype Coords = { x: number, y: number };\n\nconst LONG_TAP_TIMEOUT = 700;\nconst DOUBLE_TAP_TIMEOUT = 300;\nconst MIN_TAP_DISTANCE = 15;\n\nexport type Events = {\n\tpress: Coords,\n\trelease: boolean,\n\ttap: SpurPointerEvent,\n\tdoubleTap: SpurPointerEvent,\n\tlongTap: Coords\n};\n\nclass ButtonPlugin extends Plugin<Events> {\n\tprivate enable = true;\n\tprivate lockId: number | null = null;\n\tprivate lastTap = 0;\n\tprivate currentTap: SpurPointerEvent | null = null;\n\tprivate pointerId: string = '';\n\tprivate cancelled: boolean = false;\n\tprivate longTapTimeout: number = 0;\n\tprivate boundingBox = { left: 0, top: 0, width: 0, height: 0 };\n\tpublic DOMNode: HTMLElement | null = null;\n\tprivate minBoxWidth = MIN_TAP_DISTANCE;\n\tprivate minBoxHeight = MIN_TAP_DISTANCE;\n\tprivate isPressed = false;\n\tprivate repeatTimeout: number = 0;\n\tprivate repeatCount = 0;\n\tpublic repeat = false;\n\n\tconstructor(options: { repeat?: boolean } = {}) {\n\t\tsuper();\n\n\t\tthis.repeat = !!options.repeat;\n\t}\n\n\tpublic setMinBoxDimensions(width: number, height: number) {\n\t\tthis.minBoxWidth = Math.max(width, MIN_TAP_DISTANCE);\n\t\tthis.minBoxHeight = Math.max(height, MIN_TAP_DISTANCE);\n\t}\n\n\tprivate press(coords: Coords) {\n\t\tthis.isPressed = true;\n\t\tif (this.repeat) {\n\t\t\tthis.repeatCount = 0;\n\t\t\tthis.repeatTap();\n\t\t}\n\t\tthis.emit('press', coords);\n\t}\n\n\tprivate release(cancelled: boolean) {\n\t\tthis.isPressed = false;\n\t\tthis.emit('release', cancelled);\n\t}\n\n\tprivate tap(e: SpurPointerEvent) {\n\t\tthis.emit('tap', e);\n\t}\n\n\tprivate doubleTap(e: SpurPointerEvent) {\n\t\tthis.emit('doubleTap', e);\n\t}\n\n\tprivate longTap(coords: Coords) {\n\t\tthis.emit('longTap', coords);\n\t}\n\n\tpublic setEnable(enable: boolean) {\n\t\tthis.enable = enable;\n\t}\n\n\tprivate reset() {\n\t\tif (this.lockId) {\n\t\t\tinteractionLock.releaseLock(this.lockId);\n\t\t\tthis.lockId = null;\n\t\t}\n\t\twindow.clearTimeout(this.repeatTimeout);\n\t\twindow.clearTimeout(this.longTapTimeout);\n\t\tremoveListener(document, 'pointermove', this.onPointerMove, { context: this });\n\t\tremoveListener(document, 'pointerup', this.onPointerUp, { context: this });\n\t}\n\n\tprivate repeatTap() {\n\t\tconst time = this.repeatCount === 0 ? 300 : 20;\n\n\t\tthis.repeatTimeout = window.setTimeout(() => {\n\t\t\tthis.repeatCount += 1;\n\t\t\tthis.tap(this.currentTap!);\n\t\t\tthis.repeatTap();\n\t\t}, time);\n\t}\n\n\tpublic cancel() {\n\t\tif (this.isPressed) {\n\t\t\tthis.cancelled = true;\n\t\t\tthis.release(true);\n\t\t}\n\n\t\tthis.reset();\n\t}\n\n\tprivate onPointerMove(e: SpurPointerEvent) {\n\t\tif (e.pointerId !== this.pointerId) { return; }\n\t\tif (e.clientX < this.boundingBox.left ||\n\t\t\te.clientX > this.boundingBox.left + this.boundingBox.width ||\n\t\t\te.clientY < this.boundingBox.top ||\n\t\t\te.clientY > this.boundingBox.top + this.boundingBox.height) {\n\t\t\tthis.cancel();\n\t\t}\n\t}\n\n\tprivate onPointerDown(e: SpurPointerEvent) {\n\t\tif (!this.enable || (e.originalEvent as MouseEvent).which === 3 || interactionLock.isLocked(e.target as Node)) {\n\t\t\treturn;\n\t\t}\n\n\t\tcurrent.plugins.push(this);\n\t\tthis.pointerId = e.pointerId;\n\n\t\tthis.cancelled = false;\n\t\tconst startTap = {\n\t\t\tx: e.clientX,\n\t\t\ty: e.clientY\n\t\t};\n\n\t\tconst target = e.target;\n\n\t\tconst boundingBox = this.DOMNode!.getBoundingClientRect();\n\t\tthis.boundingBox.top = boundingBox.top;\n\t\tthis.boundingBox.left = boundingBox.left;\n\t\tif (boundingBox.width < this.minBoxWidth) {\n\t\t\tthis.boundingBox.width = this.minBoxWidth;\n\t\t\tthis.boundingBox.left -= (this.minBoxWidth - boundingBox.width) / 2;\n\t\t} else {\n\t\t\tthis.boundingBox.width = boundingBox.width;\n\t\t}\n\n\t\tif (boundingBox.height < this.minBoxHeight) {\n\t\t\tthis.boundingBox.height = this.minBoxHeight;\n\t\t\tthis.boundingBox.top -= (this.minBoxHeight - boundingBox.height) / 2;\n\t\t} else {\n\t\t\tthis.boundingBox.height = boundingBox.height;\n\t\t}\n\n\t\tif (this.repeat) {\n\t\t\tthis.currentTap = new SpurEvent(e.type) as SpurPointerEvent;\n\t\t\tthis.currentTap = Object.assign(this.currentTap, e); // tslint:disable-line: prefer-object-spread\n\t\t}\n\t\tthis.press(startTap);\n\n\t\tcurrent.tapFired = current.doubleTapFired = current.longTapFired = false;\n\t\tif (this.hasListener('longTap') && !this.repeat) {\n\t\t\twindow.clearTimeout(this.longTapTimeout);\n\t\t\tthis.longTapTimeout = window.setTimeout(() => {\n\t\t\t\tthis.lockId = interactionLock.requestLockOn(target as Node);\n\t\t\t\tif (this.lockId) {\n\t\t\t\t\tthis.longTap(startTap);\n\t\t\t\t\tcurrent.longTapFired = true;\n\t\t\t\t}\n\t\t\t}, LONG_TAP_TIMEOUT);\n\t\t}\n\n\t\taddListener(document, 'pointermove', this.onPointerMove, { context: this });\n\t\taddListener(document, 'pointerup', this.onPointerUp, { context: this });\n\t}\n\n\tprivate onPointerUp(e: SpurPointerEvent) {\n\t\tif (e.pointerId !== this.pointerId || this.cancelled) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.reset();\n\t\tthis.release(false);\n\n\t\tif (!current.longTapFired) {\n\t\t\tconst now = Date.now();\n\t\t\tconst tapDiff = now - this.lastTap;\n\t\t\tthis.lastTap = now;\n\n\t\t\tif (!current.tapFired && this.hasListener('tap')) {\n\t\t\t\tcurrent.tapFired = true;\n\t\t\t\tthis.tap(e);\n\t\t\t}\n\n\t\t\tif (tapDiff < DOUBLE_TAP_TIMEOUT) {\n\t\t\t\tthis.lastTap = 0;\n\t\t\t\tif (!current.doubleTapFired && this.hasListener('doubleTap')) {\n\t\t\t\t\tcurrent.doubleTapFired = true;\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tthis.doubleTap(e);\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic componentDidMount(DOMNode: HTMLElement) {\n\t\tthis.DOMNode = DOMNode;\n\t\taddListener(this.DOMNode, 'pointerdown', this.onPointerDown, { context: this });\n\t}\n\n\tpublic componentWillUnmount() {\n\t\tremoveListener(this.DOMNode!, 'pointerdown', this.onPointerDown, { context: this });\n\t\tthis.reset();\n\t\tthis.DOMNode = null;\n\t\twindow.clearTimeout(this.repeatTimeout);\n\t}\n}\n\nexport default ButtonPlugin;\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/spur/ButtonPlugin.ts","import * as React from 'react';\nimport Plugin from './Plugin';\n\nexport type Tag = keyof JSX.IntrinsicElements;\n\nexport type Props<E extends HTMLElement = HTMLElement>\n\t= React.HTMLAttributes<E> & {\n\tplugins: {[pluginId: string]: Plugin},\n\telementRef?: (instance: E) => any\n};\n\nexport interface IPlugComponent<E extends HTMLElement = HTMLElement>\n\textends React.Component<Props<E>, null> {\n\telement: E;\n}\n\nexport interface IPlugComponentClass<E extends HTMLElement = HTMLElement> {\n\tnew(props: Props<E>, context: any): IPlugComponent<E>;\n}\n\nexport abstract class PlugComponent<P extends { plugins: {[pluginId: string]: Plugin} }, S = {}>\n\textends React.PureComponent<P, S> {\n\n\tconstructor(props: P, context: any) {\n\t\tsuper(props, context);\n\n\t\tfor (const id in props.plugins) {\n\t\t\tconst plugin = props.plugins[id];\n\t\t\tplugin.setComponentInstance(this);\n\t\t}\n\t}\n\n\tpublic componentWillMount() {\n\t\tconst plugins = this.props.plugins;\n\t\tfor (const id in plugins) {\n\t\t\tconst plugin = plugins[id] as Plugin;\n\t\t\tplugin.componentWillMount();\n\t\t}\n\t}\n\n\tpublic componentDidMountWithElement(element: HTMLElement) {\n\t\tconst plugins = this.props.plugins;\n\t\tfor (const id in plugins) {\n\t\t\tconst plugin = plugins[id];\n\t\t\tplugin.componentDidMount(element);\n\t\t}\n\t}\n\n\tpublic componentWillReceiveProps(nextProps: P) {\n\t\tconst plugins = this.props.plugins;\n\t\tfor (const id in plugins) {\n\t\t\tconst plugin = plugins[id];\n\t\t\tplugin.componentWillReceiveProps(nextProps);\n\t\t}\n\t}\n\n\tpublic componentWillUpdate(nextProps: P) {\n\t\tconst plugins = this.props.plugins;\n\t\tfor (const id in plugins) {\n\t\t\tconst plugin = plugins[id];\n\t\t\tplugin.componentWillUpdate(nextProps);\n\t\t}\n\t}\n\n\tpublic componentDidUpdate() {\n\t\tconst plugins = this.props.plugins;\n\t\tfor (const id in plugins) {\n\t\t\tconst plugin = plugins[id];\n\t\t\tplugin.componentDidUpdate();\n\t\t}\n\t}\n\n\tpublic componentWillUnmount() {\n\t\tconst plugins = this.props.plugins;\n\t\tfor (const id in plugins) {\n\t\t\tconst plugin = plugins[id];\n\t\t\tplugin.componentWillUnmount();\n\t\t\tplugin.removeEventListeners();\n\t\t}\n\t}\n}\n\nexport function createPlugTagComponent<E extends HTMLElement = HTMLElement>(tag: Tag) {\n\n\t// tslint:disable:max-classes-per-file\n\treturn class PlugTagComponent extends PlugComponent<Props<E>> {\n\t\tpublic element: E | null = null;\n\n\t\tconstructor(props: Props<E>, context: any) {\n\t\t\tsuper(props, context);\n\n\t\t\tthis.onRef = this.onRef.bind(this);\n\t\t}\n\n\t\tpublic componentDidMount() {\n\t\t\tthis.componentDidMountWithElement(this.element!);\n\t\t}\n\n\t\tprivate onRef(instance: E) {\n\t\t\tthis.element = instance;\n\t\t\tif (this.props.elementRef) {\n\t\t\t\tthis.props.elementRef(instance);\n\t\t\t}\n\t\t}\n\n\t\tpublic render() {\n\t\t\tconst ThisTag = tag as any;\n\t\t\tconst { children, plugins, elementRef, ...props } = this.props;\n\t\t\treturn(\n\t\t\t\t<ThisTag { ...props } ref={ this.onRef }>\n\t\t\t\t\t{ children }\n\t\t\t\t</ThisTag>\n\t\t\t);\n\t\t}\n\t};\n}\n\nexport const Pdiv = createPlugTagComponent<HTMLDivElement>('div');\nexport const Pspan = createPlugTagComponent<HTMLSpanElement>('span');\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/spur/Factory.tsx","abstract class Plugin<P extends {[eventName: string]: any} = {}> {\n\tpublic setComponentInstance(component: React.Component<any, any>): void {\n\t\t//\n\t}\n\n\tpublic componentDidMount(Element: HTMLElement): void {\n\t\t//\n\t}\n\n\tpublic componentWillMount(): void {\n\t\t//\n\t}\n\n\tpublic componentWillReceiveProps(nextProps: any): void {\n\t\t//\n\t}\n\n\tpublic componentWillUpdate(nextProps: any): void {\n\t\t//\n\t}\n\n\tpublic componentDidUpdate(): void {\n\t\t//\n\t}\n\n\tpublic componentWillUnmount(): void {\n\t\t//\n\t}\n\n\tprivate listeners: {[T in keyof P]: Array<{ callback: (arg: P[T]) => void, context: any }>} = {} as any;\n\n\tpublic on<T extends keyof P, C>(eventName: T, callback: (this: C, arg: P[T]) => void, context: C | this = this) {\n\t\tif (eventName in this.listeners) {\n\t\t\tthis.listeners[eventName].push({ callback, context });\n\t\t} else {\n\t\t\tthis.listeners[eventName] = [{ callback, context }];\n\t\t}\n\t}\n\n\tpublic removeEventListeners() {\n\t\tthis.listeners = {} as any;\n\t}\n\n\tprotected emit<T extends keyof P>(eventName: T, arg: P[T]) {\n\t\tconst listeners = this.listeners[eventName];\n\t\tif (listeners) {\n\t\t\tfor (let i = 0, len = listeners.length; i < len; i += 1) {\n\t\t\t\tconst listener = listeners[i];\n\t\t\t\tlistener.callback.call(listener.context, arg);\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic hasListener(eventName: keyof P): boolean {\n\t\treturn !!this.listeners[eventName];\n\t}\n}\n\nexport default Plugin;\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/spur/Plugin.ts","import { EventEmitter } from 'events';\n\nclass InteractionLock extends EventEmitter {\n\tprivate lockNodes: { [lockId: number]: Node } = {};\n\tprivate lockContainerNodes: { [lockId: number]: Node } = {};\n\tprivate lockId = 0;\n\n\tpublic isLocked(DOMNode: Node): boolean {\n\t\tfor (const id in this.lockNodes) {\n\t\t\tlet node: Node | null = this.lockNodes[id];\n\t\t\twhile (node !== null) {\n\t\t\t\tif (node === DOMNode) { return true; }\n\t\t\t\tnode = node.parentNode;\n\t\t\t}\n\t\t}\n\n\t\tfor (const id in this.lockContainerNodes) {\n\t\t\tconst container = this.lockContainerNodes[id];\n\t\t\tlet parent: Node | null = DOMNode;\n\t\t\twhile (parent !== null) {\n\t\t\t\tif (parent === container) { return true; }\n\t\t\t\tparent = parent.parentNode;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tpublic requestLockOn(DOMNode: Node): number | null {\n\t\tif (this.isLocked(DOMNode)) { return null; }\n\n\t\tthis.lockId += 1;\n\t\tthis.lockNodes[this.lockId] = DOMNode;\n\t\tthis.emit('element-lock', DOMNode);\n\t\treturn this.lockId;\n\t}\n\n\tpublic requestContainerLockOn(DOMNode: Node): number | null {\n\t\tif (this.isLocked(DOMNode)) { return null; }\n\n\t\tthis.lockId += 1;\n\t\tthis.lockContainerNodes[this.lockId] = DOMNode;\n\t\tthis.emit('container-lock', DOMNode);\n\t\treturn this.lockId;\n\t}\n\n\tpublic releaseLock(id: number) {\n\t\tconst DOMNode = this.lockNodes[id] || this.lockContainerNodes[id];\n\t\tif (DOMNode) {\n\t\t\tdelete this.lockNodes[id];\n\t\t\tdelete this.lockContainerNodes[id];\n\t\t\tthis.lockId -= 1;\n\t\t\tthis.emit('unlock', DOMNode);\n\t\t}\n\t}\n}\n\nexport default new InteractionLock();\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/spur/interactionLock.ts","import * as React from 'react';\nimport * as uuid from 'uuid/v4';\n\nimport CreateSessionAction from 'shared/actions/CreateSession';\n\nimport Button from 'shared/components/Button';\nimport TextField from 'shared/components/TextField';\nimport { Context, contextTypes } from 'shared/context';\nimport { TabComponentProps } from 'shared/views/tabs';\n\nimport './CreateSession.less';\n\nclass CreateSession extends React.PureComponent<TabComponentProps> {\n\tpublic context!: Context;\n\tpublic static contextTypes = contextTypes;\n\tprivate sessionNameField!: TextField | null;\n\tprivate focusFieldTimeout: number = -1;\n\n\tpublic componentDidMount() {\n\t\tthis.focusFieldTimeout = window.setTimeout(this.focusField, 0);\n\t}\n\n\tpublic componentWillUnmount() {\n\t\twindow.clearTimeout(this.focusFieldTimeout);\n\t}\n\n\tprivate focusField = () => {\n\t\tthis.sessionNameField!.focus();\n\t}\n\n\tprivate createSession = () => {\n\t\tconst value = this.sessionNameField!.getValue();\n\t\tif (value === '') { return; }\n\n\t\tconst store = this.context.store;\n\t\tconst sessionId = 'session-' + uuid();\n\t\tstore.openSession(sessionId);\n\t\tstore.executeAction(new CreateSessionAction(\n\t\t\tsessionId,\n\t\t\tvalue,\n\t\t\tstore.userIdPerSessionId[sessionId]\n\t\t));\n\t\tthis.props.navigateToSession(sessionId, true);\n\t}\n\n\tprivate validate = (e: React.FormEvent<HTMLFormElement>) => {\n\t\te.preventDefault();\n\t\tthis.createSession();\n\t}\n\n\tpublic render() {\n\t\treturn (\n\t\t\t<div className='CreateSession'>\n\t\t\t\t<div className='view__explanation'>Create a session to allow another device to connect.</div>\n\t\t\t\t<form className='view__box' onSubmit={ this.validate }>\n\t\t\t\t\t<div className='view__column'>\n\t\t\t\t\t\t<TextField\n\t\t\t\t\t\t\tlabel='choose a name for your session'\n\t\t\t\t\t\t\tplaceholder='My session'\n\t\t\t\t\t\t\tref={ ref => this.sessionNameField = ref }\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className='view__column CreateSession__create-column'>\n\t\t\t\t\t\t<Button className='action-button  CreateSession__Create' onTap={ this.createSession }>\n\t\t\t\t\t\t\tCreate\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nexport default CreateSession;\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/views/CreateSession.tsx","import * as React from 'react';\n\nimport Button from 'shared/components/Button';\nimport SessionScanner from 'shared/components/SessionScanner';\nimport { Context, contextTypes } from 'shared/context';\nimport { TabComponentProps } from 'shared/views/tabs';\n\nimport './JoinSession.less';\n\ntype State = {\n\tisScanning: boolean\n};\n\nclass JoinSession extends React.PureComponent<TabComponentProps, State> {\n\tpublic context!: Context;\n\tpublic static contextTypes = contextTypes;\n\tprivate scanner: SessionScanner | null = null;\n\tprivate input: HTMLInputElement | null = null;\n\n\tconstructor(props: TabComponentProps, context: Context) {\n\t\tsuper(props, context);\n\n\t\tthis.state = {\n\t\t\tisScanning: false\n\t\t};\n\t}\n\n\tprivate onSessionScanned = (sessionId: string) => {\n\t\tthis.setState({ isScanning: false });\n\t\tthis.join(sessionId);\n\t}\n\n\tprivate stopScanning = () => {\n\t\tthis.setState({ isScanning: false }, () => this.scanner!.stop());\n\t}\n\n\tprivate startScanning = () => {\n\t\ttry {\n\t\t\tthis.scanner!.scan();\n\t\t\tthis.setState({ isScanning: true });\n\t\t} catch {\n\t\t\t//\n\t\t}\n\t}\n\n\tprivate validateSession = () => {\n\t\tconst sessionId = this.input!.value;\n\t\tif (!sessionId) { return; }\n\t\tthis.join(sessionId);\n\t}\n\n\tprivate join(sessionId: string) {\n\t\tthis.context.store.join(sessionId).then(() => {\n\t\t\tthis.props.navigateToSession(sessionId);\n\t\t});\n\t}\n\n\tprivate formValidate = (e: React.FormEvent<HTMLFormElement>) => {\n\t\te.preventDefault();\n\t\tthis.validateSession();\n\t}\n\n\tpublic render() {\n\t\tconst { isScanning } = this.state;\n\n\t\treturn (\n\t\t\t<div className={ 'JoinSession' + (isScanning ? ' JoinSession_scanning' : '') }>\n\t\t\t\t<div className='view__explanation'>Join an existing session by scanning its QR code or entering its ID.</div>\n\t\t\t\t<div className='view__box'>\n\t\t\t\t\t<div className='view__header'>Scan a QR Code</div>\n\t\t\t\t\t<Button onTap={ this.startScanning } className='action-button'>Start Scanning</Button>\n\t\t\t\t\t<div className='JoinSession__scanner'>\n\t\t\t\t\t\t<SessionScanner onSessionScanned={ this.onSessionScanned } ref={ ref => this.scanner = ref } />\n\t\t\t\t\t\t<Button onTap={ this.stopScanning } className='action-button JoinSession__StopScanning'>Stop Scanning</Button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<form className='view__box' onSubmit={ this.formValidate }>\n\t\t\t\t\t<div className='view__header'>Enter a session ID</div>\n\t\t\t\t\t<input className='JoinSession__id-input' ref={ ref => this.input = ref } />\n\t\t\t\t\t<Button onTap={ this.validateSession } className='action-button'>Join</Button>\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nexport default JoinSession;\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/views/JoinSession.tsx","import { observer } from 'mobx-react';\nimport * as React from 'react';\n\nimport Button from 'shared/components/Button';\nimport SessionDisplay from 'shared/components/SessionDisplay';\nimport SessionInfo from 'shared/components/SessionInfo';\nimport { Context, contextTypes } from 'shared/context';\n\nimport './SessionViewer.less';\n\nexport type Props = {\n\tsessionId: string,\n\topenInfo: boolean,\n\tgoBack?(): void\n};\n\ntype State = {\n\tinfoOpen: boolean\n};\n\n@observer\nclass SessionViewer extends React.Component<Props, State> {\n\tpublic context!: Context;\n\tpublic static contextTypes = contextTypes;\n\n\tconstructor(props: Props, context: any) {\n\t\tsuper(props, context);\n\n\t\tthis.state = { infoOpen: props.openInfo };\n\t}\n\n\tpublic componentWillReceiveProps(nextProps: Props) {\n\t\tif (nextProps.openInfo && !this.state.infoOpen) {\n\t\t\tthis.setState({ infoOpen: true });\n\t\t}\n\t}\n\n\tprivate toggleInfo = () => {\n\t\tthis.setState({ infoOpen: !this.state.infoOpen });\n\t}\n\n\tpublic render() {\n\t\tconst sessionId = this.props.sessionId;\n\t\tconst infoOpen = this.state.infoOpen;\n\t\tconst session = this.context.store.getSession(sessionId);\n\n\t\treturn (\n\t\t\t<div className='SessionViewer'>\n\t\t\t\t<div className='SessionViewer__header'>\n\t\t\t\t\t<Button onTap={ this.toggleInfo } className='SessionViewer__info'>Info</Button>\n\t\t\t\t\t<div className='SessionViewer__user-count'>Users: { session.onlineUserIds.length }</div>\n\t\t\t\t\t<Button onTap={ this.props.goBack } className='SessionViewer__go-back'>Go back</Button>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclassName={ 'SessionViewer__slider-container' + (infoOpen ? '' : ' SessionViewer__slider-container_close') }\n\t\t\t\t\t>\n\t\t\t\t\t\t<div className='SessionViewer__slider'>\n\t\t\t\t\t\t\t<SessionInfo sessionId={ sessionId } />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<SessionDisplay sessionId={ sessionId } />\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nexport default SessionViewer;\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/views/SessionViewer.tsx","import { observer } from 'mobx-react';\nimport * as React from 'react';\n\nimport UpdateUserName from 'shared/actions/UpdateUserName';\n\nimport Button from 'shared/components/Button';\nimport SessionItem from 'shared/components/SessionItem';\nimport TextField from 'shared/components/TextField';\nimport { Context, contextTypes } from 'shared/context';\nimport { TabComponentProps } from 'shared/views/tabs';\n\nimport './Sessions.less';\n\n@observer\nclass Sessions extends React.Component<TabComponentProps> {\n\tpublic context!: Context;\n\tpublic static contextTypes = contextTypes;\n\tprivate clientNameField!: TextField | null;\n\n\tprivate onEnterSession = (sessionId: string) => {\n\t\tthis.props.navigateToSession(sessionId);\n\t}\n\n\tprivate updateUserName = () => {\n\t\tconst userName = this.clientNameField!.getValue();\n\t\tif (userName === '') { return; }\n\n\t\tthis.clientNameField!.setValue('');\n\t\tthis.clientNameField!.blur();\n\n\t\tconst store = this.context.store;\n\t\tif (userName !== store.userName) {\n\t\t\tstore.executeAction(new UpdateUserName(userName));\n\t\t}\n\t}\n\n\tprivate userNameValidate = (e: React.FormEvent<HTMLFormElement>) => {\n\t\te.preventDefault();\n\t\tthis.updateUserName();\n\t}\n\n\tprivate create = () => {\n\t\tthis.props.navigateToTab('create');\n\t}\n\n\tprivate join = () => {\n\t\tthis.props.navigateToTab('join');\n\t}\n\n\tpublic render() {\n\t\tconst store = this.context.store;\n\t\tconst sessionList = store.sessionList;\n\n\t\treturn (\n\t\t\t<div className='Sessions'>\n\t\t\t\t{\n\t\t\t\t\tsessionList.length === 0 ?\n\t\t\t\t\t<React.Fragment>\n\t\t\t\t\t<div className='view__explanation'>To start, setup your name.</div>\n\t\t\t\t\t<form className='view__box' onSubmit={ this.userNameValidate }>\n\t\t\t\t\t\t<div className='view__column'>\n\t\t\t\t\t\t\t<TextField\n\t\t\t\t\t\t\t\tlabel='choose a name to identify this client'\n\t\t\t\t\t\t\t\tplaceholder={ this.context.store.userName }\n\t\t\t\t\t\t\t\tref={ ref => this.clientNameField = ref }\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className='view__column'>\n\t\t\t\t\t\t\t<Button className='action-button' onTap={ this.updateUserName }>\n\t\t\t\t\t\t\t\tSet\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</form>\n\t\t\t\t\t<div className='view__explanation'>Create or Join a session.</div>\n\t\t\t\t\t<div className='view__box'>\n\t\t\t\t\t\t<div className='view__column'>\n\t\t\t\t\t\t\t<Button onTap={ this.create } className='action-button'>\n\t\t\t\t\t\t\t\tCreate\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className='view__column'>\n\t\t\t\t\t\t<Button onTap={ this.join } className='action-button'>\n\t\t\t\t\t\t\t\tJoin\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t</React.Fragment>\n\t\t\t\t\t: null\n\t\t\t\t}\n\t\t\t\t{ sessionList.map(sessionId => <SessionItem\n\t\t\t\t\tsessionId={ sessionId }\n\t\t\t\t\tkey={ sessionId }\n\t\t\t\t\tonEnterSession={ this.onEnterSession }\n\t\t\t\t/>) }\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nexport default Sessions;\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/views/Sessions.tsx"],"sourceRoot":""}